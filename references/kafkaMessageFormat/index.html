
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../codingConventions/">
      
      
        <link rel="next" href="../networkConsensusRules/">
      
      
      <link rel="icon" href="../../topics/architecture/img/bsvblockchain_blue_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Kafka Message Format - Teranode</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../overrides/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kafka-message-format-reference-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Teranode" class="md-header__button md-logo" aria-label="Teranode" data-md-component="logo">
      
  <img src="../../topics/architecture/img/bsvblockchain_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teranode
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kafka Message Format
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/developers/forkAndPullRequestGuidelines/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../howto/locallyRunningServices/" class="md-tabs__link">
          
  
  
  How-To Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../topics/teranodeIntro/" class="md-tabs__link">
          
  
  
  Key Topics

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../projectStructure/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Teranode" class="md-nav__button md-logo" aria-label="Teranode" data-md-component="logo">
      
  <img src="../../topics/architecture/img/bsvblockchain_logo.svg" alt="logo">

    </a>
    Teranode
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/developers/forkAndPullRequestGuidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork and Pull Request Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/developers/developerSetup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/miners/minersGettingStarted/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Miners Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/locallyRunningServices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running Services Locally
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/howToRemoteDebugTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging Teranode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/generatingProtobuf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating Protobuf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/addingNewProtobufServices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adding Protobuf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/configuringGrpcLogging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuring gRPC Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/runningTests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/automatedTestingHowTo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automated Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/chain-integrity-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chain Integrity Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/makefile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Makefile Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/bugReporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bug Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/developersHowToTeranodeCLI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer's Guide to Teranode-CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12" >
        
          
          <label class="md-nav__link" for="__nav_3_12" id="__nav_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Miners
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12">
            <span class="md-nav__icon md-icon"></span>
            Miners
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_1" >
        
          
          <label class="md-nav__link" for="__nav_3_12_1" id="__nav_3_12_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_1">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/docker/minersHowToInstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersHowToInstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersHowToInstallationDeprecated/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deprecated
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_2" >
        
          
          <label class="md-nav__link" for="__nav_3_12_2" id="__nav_3_12_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_2">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/docker/minersHowToConfigureTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersHowToConfigureTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToAerospikeTuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aerospike Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToInteractWithAssetServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Server Interaction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToInteractWithFSM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FSM Interaction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToInteractWithRPCServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC Server Interaction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_3" >
        
          
          <label class="md-nav__link" for="__nav_3_12_3" id="__nav_3_12_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Start/Stop
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_3">
            <span class="md-nav__icon md-icon"></span>
            Start/Stop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/docker/minersHowToStopStartDockerTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersHowToStopStartKubernetesTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_4" >
        
          
          <label class="md-nav__link" for="__nav_3_12_4" id="__nav_3_12_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Updating Teranode
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_4">
            <span class="md-nav__icon md-icon"></span>
            Updating Teranode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/docker/minersUpdatingTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersUpdatingTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_5" >
        
          
          <label class="md-nav__link" for="__nav_3_12_5" id="__nav_3_12_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Security Best Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_5">
            <span class="md-nav__icon md-icon"></span>
            Security Best Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/docker/minersSecurityBestPractices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersSecurityBestPractices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_6" >
        
          
          <label class="md-nav__link" for="__nav_3_12_6" id="__nav_3_12_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_6">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/docker/minersHowToTroubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersHowToTroubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_7" >
        
          
          <label class="md-nav__link" for="__nav_3_12_7" id="__nav_3_12_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Additional
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_7">
            <span class="md-nav__icon md-icon"></span>
            Additional
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToCPUMiner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CPU Mining Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToResetTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reset Teranode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToSyncTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync the Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToTeranodeCLI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teranode CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersManagingDiskSpace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Managing Disk Space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/minersHowToUseListenMode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Listen Mode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/miners/kubernetes/minersHowToBackup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backup (Kubernetes)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Key Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Key Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/teranodeIntro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teranode Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/architecture/teranode-overall-system-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/architecture/teranode-architecture-brief/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Brief
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/architecture/teranode-microservices-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Microservices Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/transactionLifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transaction Lifecycle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/architecture/stateManagement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../state-machine.diagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Machine Diagram
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/architecture/understandingDoubleSpends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding Double Spends
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/technologyStack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technology Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/understandingTheTestingFramework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding the Testing Framework
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/functionalRequirementTests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional Requirement Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_12" >
        
          
          <label class="md-nav__link" for="__nav_4_12" id="__nav_4_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_12">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/features/two_phase_commit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Two Phase Commit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_13" >
        
          
          <label class="md-nav__link" for="__nav_4_13" id="__nav_4_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_13">
            <span class="md-nav__icon md-icon"></span>
            Core Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/alert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/assetServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/blockAssembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/blockValidation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/blockchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/propagation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/subtreeValidation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_14" >
        
          
          <label class="md-nav__link" for="__nav_4_14" id="__nav_4_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overlay Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_14">
            <span class="md-nav__icon md-icon"></span>
            Overlay Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/blockPersister/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/p2p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../P2P_NAT_TRAVERSAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P NAT Traversal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/legacy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Legacy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/rpc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/services/utxoPersister/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Persister
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_15" >
        
          
          <label class="md-nav__link" for="__nav_4_15" id="__nav_4_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Stores
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_15">
            <span class="md-nav__icon md-icon"></span>
            Stores
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/stores/blob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blob Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/stores/utxo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_16" >
        
          
          <label class="md-nav__link" for="__nav_4_16" id="__nav_4_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Model
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_16">
            <span class="md-nav__icon md-icon"></span>
            Data Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/datamodel/block_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/datamodel/block_header_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Header Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/datamodel/subtree_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/datamodel/transaction_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transaction Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/datamodel/utxo_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_17" >
        
          
          <label class="md-nav__link" for="__nav_4_17" id="__nav_4_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kafka
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_17">
            <span class="md-nav__icon md-icon"></span>
            Kafka
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/kafka/kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_18" >
        
          
          <label class="md-nav__link" for="__nav_4_18" id="__nav_4_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_18">
            <span class="md-nav__icon md-icon"></span>
            Commands
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/commands/seeder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Seeder
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../projectStructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API & Protobuf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            API & Protobuf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../errorHandling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../codingConventions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coding Conventions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Kafka Message Format
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Kafka Message Format
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      Index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protobuf-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Protobuf Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#block-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Block Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Block Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Block Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hash" class="md-nav__link">
    <span class="md-ellipsis">
      hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    <span class="md-ellipsis">
      URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer_id" class="md-nav__link">
    <span class="md-ellipsis">
      peer_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invalid-block-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Block Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Invalid Block Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-block-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Block Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_1" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blockhash" class="md-nav__link">
    <span class="md-ellipsis">
      blockHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason" class="md-nav__link">
    <span class="md-ellipsis">
      reason
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_1" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_1" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_1" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtree-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Subtree Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Subtree Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subtree-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Subtree Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_2" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_2" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hash_1" class="md-nav__link">
    <span class="md-ellipsis">
      hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_1" class="md-nav__link">
    <span class="md-ellipsis">
      URL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_2" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_2" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_2" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_2" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invalid-subtree-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Subtree Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Invalid Subtree Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-subtree-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Subtree Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_3" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_3" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subtreehash" class="md-nav__link">
    <span class="md-ellipsis">
      subtreeHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peerurl" class="md-nav__link">
    <span class="md-ellipsis">
      peerUrl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason_1" class="md-nav__link">
    <span class="md-ellipsis">
      reason
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_3" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_3" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_3" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_3" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_3" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-validation-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Validation Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Validation Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transaction-validation-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Validation Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_4" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_4" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tx" class="md-nav__link">
    <span class="md-ellipsis">
      tx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#height" class="md-nav__link">
    <span class="md-ellipsis">
      height
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kafkatxvalidationoptions" class="md-nav__link">
    <span class="md-ellipsis">
      KafkaTxValidationOptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KafkaTxValidationOptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#skiputxocreation" class="md-nav__link">
    <span class="md-ellipsis">
      skipUtxoCreation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addtxtoblockassembly" class="md-nav__link">
    <span class="md-ellipsis">
      addTXToBlockAssembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skippolicychecks" class="md-nav__link">
    <span class="md-ellipsis">
      skipPolicyChecks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createconflicting" class="md-nav__link">
    <span class="md-ellipsis">
      createConflicting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_4" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_4" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_4" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_4" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_4" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-metadata-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Metadata Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Metadata Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#txmeta-topic" class="md-nav__link">
    <span class="md-ellipsis">
      TxMeta Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_5" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_5" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#txhash" class="md-nav__link">
    <span class="md-ellipsis">
      txHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#action" class="md-nav__link">
    <span class="md-ellipsis">
      action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    <span class="md-ellipsis">
      content
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_5" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_5" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_5" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_5" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_5" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rejected-transaction-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Rejected Transaction Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rejected Transaction Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rejected-transaction-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Rejected Transaction Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_6" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_6" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#txhash_1" class="md-nav__link">
    <span class="md-ellipsis">
      txHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason_2" class="md-nav__link">
    <span class="md-ellipsis">
      reason
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_6" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_6" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_6" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_6" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_6" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inventory-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inventory Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inventory-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_7" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_7" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peeraddress" class="md-nav__link">
    <span class="md-ellipsis">
      peerAddress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inv" class="md-nav__link">
    <span class="md-ellipsis">
      inv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_7" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_7" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_7" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_7" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_7" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-block-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Final Block Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Final Block Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-block-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Final Block Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_8" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_8" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#header" class="md-nav__link">
    <span class="md-ellipsis">
      header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction_count" class="md-nav__link">
    <span class="md-ellipsis">
      transaction_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#size_in_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      size_in_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtree_hashes" class="md-nav__link">
    <span class="md-ellipsis">
      subtree_hashes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coinbase_tx" class="md-nav__link">
    <span class="md-ellipsis">
      coinbase_tx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#height_1" class="md-nav__link">
    <span class="md-ellipsis">
      height
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_8" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_8" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_8" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_8" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_8" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      General Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serializing-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Serializing Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deserializing-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Deserializing Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Other Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../networkConsensusRules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Consensus Rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_6" >
        
          
          <label class="md-nav__link" for="__nav_5_2_6" id="__nav_5_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Protobuf API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_6">
            <span class="md-nav__icon md-icon"></span>
            Protobuf API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protobuf_docs/alertProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protobuf_docs/blockassemblyProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protobuf_docs/blockchainProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protobuf_docs/blockvalidationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protobuf_docs/propagationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protobuf_docs/subtreevalidationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protobuf_docs/validatorProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator Proto
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Core Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/alert_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/asset_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/blockassembly_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/blockvalidation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/blockchain_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/propagation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/subtreevalidation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/validator_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Overlay Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Overlay Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/blockpersister_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/p2p_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/legacy_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Legacy Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/rpc_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../services/utxopersister_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Persister
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Stores
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Stores
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stores/blob_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blob Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stores/utxo_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/kafka_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_4" >
        
          
          <label class="md-nav__link" for="__nav_5_6_4" id="__nav_5_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Service Settings
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_4">
            <span class="md-nav__icon md-icon"></span>
            Service Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/alert_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/asset_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/blockassembly_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/blockchain_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/blockpersister_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/blockvalidation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/legacy_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Legacy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/p2p_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/propagation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/rpc_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/subtreevalidation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/utxopersister_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/services/validator_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_5" >
        
          
          <label class="md-nav__link" for="__nav_5_6_5" id="__nav_5_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Store Settings
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_5">
            <span class="md-nav__icon md-icon"></span>
            Store Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/stores/blob_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blob Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/stores/utxo_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Miscellaneous
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Miscellaneous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/BIP-239/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BIP-239 (Transaction Extended Format)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gitCommitSigningSetupGuide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git Commit Signing Setup Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../licenseInformation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Licensing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prometheusMetrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prometheus Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../teranodeDaemonReference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teranode Daemon Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testingTechnicalReference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Technical Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thirdPartySoftwareRequirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Third-Party Software Requirements
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      Index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protobuf-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Protobuf Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#block-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Block Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Block Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Block Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hash" class="md-nav__link">
    <span class="md-ellipsis">
      hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url" class="md-nav__link">
    <span class="md-ellipsis">
      URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer_id" class="md-nav__link">
    <span class="md-ellipsis">
      peer_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invalid-block-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Block Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Invalid Block Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-block-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Block Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_1" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blockhash" class="md-nav__link">
    <span class="md-ellipsis">
      blockHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason" class="md-nav__link">
    <span class="md-ellipsis">
      reason
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_1" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_1" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_1" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_1" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#subtree-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Subtree Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Subtree Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subtree-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Subtree Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_2" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_2" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hash_1" class="md-nav__link">
    <span class="md-ellipsis">
      hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url_1" class="md-nav__link">
    <span class="md-ellipsis">
      URL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_2" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_2" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_2" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_2" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invalid-subtree-notification-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Subtree Notification Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Invalid Subtree Notification Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invalid-subtree-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Invalid Subtree Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_3" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_3" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#subtreehash" class="md-nav__link">
    <span class="md-ellipsis">
      subtreeHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peerurl" class="md-nav__link">
    <span class="md-ellipsis">
      peerUrl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason_1" class="md-nav__link">
    <span class="md-ellipsis">
      reason
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_3" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_3" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_3" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_3" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_3" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-validation-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Validation Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Validation Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transaction-validation-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Validation Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_4" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_4" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tx" class="md-nav__link">
    <span class="md-ellipsis">
      tx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#height" class="md-nav__link">
    <span class="md-ellipsis">
      height
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kafkatxvalidationoptions" class="md-nav__link">
    <span class="md-ellipsis">
      KafkaTxValidationOptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KafkaTxValidationOptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#skiputxocreation" class="md-nav__link">
    <span class="md-ellipsis">
      skipUtxoCreation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#addtxtoblockassembly" class="md-nav__link">
    <span class="md-ellipsis">
      addTXToBlockAssembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skippolicychecks" class="md-nav__link">
    <span class="md-ellipsis">
      skipPolicyChecks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createconflicting" class="md-nav__link">
    <span class="md-ellipsis">
      createConflicting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_4" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_4" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_4" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_4" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_4" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-metadata-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Metadata Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Metadata Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#txmeta-topic" class="md-nav__link">
    <span class="md-ellipsis">
      TxMeta Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_5" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_5" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#txhash" class="md-nav__link">
    <span class="md-ellipsis">
      txHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#action" class="md-nav__link">
    <span class="md-ellipsis">
      action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    <span class="md-ellipsis">
      content
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_5" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_5" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_5" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_5" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_5" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rejected-transaction-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Rejected Transaction Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rejected Transaction Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rejected-transaction-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Rejected Transaction Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_6" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_6" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#txhash_1" class="md-nav__link">
    <span class="md-ellipsis">
      txHash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reason_2" class="md-nav__link">
    <span class="md-ellipsis">
      reason
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_6" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_6" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_6" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_6" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_6" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inventory-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inventory Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inventory-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Inventory Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_7" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_7" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#peeraddress" class="md-nav__link">
    <span class="md-ellipsis">
      peerAddress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inv" class="md-nav__link">
    <span class="md-ellipsis">
      inv
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_7" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_7" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_7" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_7" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_7" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-block-message-format" class="md-nav__link">
    <span class="md-ellipsis">
      Final Block Message Format
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Final Block Message Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#final-block-topic" class="md-nav__link">
    <span class="md-ellipsis">
      Final Block Topic
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#message-structure_8" class="md-nav__link">
    <span class="md-ellipsis">
      Message Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-specifications_8" class="md-nav__link">
    <span class="md-ellipsis">
      Field Specifications
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Specifications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#header" class="md-nav__link">
    <span class="md-ellipsis">
      header
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transaction_count" class="md-nav__link">
    <span class="md-ellipsis">
      transaction_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#size_in_bytes" class="md-nav__link">
    <span class="md-ellipsis">
      size_in_bytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtree_hashes" class="md-nav__link">
    <span class="md-ellipsis">
      subtree_hashes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coinbase_tx" class="md-nav__link">
    <span class="md-ellipsis">
      coinbase_tx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#height_1" class="md-nav__link">
    <span class="md-ellipsis">
      height
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_8" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-examples_8" class="md-nav__link">
    <span class="md-ellipsis">
      Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sending-messages_8" class="md-nav__link">
    <span class="md-ellipsis">
      Sending Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#receiving-messages_8" class="md-nav__link">
    <span class="md-ellipsis">
      Receiving Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-cases_8" class="md-nav__link">
    <span class="md-ellipsis">
      Error Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      General Code Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#serializing-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Serializing Messages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deserializing-messages" class="md-nav__link">
    <span class="md-ellipsis">
      Deserializing Messages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Other Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="kafka-message-format-reference-documentation">Kafka Message Format Reference Documentation</h1>
<p>This document provides comprehensive information about the message formats used in Kafka topics within the Teranode ecosystem. All message formats are defined using Protocol Buffers (protobuf), providing a structured and efficient serialization mechanism.</p>
<h2 id="index">Index</h2>
<ul>
<li><a href="#protobuf-overview">Protobuf Overview</a></li>
<li><a href="#block-notification-message-format">Block Notification Message Format</a><ul>
<li><a href="#block-topic">Block Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#hash">hash</a></li>
<li><a href="#url">URL</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#invalid-block-notification-message-format">Invalid Block Notification Message Format</a><ul>
<li><a href="#invalid-block-topic">Invalid Block Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#blockhash">blockHash</a></li>
<li><a href="#reason">reason</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#subtree-notification-message-format">Subtree Notification Message Format</a><ul>
<li><a href="#subtree-topic">Subtree Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#hash">hash</a></li>
<li><a href="#url">URL</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#invalid-subtree-notification-message-format">Invalid Subtree Notification Message Format</a><ul>
<li><a href="#invalid-subtree-topic">Invalid Subtree Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#subtreehash">subtreeHash</a></li>
<li><a href="#peerurl">peerUrl</a></li>
<li><a href="#reason">reason</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#transaction-validation-message-format">Transaction Validation Message Format</a><ul>
<li><a href="#transaction-validation-topic">Transaction Validation Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#tx">tx</a></li>
<li><a href="#height">height</a></li>
<li><a href="#options">options</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#transaction-metadata-message-format">Transaction Metadata Message Format</a><ul>
<li><a href="#txmeta-topic">TxMeta Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#txhash">txHash</a></li>
<li><a href="#action">action</a></li>
<li><a href="#content">content</a></li>
</ul>
</li>
<li><a href="#transaction-metadata">Transaction Metadata</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#rejected-transaction-message-format">Rejected Transaction Message Format</a><ul>
<li><a href="#rejected-transaction-topic">Rejected Transaction Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#txhash">txHash</a></li>
<li><a href="#reason">reason</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#inventory-message-format">Inventory Message Format</a><ul>
<li><a href="#inventory-topic">Inventory Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#peeraddress">peerAddress</a></li>
<li><a href="#inv">inv</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#final-block-message-format">Final Block Message Format</a><ul>
<li><a href="#final-block-topic">Final Block Topic</a></li>
<li><a href="#message-structure">Message Structure</a></li>
<li><a href="#field-specifications">Field Specifications</a><ul>
<li><a href="#header">header</a></li>
<li><a href="#transaction_count">transaction_count</a></li>
<li><a href="#size_in_bytes">size_in_bytes</a></li>
<li><a href="#subtree_hashes">subtree_hashes</a></li>
<li><a href="#coinbase_tx">coinbase_tx</a></li>
<li><a href="#height">height</a></li>
</ul>
</li>
<li><a href="#example">Example</a></li>
<li><a href="#code-examples">Code Examples</a><ul>
<li><a href="#sending-messages">Sending Messages</a></li>
<li><a href="#receiving-messages">Receiving Messages</a></li>
</ul>
</li>
<li><a href="#error-cases">Error Cases</a></li>
</ul>
</li>
<li><a href="#general-code-examples">General Code Examples</a><ul>
<li><a href="#serializing-messages">Serializing Messages</a></li>
<li><a href="#deserializing-messages">Deserializing Messages</a></li>
</ul>
</li>
<li><a href="#other-resources">Other Resources</a></li>
</ul>
<h2 id="protobuf-overview">Protobuf Overview</h2>
<p>Protocol Buffers (protobuf) is a language-neutral, platform-neutral, extensible mechanism for serializing structured data. In Teranode, all Kafka messages are defined and serialized using protobuf.</p>
<p>The protobuf definitions for Kafka messages are located in <code>util/kafka/kafka_message/kafka_messages.proto</code>.</p>
<h2 id="block-notification-message-format">Block Notification Message Format</h2>
<h3 id="block-topic">Block Topic</h3>
<p><code>kafka_blocksConfig</code> is the Kafka topic used for broadcasting block notifications. This topic notifies subscribers about new blocks as they are added to the blockchain.</p>
<h3 id="message-structure">Message Structure</h3>
<p>The block notification message is defined in protobuf as <code>KafkaBlockTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaBlockTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Block hash (as hex string)</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">  </span><span class="c1">// URL pointing to block data</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">peer_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// P2P peer identifier for peerMetrics tracking</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications">Field Specifications</h3>
<h4 id="hash">hash</h4>
<ul>
<li>Type: string</li>
<li>Description: Hexadecimal string representation of the BSV block hash</li>
<li>Required: Yes</li>
</ul>
<h4 id="url">URL</h4>
<ul>
<li>Type: string</li>
<li>Description: URL pointing to the location where the full block data can be retrieved</li>
<li>Required: Yes</li>
</ul>
<h4 id="peer_id">peer_id</h4>
<ul>
<li>Type: string</li>
<li>Description: P2P peer identifier used for peer metrics tracking</li>
<li>Required: Yes</li>
</ul>
<h3 id="example">Example</h3>
<p>Here's a JSON representation of the message content (for illustration purposes only; actual messages are protobuf-encoded):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://datahub.example.com/blocks/123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;peer_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;peer_12345&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples">Code Examples</h3>
<h4 id="sending-messages">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create the block notification message</span>
<span class="nx">blockHash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">Hash</span><span class="p">()</span><span class="w"> </span><span class="c1">// assumes this returns *chainhash.Hash</span>
<span class="nx">dataHubUrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;https://datahub.example.com/blocks/123&quot;</span>

<span class="c1">// Create a new protobuf message</span>
<span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaBlockTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Hash</span><span class="p">:</span><span class="w"> </span><span class="nx">blockHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="c1">// convert the hash to a string</span>
<span class="w">    </span><span class="nx">URL</span><span class="p">:</span><span class="w">  </span><span class="nx">dataHubUrl</span><span class="p">,</span>
<span class="w">    </span><span class="nx">PeerId</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;peer_12345&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// P2P peer identifier</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize block message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h4 id="receiving-messages">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming block notification message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleBlockMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Deserialize from protobuf format</span>
<span class="w">    </span><span class="nx">blockMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaBlockTopicMessage</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">blockMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize block message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Convert string hash to chainhash.Hash</span>
<span class="w">    </span><span class="nx">blockHash</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">NewHashFromStr</span><span class="p">(</span><span class="nx">blockMessage</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid block hash: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract DataHub URL and peer ID</span>
<span class="w">    </span><span class="nx">dataHubUrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">blockMessage</span><span class="p">.</span><span class="nx">URL</span>
<span class="w">    </span><span class="nx">peerID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">blockMessage</span><span class="p">.</span><span class="nx">PeerId</span>

<span class="w">    </span><span class="c1">// Process the block notification...</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received block notification for %s from peer %s, data at: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="nx">peerID</span><span class="p">,</span><span class="w"> </span><span class="nx">dataHubUrl</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaBlockTopicMessage</li>
<li>Empty or malformed hash: Hash is not a valid hexadecimal string representation of a block hash</li>
<li>Invalid URL: DataHub URL is empty or not properly formatted</li>
</ul>
<hr />
<h2 id="invalid-block-notification-message-format">Invalid Block Notification Message Format</h2>
<h3 id="invalid-block-topic">Invalid Block Topic</h3>
<p><code>kafka_invalidBlockConfig</code> is the Kafka topic used for broadcasting invalid block notifications. This topic allows services to notify other components when a block has been determined to be invalid.</p>
<h3 id="message-structure_1">Message Structure</h3>
<p>The invalid block message is defined in protobuf as <code>KafkaInvalidBlockTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaInvalidBlockTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">blockHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_1">Field Specifications</h3>
<h4 id="blockhash">blockHash</h4>
<ul>
<li>Type: string</li>
<li>Description: Hexadecimal string representation of the invalid BSV block hash</li>
<li>Required: Yes</li>
<li>Format: 64-character hexadecimal string (256-bit hash)</li>
<li>Example: <code>"00000000000000000007abd8d2a16a69c1c45a1c3b0d1a6b2e0c8b4e8f9a1b2c3"</code></li>
</ul>
<h4 id="reason">reason</h4>
<ul>
<li>Type: string</li>
<li>Description: Human-readable explanation of why the block was determined to be invalid</li>
<li>Required: Yes</li>
<li>Example: <code>"Block contains invalid transaction"</code></li>
</ul>
<h3 id="example_1">Example</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;blockHash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;00000000000000000007abd8d2a16a69c1c45a1c3b0d1a6b2e0c8b4e8f9a1b2c3&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Block contains invalid transaction&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_1">Code Examples</h3>
<h4 id="sending-messages_1">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create invalid block message</span>
<span class="nx">invalidBlockMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaInvalidBlockTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">BlockHash</span><span class="p">:</span><span class="w"> </span><span class="nx">blockHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">Reason</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Block validation failed: invalid merkle root&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">invalidBlockMessage</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to marshal invalid block message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producerMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">sarama</span><span class="p">.</span><span class="nx">ProducerMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Topic</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kafka_invalidBlock&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">sarama</span><span class="p">.</span><span class="nx">ByteEncoder</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="p">}</span>

<span class="nx">partition</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">producer</span><span class="p">.</span><span class="nx">SendMessage</span><span class="p">(</span><span class="nx">producerMessage</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to send invalid block message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="receiving-messages_1">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming invalid block message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleInvalidBlockMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">invalidBlockMessage</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaInvalidBlockTopicMessage</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">invalidBlockMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to unmarshal invalid block message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">blockHash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">invalidBlockMessage</span><span class="p">.</span><span class="nx">BlockHash</span>
<span class="w">    </span><span class="nx">reason</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">invalidBlockMessage</span><span class="p">.</span><span class="nx">Reason</span>

<span class="w">    </span><span class="c1">// Process the invalid block notification...</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Block %s marked as invalid: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHash</span><span class="p">,</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_1">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaInvalidBlockTopicMessage</li>
<li>Empty or malformed blockHash: Hash is not a valid hexadecimal string representation of a block hash</li>
<li>Empty reason: Reason field is empty or not provided</li>
</ul>
<hr />
<h2 id="subtree-notification-message-format">Subtree Notification Message Format</h2>
<h3 id="subtree-topic">Subtree Topic</h3>
<p><code>kafka_subtreesConfig</code> is the Kafka topic used for broadcasting subtree notifications. This topic notifies subscribers about new subtrees as they are created.</p>
<h3 id="message-structure_2">Message Structure</h3>
<p>The subtree notification message is defined in protobuf as <code>KafkaSubtreeTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaSubtreeTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Subtree hash (as hex string)</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">  </span><span class="c1">// URL pointing to subtree data</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_2">Field Specifications</h3>
<h4 id="hash_1">hash</h4>
<ul>
<li>Type: string</li>
<li>Description: Hexadecimal string representation of the BSV subtree hash</li>
<li>Required: Yes</li>
</ul>
<h4 id="url_1">URL</h4>
<ul>
<li>Type: string</li>
<li>Description: URL pointing to the location where the full subtree data can be retrieved</li>
<li>Required: Yes</li>
</ul>
<h3 id="example_2">Example</h3>
<p>Here's a JSON representation of the message content (for illustration purposes only; actual messages are protobuf-encoded):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;45a2b856743012ce25a4dabddd5f5bdf534c27c9347b34862bca5a14176d07&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://datahub.example.com/subtrees/123&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_2">Code Examples</h3>
<h4 id="sending-messages_2">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create the subtree notification message</span>
<span class="nx">subtreeHash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">subtree</span><span class="p">.</span><span class="nx">Hash</span><span class="p">()</span><span class="w"> </span><span class="c1">// assumes this returns *chainhash.Hash</span>
<span class="nx">dataHubUrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;https://datahub.example.com/subtrees/123&quot;</span>

<span class="c1">// Create a new protobuf message</span>
<span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaSubtreeTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Hash</span><span class="p">:</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="c1">// convert the hash to a string</span>
<span class="w">    </span><span class="nx">URL</span><span class="p">:</span><span class="w">  </span><span class="nx">dataHubUrl</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize subtree message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h4 id="receiving-messages_2">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming subtree notification message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleSubtreeMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Deserialize from protobuf format</span>
<span class="w">    </span><span class="nx">subtreeMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaSubtreeTopicMessage</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize subtree message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Convert string hash to chainhash.Hash</span>
<span class="w">    </span><span class="nx">subtreeHash</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">NewHashFromStr</span><span class="p">(</span><span class="nx">subtreeMessage</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid subtree hash: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract DataHub URL</span>
<span class="w">    </span><span class="nx">dataHubUrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">subtreeMessage</span><span class="p">.</span><span class="nx">URL</span>

<span class="w">    </span><span class="c1">// Process the subtree notification...</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received subtree notification for %s, data at: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="nx">dataHubUrl</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_2">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaSubtreeTopicMessage</li>
<li>Empty or malformed hash: Hash is not a valid hexadecimal string representation of a subtree hash</li>
<li>Invalid URL: DataHub URL is empty or not properly formatted</li>
</ul>
<hr />
<h2 id="invalid-subtree-notification-message-format">Invalid Subtree Notification Message Format</h2>
<h3 id="invalid-subtree-topic">Invalid Subtree Topic</h3>
<p><code>kafka_invalidSubtreeConfig</code> is the Kafka topic used for broadcasting invalid subtree notifications. This topic allows services to notify other components when a subtree has been determined to be invalid.</p>
<h3 id="message-structure_3">Message Structure</h3>
<p>The invalid subtree message is defined in protobuf as <code>KafkaInvalidSubtreeTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaInvalidSubtreeTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">subtreeHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">peerUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_3">Field Specifications</h3>
<h4 id="subtreehash">subtreeHash</h4>
<ul>
<li>Type: string</li>
<li>Description: Hexadecimal string representation of the invalid subtree hash</li>
<li>Required: Yes</li>
<li>Format: 64-character hexadecimal string (256-bit hash)</li>
<li>Example: <code>"a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"</code></li>
</ul>
<h4 id="peerurl">peerUrl</h4>
<ul>
<li>Type: string</li>
<li>Description: URL of the peer that provided the invalid subtree</li>
<li>Required: Yes</li>
<li>Format: Valid URL string</li>
<li>Example: <code>"http://peer1.example.com:8080"</code></li>
</ul>
<h4 id="reason_1">reason</h4>
<ul>
<li>Type: string</li>
<li>Description: Human-readable explanation of why the subtree was determined to be invalid</li>
<li>Required: Yes</li>
<li>Example: <code>"Subtree contains invalid transaction merkle proof"</code></li>
</ul>
<h3 id="example_3">Example</h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;subtreeHash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;peerUrl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://peer1.example.com:8080&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Subtree contains invalid transaction merkle proof&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_3">Code Examples</h3>
<h4 id="sending-messages_3">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create invalid subtree message</span>
<span class="nx">invalidSubtreeMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaInvalidSubtreeTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">SubtreeHash</span><span class="p">:</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">PeerUrl</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;http://peer1.example.com:8080&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Reason</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;Subtree validation failed: invalid merkle proof&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">invalidSubtreeMessage</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to marshal invalid subtree message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producerMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">sarama</span><span class="p">.</span><span class="nx">ProducerMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Topic</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kafka_invalidSubtree&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">sarama</span><span class="p">.</span><span class="nx">ByteEncoder</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
<span class="p">}</span>

<span class="nx">partition</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">producer</span><span class="p">.</span><span class="nx">SendMessage</span><span class="p">(</span><span class="nx">producerMessage</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to send invalid subtree message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="receiving-messages_3">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming invalid subtree message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleInvalidSubtreeMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">invalidSubtreeMessage</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaInvalidSubtreeTopicMessage</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">invalidSubtreeMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to unmarshal invalid subtree message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">invalidSubtreeMessage</span><span class="p">.</span><span class="nx">SubtreeHash</span>
<span class="w">    </span><span class="nx">peerUrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">invalidSubtreeMessage</span><span class="p">.</span><span class="nx">PeerUrl</span>
<span class="w">    </span><span class="nx">reason</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">invalidSubtreeMessage</span><span class="p">.</span><span class="nx">Reason</span>

<span class="w">    </span><span class="c1">// Process the invalid subtree notification...</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Subtree %s from peer %s marked as invalid: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="p">,</span><span class="w"> </span><span class="nx">peerUrl</span><span class="p">,</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_3">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaInvalidSubtreeTopicMessage</li>
<li>Empty or malformed subtreeHash: Hash is not a valid hexadecimal string representation of a subtree hash</li>
<li>Invalid peerUrl: URL is empty or not properly formatted</li>
<li>Empty reason: Reason field is empty or not provided</li>
</ul>
<hr />
<h2 id="transaction-validation-message-format">Transaction Validation Message Format</h2>
<h3 id="transaction-validation-topic">Transaction Validation Topic</h3>
<p><code>kafka_validatortxsConfig</code> is the Kafka topic used for sending transactions from the Propagation service to the Validator for validation.</p>
<h3 id="message-structure_4">Message Structure</h3>
<p>The transaction validation message is defined in protobuf as <code>KafkaTxValidationTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaTxValidationTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">bytes</span><span class="w"> </span><span class="na">tx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">                     </span><span class="c1">// Complete BSV transaction</span>
<span class="w">  </span><span class="kt">uint32</span><span class="w"> </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">                </span><span class="c1">// Current blockchain height</span>
<span class="w">  </span><span class="n">KafkaTxValidationOptions</span><span class="w"> </span><span class="na">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">  </span><span class="c1">// Optional validation options</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">KafkaTxValidationOptions</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="na">skipUtxoCreation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">        </span><span class="c1">// Skip UTXO creation if true</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="na">addTXToBlockAssembly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">    </span><span class="c1">// Add transaction to block assembly if true</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="na">skipPolicyChecks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">        </span><span class="c1">// Skip policy checks if true</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="na">createConflicting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">       </span><span class="c1">// Allow conflicting transactions if true</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_4">Field Specifications</h3>
<h4 id="tx">tx</h4>
<ul>
<li>Type: bytes</li>
<li>Description: Raw bytes of the complete BSV transaction</li>
<li>Required: Yes</li>
</ul>
<h4 id="height">height</h4>
<ul>
<li>Type: uint32</li>
<li>Description: Current blockchain height, used for validation rules that depend on height</li>
<li>Required: Yes</li>
</ul>
<h4 id="options">options</h4>
<ul>
<li>Type: KafkaTxValidationOptions</li>
<li>Description: Special options that modify the validation behavior</li>
<li>Required: No (if not provided, default values are used)</li>
</ul>
<h5 id="kafkatxvalidationoptions">KafkaTxValidationOptions</h5>
<h6 id="skiputxocreation">skipUtxoCreation</h6>
<ul>
<li>Type: bool</li>
<li>Description: When true, the validator will not create UTXO entries for this transaction</li>
<li>Default: false</li>
</ul>
<h6 id="addtxtoblockassembly">addTXToBlockAssembly</h6>
<ul>
<li>Type: bool</li>
<li>Description: When true, the validated transaction will be added to block assembly</li>
<li>Default: true</li>
</ul>
<h6 id="skippolicychecks">skipPolicyChecks</h6>
<ul>
<li>Type: bool</li>
<li>Description: When true, certain policy validation checks will be skipped</li>
<li>Default: false</li>
</ul>
<h6 id="createconflicting">createConflicting</h6>
<ul>
<li>Type: bool</li>
<li>Description: When true, the validator may create a transaction that conflicts with existing UTXOs</li>
<li>Default: false</li>
</ul>
<h3 id="example_4">Example</h3>
<p>Here's a JSON representation of the message content (for illustration purposes only; actual messages are protobuf-encoded):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;tx&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;binary data - variable length&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;skipUtxoCreation&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;addTXToBlockAssembly&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;skipPolicyChecks&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;createConflicting&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_4">Code Examples</h3>
<h4 id="sending-messages_4">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create the transaction validation message</span>
<span class="nx">transactionBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Serialize</span><span class="p">()</span><span class="w"> </span><span class="c1">// serialized transaction bytes</span>
<span class="nx">currentHeight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint32</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span><span class="w">     </span><span class="c1">// current blockchain height</span>

<span class="c1">// Create options (using defaults in this example)</span>
<span class="nx">options</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxValidationOptions</span><span class="p">{</span>
<span class="w">    </span><span class="nx">SkipUtxoCreation</span><span class="p">:</span><span class="w">     </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nx">AddTXToBlockAssembly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nx">SkipPolicyChecks</span><span class="p">:</span><span class="w">     </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CreateConflicting</span><span class="p">:</span><span class="w">    </span><span class="kc">false</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Create a new protobuf message</span>
<span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxValidationTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Tx</span><span class="p">:</span><span class="w">      </span><span class="nx">transactionBytes</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Height</span><span class="p">:</span><span class="w">  </span><span class="nx">currentHeight</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Options</span><span class="p">:</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize transaction validation message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h4 id="receiving-messages_4">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming transaction validation message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleTxValidationMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Deserialize from protobuf format</span>
<span class="w">    </span><span class="nx">txValidationMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxValidationTopicMessage</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">txValidationMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize transaction validation message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract transaction data</span>
<span class="w">    </span><span class="nx">txBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">txValidationMessage</span><span class="p">.</span><span class="nx">Tx</span>
<span class="w">    </span><span class="nx">height</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">txValidationMessage</span><span class="p">.</span><span class="nx">Height</span>
<span class="w">    </span><span class="nx">options</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">txValidationMessage</span><span class="p">.</span><span class="nx">Options</span>

<span class="w">    </span><span class="c1">// Parse the transaction</span>
<span class="w">    </span><span class="nx">tx</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bsvutil</span><span class="p">.</span><span class="nx">NewTxFromBytes</span><span class="p">(</span><span class="nx">txBytes</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid transaction data: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Process the transaction with the provided options...</span>
<span class="w">    </span><span class="nx">skipUtxoCreation</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">SkipUtxoCreation</span>
<span class="w">    </span><span class="nx">addToBlockAssembly</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">AddTXToBlockAssembly</span>
<span class="w">    </span><span class="nx">skipPolicyChecks</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">SkipPolicyChecks</span>
<span class="w">    </span><span class="nx">createConflicting</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">CreateConflicting</span>

<span class="w">    </span><span class="c1">// Perform validation based on options...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">validateTransaction</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nx">skipUtxoCreation</span><span class="p">,</span><span class="w"> </span><span class="nx">addToBlockAssembly</span><span class="p">,</span><span class="w"> </span><span class="nx">skipPolicyChecks</span><span class="p">,</span><span class="w"> </span><span class="nx">createConflicting</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_4">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaTxValidationTopicMessage</li>
<li>Empty or invalid transaction: Transaction bytes cannot be parsed</li>
<li>Invalid height: Height is too high compared to the current blockchain height</li>
</ul>
<hr />
<h2 id="transaction-metadata-message-format">Transaction Metadata Message Format</h2>
<h3 id="txmeta-topic">TxMeta Topic</h3>
<p><code>kafka_txmetaConfig</code> is the Kafka topic used for broadcasting transaction metadata for validated transactions. This topic allows the Validator to either add new transaction metadata or request deletion of previously shared metadata.</p>
<h3 id="message-structure_5">Message Structure</h3>
<p>The transaction metadata message is defined in protobuf as <code>KafkaTxMetaTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">enum</span><span class="w"> </span><span class="n">KafkaTxMetaActionType</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">ADD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c1">// Add or update transaction metadata</span>
<span class="w">  </span><span class="na">DELETE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Delete transaction metadata</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">KafkaTxMetaTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">txHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">                </span><span class="c1">// Transaction hash (as hex string)</span>
<span class="w">  </span><span class="n">KafkaTxMetaActionType</span><span class="w"> </span><span class="na">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// Action type (add or delete)</span>
<span class="w">  </span><span class="kt">bytes</span><span class="w"> </span><span class="na">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">                </span><span class="c1">// Serialized transaction metadata (only used for ADD)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_5">Field Specifications</h3>
<h4 id="txhash">txHash</h4>
<ul>
<li>Type: string</li>
<li>Description: Hexadecimal string representation of the transaction hash</li>
<li>Required: Yes</li>
</ul>
<h4 id="action">action</h4>
<ul>
<li>Type: KafkaTxMetaActionType (enum)</li>
<li>Description: Specifies whether to add/update metadata (ADD) or delete metadata (DELETE)</li>
<li>Required: Yes</li>
<li>
<p>Values:</p>
<ul>
<li>ADD (0): Add or update transaction metadata</li>
<li>DELETE (1): Delete transaction metadata</li>
</ul>
</li>
</ul>
<h4 id="content">content</h4>
<ul>
<li>Type: bytes</li>
<li>Description: Serialized transaction metadata</li>
<li>Required: Only when action is ADD; should be empty when action is DELETE</li>
<li>Content: Serialized transaction metadata that includes transaction details, transaction input outpoints (TxInpoints), block IDs, fees, and other relevant information</li>
</ul>
<h3 id="transaction-metadata">Transaction Metadata</h3>
<p>The content field contains serialized transaction metadata, which typically includes:</p>
<ul>
<li>Complete transaction content</li>
<li>Transaction input outpoints (TxInpoints) - containing parent transaction hashes and output indices</li>
<li>Block heights where the transaction appears</li>
<li>Transaction fee</li>
<li>Size in bytes</li>
<li>Flags (e.g., whether it's a coinbase transaction)</li>
<li>Lock time</li>
</ul>
<h3 id="example_5">Example</h3>
<p>Here's a JSON representation of an ADD message (for illustration purposes only; actual messages are protobuf-encoded):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;txHash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">  </span><span class="c1">// ADD</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;binary data - serialized transaction metadata&gt;&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Here's a JSON representation of a DELETE message:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;txHash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="c1">// DELETE</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">  </span><span class="c1">// Empty for DELETE operations</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_5">Code Examples</h3>
<h4 id="sending-messages_5">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Example 1: Send ADD transaction metadata message</span>
<span class="nx">txHash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">TxID</span><span class="p">().</span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="c1">// returns hex string representation</span>
<span class="nx">metadataContent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">serializeMetadata</span><span class="p">(</span><span class="nx">metadata</span><span class="p">)</span><span class="w"> </span><span class="c1">// serialize transaction metadata</span>

<span class="c1">// Create a new protobuf message for adding metadata</span>
<span class="nx">addMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxMetaTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">TxHash</span><span class="p">:</span><span class="w"> </span><span class="nx">txHash</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Action</span><span class="p">:</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxMetaActionType_ADD</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Content</span><span class="p">:</span><span class="w"> </span><span class="nx">metadataContent</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">addData</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">addMessage</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize ADD metadata message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">addData</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1">// Example 2: Send DELETE transaction metadata message</span>
<span class="nx">txHash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">TxID</span><span class="p">().</span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="c1">// returns hex string representation</span>

<span class="c1">// Create a new protobuf message for deleting metadata</span>
<span class="nx">deleteMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxMetaTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">TxHash</span><span class="p">:</span><span class="w"> </span><span class="nx">txHash</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Action</span><span class="p">:</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxMetaActionType_DELETE</span><span class="p">,</span>
<span class="w">    </span><span class="c1">// Content is empty for DELETE operations</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">deleteData</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">deleteMessage</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize DELETE metadata message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">deleteData</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h4 id="receiving-messages_5">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming transaction metadata message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleTxMetaMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Deserialize from protobuf format</span>
<span class="w">    </span><span class="nx">txMetaMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxMetaTopicMessage</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">txMetaMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize transaction metadata message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract transaction hash</span>
<span class="w">    </span><span class="nx">txHashStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">txMetaMessage</span><span class="p">.</span><span class="nx">TxHash</span>

<span class="w">    </span><span class="c1">// Convert hex string to chainhash.Hash</span>
<span class="w">    </span><span class="nx">txHash</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">NewHashFromStr</span><span class="p">(</span><span class="nx">txHashStr</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid transaction hash: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Process based on action type</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">txMetaMessage</span><span class="p">.</span><span class="nx">Action</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxMetaActionType_ADD</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// Handle ADD operation</span>
<span class="w">        </span><span class="nx">metadata</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">deserializeMetadata</span><span class="p">(</span><span class="nx">txMetaMessage</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">handleAddMetadata</span><span class="p">(</span><span class="nx">txHash</span><span class="p">,</span><span class="w"> </span><span class="nx">metadata</span><span class="p">)</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaTxMetaActionType_DELETE</span><span class="p">:</span>
<span class="w">        </span><span class="c1">// Handle DELETE operation</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">handleDeleteMetadata</span><span class="p">(</span><span class="nx">txHash</span><span class="p">)</span>

<span class="w">    </span><span class="k">default</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;unknown action type: %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">txMetaMessage</span><span class="p">.</span><span class="nx">Action</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_5">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaTxMetaTopicMessage</li>
<li>Empty or invalid transaction hash: Hash is not a valid hexadecimal string</li>
<li>Unknown action type: Action is not a recognized KafkaTxMetaActionType enum value</li>
<li>Missing content for ADD: Content field is empty when Action is ADD</li>
</ul>
<hr />
<h2 id="rejected-transaction-message-format">Rejected Transaction Message Format</h2>
<h3 id="rejected-transaction-topic">Rejected Transaction Topic</h3>
<p><code>kafka_rejectedTxConfig</code> is the Kafka topic used for broadcasting rejected transactions. This topic notifies subscribers about transactions that have been rejected during validation.</p>
<h3 id="message-structure_6">Message Structure</h3>
<p>The rejected transaction message is defined in protobuf as <code>KafkaRejectedTxTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaRejectedTxTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">txHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Transaction hash (as hex string)</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">reason</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// Rejection reason</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_6">Field Specifications</h3>
<h4 id="txhash_1">txHash</h4>
<ul>
<li>Type: string</li>
<li>Description: Hexadecimal string representation of the transaction hash, computed as double SHA256 hash</li>
<li>Computation: <code>sha256(sha256(transaction_bytes))</code></li>
<li>Required: Yes</li>
</ul>
<h4 id="reason_2">reason</h4>
<ul>
<li>Type: string</li>
<li>Description: Human-readable description of why the transaction was rejected</li>
<li>Required: Yes</li>
</ul>
<h3 id="example_6">Example</h3>
<p>Here's a JSON representation of the message content (for illustration purposes only; actual messages are protobuf-encoded):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;txHash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Insufficient fee for transaction size&quot;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_6">Code Examples</h3>
<h4 id="sending-messages_6">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create the rejected transaction message</span>
<span class="nx">txHash</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">TxID</span><span class="p">().</span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="c1">// returns hex string representation</span>
<span class="nx">reasonStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;Insufficient fee for transaction size&quot;</span>

<span class="c1">// Create a new protobuf message</span>
<span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaRejectedTxTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">TxHash</span><span class="p">:</span><span class="w"> </span><span class="nx">txHash</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Reason</span><span class="p">:</span><span class="w"> </span><span class="nx">reasonStr</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize rejected transaction message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h4 id="receiving-messages_6">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming rejected transaction message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleRejectedTxMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Deserialize from protobuf format</span>
<span class="w">    </span><span class="nx">rejectedTxMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaRejectedTxTopicMessage</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">rejectedTxMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize rejected transaction message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract transaction hash and reason</span>
<span class="w">    </span><span class="nx">txHashStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rejectedTxMessage</span><span class="p">.</span><span class="nx">TxHash</span>
<span class="w">    </span><span class="nx">reason</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">rejectedTxMessage</span><span class="p">.</span><span class="nx">Reason</span>

<span class="w">    </span><span class="c1">// Convert hex string to chainhash.Hash if needed</span>
<span class="w">    </span><span class="nx">txHash</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">NewHashFromStr</span><span class="p">(</span><span class="nx">txHashStr</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid transaction hash: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Process the rejected transaction notification...</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Transaction %s was rejected: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">txHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="nx">reason</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_6">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaRejectedTxTopicMessage</li>
<li>Empty or invalid transaction hash: Hash is not a valid hexadecimal string</li>
<li>Missing reason: Reason field is empty</li>
</ul>
<h2 id="inventory-message-format">Inventory Message Format</h2>
<h3 id="inventory-topic">Inventory Topic</h3>
<p>The inventory message topic is used for broadcasting inventory vectors between components. This allows components to notify each other about available blocks, transactions, and other data.</p>
<h3 id="message-structure_7">Message Structure</h3>
<p>The inventory message is defined in protobuf as <code>KafkaInvTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaInvTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">peerAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Address of the peer</span>
<span class="w">  </span><span class="k">repeated</span><span class="w"> </span><span class="n">Inv</span><span class="w"> </span><span class="na">inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">    </span><span class="c1">// List of inventory items</span>
<span class="p">}</span>

<span class="kd">message</span><span class="w"> </span><span class="nc">Inv</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">InvType</span><span class="w"> </span><span class="na">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Type of inventory item</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="na">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">   </span><span class="c1">// Hash of the inventory item (as hex string)</span>
<span class="p">}</span>

<span class="kd">enum</span><span class="w"> </span><span class="n">InvType</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="na">Error</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="na">Tx</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="na">Block</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">  </span><span class="na">FilteredBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_7">Field Specifications</h3>
<h4 id="peeraddress">peerAddress</h4>
<ul>
<li>Type: string</li>
<li>Description: Network address of the peer that has the inventory item</li>
<li>Required: Yes</li>
</ul>
<h4 id="inv">inv</h4>
<ul>
<li>Type: repeated Inv</li>
<li>Description: List of inventory items (see Inv message structure defined above)</li>
<li>Required: Yes</li>
</ul>
<h3 id="example_7">Example</h3>
<p>Here's a JSON representation of the message content (for illustration purposes only; actual messages are protobuf-encoded):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;peerAddress&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.1.10:8333&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;inv&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="c1">// Tx</span>
<span class="w">      </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="c1">// Block</span>
<span class="w">      </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_7">Code Examples</h3>
<h4 id="sending-messages_7">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create the inventory message</span>
<span class="nx">peerAddress</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;192.168.1.10:8333&quot;</span>

<span class="c1">// Create inventory items</span>
<span class="nx">invItems</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">Inv</span><span class="p">{</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">InvType_Tx</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Hash</span><span class="p">:</span><span class="w"> </span><span class="nx">txHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="c1">// hex string representation</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">InvType_Block</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Hash</span><span class="p">:</span><span class="w"> </span><span class="nx">blockHash</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span><span class="w"> </span><span class="c1">// hex string representation</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>

<span class="c1">// Create a new protobuf message</span>
<span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaInvTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">PeerAddress</span><span class="p">:</span><span class="w"> </span><span class="nx">peerAddress</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Inv</span><span class="p">:</span><span class="w">         </span><span class="nx">invItems</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize inventory message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h4 id="receiving-messages_7">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming inventory message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleInvMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Deserialize from protobuf format</span>
<span class="w">    </span><span class="nx">invMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaInvTopicMessage</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">invMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize inventory message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract peer address</span>
<span class="w">    </span><span class="nx">peerAddr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">invMessage</span><span class="p">.</span><span class="nx">PeerAddress</span>

<span class="w">    </span><span class="c1">// Process inventory items</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">inv</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">invMessage</span><span class="p">.</span><span class="nx">Inv</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Convert hex string to chainhash.Hash</span>
<span class="w">        </span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">NewHashFromStr</span><span class="p">(</span><span class="nx">inv</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid inventory hash: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="nx">inv</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">InvType_Tx</span><span class="p">:</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received transaction inventory from %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">peerAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="w">            </span><span class="c1">// Process transaction inventory...</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">InvType_Block</span><span class="p">:</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received block inventory from %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">peerAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="w">            </span><span class="c1">// Process block inventory...</span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">InvType_FilteredBlock</span><span class="p">:</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received filtered block inventory from %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">peerAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="w">            </span><span class="c1">// Process filtered block inventory...</span>

<span class="w">        </span><span class="k">default</span><span class="p">:</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received unknown inventory type %d from %s: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">inv</span><span class="p">.</span><span class="nx">Type</span><span class="p">,</span><span class="w"> </span><span class="nx">peerAddr</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_7">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaInvTopicMessage</li>
<li>Empty peer address: PeerAddress field is empty</li>
<li>Invalid inventory item: Hash is not a valid hexadecimal string or Type is unrecognized</li>
</ul>
<h2 id="final-block-message-format">Final Block Message Format</h2>
<h3 id="final-block-topic">Final Block Topic</h3>
<p><code>kafka_blocksFinalConfig</code> is the Kafka topic used for broadcasting finalized blocks. This topic notifies subscribers about blocks that have been fully validated and accepted into the blockchain.</p>
<h3 id="message-structure_8">Message Structure</h3>
<p>The final block message is defined in protobuf as <code>KafkaBlocksFinalTopicMessage</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">message</span><span class="w"> </span><span class="nc">KafkaBlocksFinalTopicMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">                    </span><span class="c1">// Block header bytes</span>
<span class="w">    </span><span class="kt">uint64</span><span class="w"> </span><span class="na">transaction_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">        </span><span class="c1">// Number of transactions in block</span>
<span class="w">    </span><span class="kt">uint64</span><span class="w"> </span><span class="na">size_in_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">            </span><span class="c1">// Size of block in bytes</span>
<span class="w">    </span><span class="k">repeated</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="na">subtree_hashes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">   </span><span class="c1">// Merkle tree subtree hashes</span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="na">coinbase_tx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">               </span><span class="c1">// Coinbase transaction bytes</span>
<span class="w">    </span><span class="kt">uint32</span><span class="w"> </span><span class="na">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w">                   </span><span class="c1">// Block height</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="field-specifications_8">Field Specifications</h3>
<h4 id="header">header</h4>
<ul>
<li>Type: bytes</li>
<li>Description: Serialized block header</li>
<li>Required: Yes</li>
</ul>
<h4 id="transaction_count">transaction_count</h4>
<ul>
<li>Type: uint64</li>
<li>Description: Total number of transactions in the block</li>
<li>Required: Yes</li>
</ul>
<h4 id="size_in_bytes">size_in_bytes</h4>
<ul>
<li>Type: uint64</li>
<li>Description: Total size of the block in bytes</li>
<li>Required: Yes</li>
</ul>
<h4 id="subtree_hashes">subtree_hashes</h4>
<ul>
<li>Type: repeated bytes</li>
<li>Description: List of Merkle tree subtree hashes that compose the block</li>
<li>Required: Yes</li>
</ul>
<h4 id="coinbase_tx">coinbase_tx</h4>
<ul>
<li>Type: bytes</li>
<li>Description: Serialized coinbase transaction</li>
<li>Required: Yes</li>
</ul>
<h4 id="height_1">height</h4>
<ul>
<li>Type: uint32</li>
<li>Description: Block height in the blockchain</li>
<li>Required: Yes</li>
</ul>
<h3 id="example_8">Example</h3>
<p>Here's a JSON representation of the message content (for illustration purposes only; actual messages are protobuf-encoded):</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;header&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;binary data - 80 bytes&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;transaction_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2500</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;size_in_bytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1048576</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;subtree_hashes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;&lt;binary data - 32 bytes&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;&lt;binary data - 32 bytes&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;&lt;binary data - 32 bytes&gt;&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;coinbase_tx&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;binary data - variable length&gt;&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="code-examples_8">Code Examples</h3>
<h4 id="sending-messages_8">Sending Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Create the final block message</span>
<span class="nx">blockHeader</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Serialize</span><span class="p">()</span><span class="w"> </span><span class="c1">// serialized block header bytes</span>
<span class="nx">txCount</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">Transactions</span><span class="p">.</span><span class="nx">Len</span><span class="p">())</span>
<span class="nx">blockSize</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint64</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">SerializedSize</span><span class="p">())</span>

<span class="c1">// Get subtree hashes</span>
<span class="nx">subtreeHashes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([][]</span><span class="kt">byte</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">merkleTree</span><span class="p">.</span><span class="nx">SubTrees</span><span class="p">))</span>
<span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">subtree</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">merkleTree</span><span class="p">.</span><span class="nx">SubTrees</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">subtreeHashes</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">subtree</span><span class="p">.</span><span class="nx">Hash</span><span class="p">()[:]</span>
<span class="p">}</span>

<span class="c1">// Get coinbase transaction</span>
<span class="nx">coinbaseTx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">block</span><span class="p">.</span><span class="nx">Transactions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">Serialize</span><span class="p">()</span>
<span class="nx">blockHeight</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint32</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">Height</span><span class="p">)</span>

<span class="c1">// Create a new protobuf message</span>
<span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaBlocksFinalTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Header</span><span class="p">:</span><span class="w">          </span><span class="nx">blockHeader</span><span class="p">,</span>
<span class="w">    </span><span class="nx">TransactionCount</span><span class="p">:</span><span class="w"> </span><span class="nx">txCount</span><span class="p">,</span>
<span class="w">    </span><span class="nx">SizeInBytes</span><span class="p">:</span><span class="w">     </span><span class="nx">blockSize</span><span class="p">,</span>
<span class="w">    </span><span class="nx">SubtreeHashes</span><span class="p">:</span><span class="w">   </span><span class="nx">subtreeHashes</span><span class="p">,</span>
<span class="w">    </span><span class="nx">CoinbaseTx</span><span class="p">:</span><span class="w">      </span><span class="nx">coinbaseTx</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Height</span><span class="p">:</span><span class="w">          </span><span class="nx">blockHeight</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize to protobuf format</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize final block message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h4 id="receiving-messages_8">Receiving Messages</h4>
<div class="highlight"><pre><span></span><code><span class="c1">// Handle incoming final block message</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">handleFinalBlockMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Deserialize from protobuf format</span>
<span class="w">    </span><span class="nx">finalBlockMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaBlocksFinalTopicMessage</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">finalBlockMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize final block message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Parse block header</span>
<span class="w">    </span><span class="nx">header</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">wire</span><span class="p">.</span><span class="nx">BlockHeader</span><span class="p">{}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">header</span><span class="p">.</span><span class="nx">Deserialize</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">finalBlockMessage</span><span class="p">.</span><span class="nx">Header</span><span class="p">));</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid block header: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract other fields</span>
<span class="w">    </span><span class="nx">txCount</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">finalBlockMessage</span><span class="p">.</span><span class="nx">TransactionCount</span>
<span class="w">    </span><span class="nx">blockSize</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">finalBlockMessage</span><span class="p">.</span><span class="nx">SizeInBytes</span>
<span class="w">    </span><span class="nx">subtreeHashes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">finalBlockMessage</span><span class="p">.</span><span class="nx">SubtreeHashes</span>
<span class="w">    </span><span class="nx">coinbaseTxBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">finalBlockMessage</span><span class="p">.</span><span class="nx">CoinbaseTx</span>
<span class="w">    </span><span class="nx">height</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">finalBlockMessage</span><span class="p">.</span><span class="nx">Height</span>

<span class="w">    </span><span class="c1">// Parse coinbase transaction</span>
<span class="w">    </span><span class="nx">coinbaseTx</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">bsvutil</span><span class="p">.</span><span class="nx">NewTxFromBytes</span><span class="p">(</span><span class="nx">coinbaseTxBytes</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invalid coinbase transaction: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Process the final block...</span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received final block at height %d with %d transactions (size: %d bytes)&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="nx">height</span><span class="p">,</span><span class="w"> </span><span class="nx">txCount</span><span class="p">,</span><span class="w"> </span><span class="nx">blockSize</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Process subtree hashes...</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">hashBytes</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">subtreeHashes</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span>
<span class="w">        </span><span class="nb">copy</span><span class="p">(</span><span class="nx">hash</span><span class="p">[:],</span><span class="w"> </span><span class="nx">hashBytes</span><span class="p">)</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;  Subtree hash %d: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="error-cases_8">Error Cases</h3>
<ul>
<li>Invalid message format: Message cannot be unmarshaled to KafkaBlocksFinalTopicMessage</li>
<li>Invalid block header: Header bytes cannot be deserialized to a valid block header</li>
<li>Invalid coinbase transaction: Coinbase transaction bytes cannot be parsed</li>
<li>Missing subtree hashes: No subtree hashes provided</li>
</ul>
<h2 id="general-code-examples">General Code Examples</h2>
<h3 id="serializing-messages">Serializing Messages</h3>
<p>Here's a general example of how to serialize a protobuf message for Kafka:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Create a new message</span>
<span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaBlockTopicMessage</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Hash</span><span class="p">:</span><span class="w"> </span><span class="nx">blockHash</span><span class="p">[:],</span>
<span class="w">    </span><span class="nx">URL</span><span class="p">:</span><span class="w">  </span><span class="nx">datahubUrl</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// Serialize the message to protobuf format</span>
<span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to serialize message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Send to Kafka</span>
<span class="nx">producer</span><span class="p">.</span><span class="nx">Publish</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Value</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>
<h3 id="deserializing-messages">Deserializing Messages</h3>
<p>Here's a general example of how to deserialize a protobuf message from Kafka:</p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">handleBlockMessage</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Create a new message container</span>
<span class="w">    </span><span class="nx">blockMessage</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">kafkamessage</span><span class="p">.</span><span class="nx">KafkaBlockTopicMessage</span><span class="p">{}</span>

<span class="w">    </span><span class="c1">// Deserialize the message from protobuf format</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span><span class="w"> </span><span class="nx">blockMessage</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;failed to deserialize message: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Extract block hash</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">blockHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span>
<span class="w">    </span><span class="nb">copy</span><span class="p">(</span><span class="nx">blockHash</span><span class="p">[:],</span><span class="w"> </span><span class="nx">blockMessage</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Extract DataHub URL</span>
<span class="w">    </span><span class="nx">dataHubUrl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">blockMessage</span><span class="p">.</span><span class="nx">URL</span>

<span class="w">    </span><span class="c1">// Process the message...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="other-resources">Other Resources</h2>
<ul>
<li><a href="../../topics/kafka/kafka/">Understanding Kafka Role in Teranode</a></li>
<li><a href="../../topics/datamodel/block_data_model/">The Block data model</a></li>
<li><a href="../../topics/datamodel/block_header_data_model/">The Block Header data model</a></li>
<li><a href="../../topics/datamodel/subtree_data_model/">The Subtree data model</a></li>
<li><a href="../../topics/datamodel/transaction_data_model/">The Transaction data model</a></li>
<li><a href="../../topics/datamodel/utxo_data_model/">The UTXO data model</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2025 BSV Blockchain Org.
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/bsv-blockchain/teranode" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.instant", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>