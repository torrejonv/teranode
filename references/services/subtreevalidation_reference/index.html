
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../propagation_reference/">
      
      
        <link rel="next" href="../validator_reference/">
      
      
      <link rel="icon" href="../../../topics/architecture/img/bsvblockchain_blue_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Subtree Validation - Teranode</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../../../assets/external/fonts.googleapis.com/css.49ea35f2.css">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../overrides/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#subtree-validation-reference-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Teranode" class="md-header__button md-logo" aria-label="Teranode" data-md-component="logo">
      
  <img src="../../../topics/architecture/img/bsvblockchain_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Teranode
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Subtree Validation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tutorials/developers/forkAndPullRequestGuidelines/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../howto/locallyRunningServices/" class="md-tabs__link">
          
  
  
  How-To Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../topics/teranodeIntro/" class="md-tabs__link">
          
  
  
  Key Topics

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../projectStructure/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Teranode" class="md-nav__button md-logo" aria-label="Teranode" data-md-component="logo">
      
  <img src="../../../topics/architecture/img/bsvblockchain_logo.svg" alt="logo">

    </a>
    Teranode
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/developers/forkAndPullRequestGuidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fork and Pull Request Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/developers/developerSetup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/miners/minersGettingStarted/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Miners Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/locallyRunningServices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running Services Locally
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/howToRemoteDebugTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging Teranode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/generatingProtobuf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generating Protobuf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/addingNewProtobufServices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adding Protobuf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/configuringGrpcLogging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuring gRPC Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/runningTests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/automatedTestingHowTo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automated Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/chain-integrity-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chain Integrity Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/makefile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Makefile Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/bugReporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bug Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/developersHowToTeranodeCLI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer's Guide to Teranode-CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12" >
        
          
          <label class="md-nav__link" for="__nav_3_12" id="__nav_3_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Miners
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12">
            <span class="md-nav__icon md-icon"></span>
            Miners
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_1" >
        
          
          <label class="md-nav__link" for="__nav_3_12_1" id="__nav_3_12_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_1">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToInstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToInstallation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToInstallationDeprecated/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deprecated
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_2" >
        
          
          <label class="md-nav__link" for="__nav_3_12_2" id="__nav_3_12_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_2">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToConfigureTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToConfigureTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToAerospikeTuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aerospike Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToInteractWithAssetServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Server Interaction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToInteractWithFSM/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FSM Interaction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToInteractWithRPCServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC Server Interaction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_3" >
        
          
          <label class="md-nav__link" for="__nav_3_12_3" id="__nav_3_12_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Start/Stop
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_3">
            <span class="md-nav__icon md-icon"></span>
            Start/Stop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToStopStartDockerTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToStopStartKubernetesTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_4" >
        
          
          <label class="md-nav__link" for="__nav_3_12_4" id="__nav_3_12_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Updating Teranode
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_4">
            <span class="md-nav__icon md-icon"></span>
            Updating Teranode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersUpdatingTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersUpdatingTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_5" >
        
          
          <label class="md-nav__link" for="__nav_3_12_5" id="__nav_3_12_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Security Best Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_5">
            <span class="md-nav__icon md-icon"></span>
            Security Best Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersSecurityBestPractices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersSecurityBestPractices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_6" >
        
          
          <label class="md-nav__link" for="__nav_3_12_6" id="__nav_3_12_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_6">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/docker/minersHowToTroubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToTroubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_12_7" >
        
          
          <label class="md-nav__link" for="__nav_3_12_7" id="__nav_3_12_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Additional
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_12_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_12_7">
            <span class="md-nav__icon md-icon"></span>
            Additional
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToCPUMiner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CPU Mining Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToResetTeranode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reset Teranode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToSyncTheNode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sync the Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToTeranodeCLI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teranode CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersManagingDiskSpace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Managing Disk Space
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/minersHowToUseListenMode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Listen Mode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/miners/kubernetes/minersHowToBackup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backup (Kubernetes)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Key Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Key Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/teranodeIntro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teranode Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/architecture/teranode-overall-system-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/architecture/teranode-architecture-brief/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Brief
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/architecture/teranode-microservices-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Microservices Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/transactionLifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transaction Lifecycle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/architecture/stateManagement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../state-machine.diagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State Machine Diagram
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/architecture/understandingDoubleSpends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding Double Spends
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/technologyStack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technology Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/understandingTheTestingFramework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding the Testing Framework
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/functionalRequirementTests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functional Requirement Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_12" >
        
          
          <label class="md-nav__link" for="__nav_4_12" id="__nav_4_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_12">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/features/two_phase_commit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Two Phase Commit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_13" >
        
          
          <label class="md-nav__link" for="__nav_4_13" id="__nav_4_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_13">
            <span class="md-nav__icon md-icon"></span>
            Core Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/alert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/assetServer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/blockAssembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/blockValidation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/blockchain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/propagation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/subtreeValidation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/validator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_14" >
        
          
          <label class="md-nav__link" for="__nav_4_14" id="__nav_4_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overlay Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_14">
            <span class="md-nav__icon md-icon"></span>
            Overlay Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/blockPersister/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/p2p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../P2P_NAT_TRAVERSAL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P NAT Traversal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/legacy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Legacy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/rpc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/services/utxoPersister/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Persister
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_15" >
        
          
          <label class="md-nav__link" for="__nav_4_15" id="__nav_4_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Stores
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_15">
            <span class="md-nav__icon md-icon"></span>
            Stores
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/stores/blob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blob Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/stores/utxo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_16" >
        
          
          <label class="md-nav__link" for="__nav_4_16" id="__nav_4_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Model
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_16">
            <span class="md-nav__icon md-icon"></span>
            Data Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/datamodel/block_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/datamodel/block_header_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Header Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/datamodel/subtree_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/datamodel/transaction_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transaction Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/datamodel/utxo_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Data Model
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_17" >
        
          
          <label class="md-nav__link" for="__nav_4_17" id="__nav_4_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kafka
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_17">
            <span class="md-nav__icon md-icon"></span>
            Kafka
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/kafka/kafka/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_18" >
        
          
          <label class="md-nav__link" for="__nav_4_18" id="__nav_4_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_18">
            <span class="md-nav__icon md-icon"></span>
            Commands
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/commands/seeder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Seeder
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../projectStructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API & Protobuf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            API & Protobuf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../errorHandling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Error Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../codingConventions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Coding Conventions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kafkaMessageFormat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka Message Format
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networkConsensusRules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Consensus Rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_6" >
        
          
          <label class="md-nav__link" for="__nav_5_2_6" id="__nav_5_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Protobuf API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2_6">
            <span class="md-nav__icon md-icon"></span>
            Protobuf API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protobuf_docs/alertProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protobuf_docs/blockassemblyProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protobuf_docs/blockchainProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protobuf_docs/blockvalidationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protobuf_docs/propagationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protobuf_docs/subtreevalidationProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation Proto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../protobuf_docs/validatorProto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator Proto
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Core Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alert_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../asset_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockassembly_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockvalidation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockchain_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../propagation_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Subtree Validation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    <span class="md-ellipsis">
      Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server" class="md-nav__link">
    <span class="md-ellipsis">
      Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatesubtree" class="md-nav__link">
    <span class="md-ellipsis">
      ValidateSubtree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#missingtx" class="md-nav__link">
    <span class="md-ellipsis">
      missingTx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constructor" class="md-nav__link">
    <span class="md-ellipsis">
      Constructor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constructor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    <span class="md-ellipsis">
      New
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Core Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#health" class="md-nav__link">
    <span class="md-ellipsis">
      Health
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#healthgrpc" class="md-nav__link">
    <span class="md-ellipsis">
      HealthGRPC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#init" class="md-nav__link">
    <span class="md-ellipsis">
      Init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start" class="md-nav__link">
    <span class="md-ellipsis">
      Start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    <span class="md-ellipsis">
      Stop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checksubtreefromblock" class="md-nav__link">
    <span class="md-ellipsis">
      CheckSubtreeFromBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkblocksubtrees" class="md-nav__link">
    <span class="md-ellipsis">
      CheckBlockSubtrees
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-metadata-management" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Metadata Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Metadata Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getuutxostore" class="md-nav__link">
    <span class="md-ellipsis">
      GetUutxoStore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setuutxostore" class="md-nav__link">
    <span class="md-ellipsis">
      SetUutxoStore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#settxmetacache" class="md-nav__link">
    <span class="md-ellipsis">
      SetTxMetaCache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#settxmetacachefrombytes" class="md-nav__link">
    <span class="md-ellipsis">
      SetTxMetaCacheFromBytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deltxmetacache" class="md-nav__link">
    <span class="md-ellipsis">
      DelTxMetaCache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deltxmetacachemulti" class="md-nav__link">
    <span class="md-ellipsis">
      DelTxMetaCacheMulti
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#internal-validation-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Validation Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Internal Validation Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checksubtreefromblock_1" class="md-nav__link">
    <span class="md-ellipsis">
      checkSubtreeFromBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatesubtreeinternal" class="md-nav__link">
    <span class="md-ellipsis">
      ValidateSubtreeInternal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blessmissingtransaction" class="md-nav__link">
    <span class="md-ellipsis">
      blessMissingTransaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkcounterconflictingoncurrentchain" class="md-nav__link">
    <span class="md-ellipsis">
      checkCounterConflictingOnCurrentChain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-retrieval-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Retrieval Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Retrieval Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getsubtreetxhashes" class="md-nav__link">
    <span class="md-ellipsis">
      getSubtreeTxHashes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processmissingtransactions" class="md-nav__link">
    <span class="md-ellipsis">
      processMissingTransactions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparetxsperlevel" class="md-nav__link">
    <span class="md-ellipsis">
      prepareTxsPerLevel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getsubtreemissingtxs" class="md-nav__link">
    <span class="md-ellipsis">
      getSubtreeMissingTxs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmissingtransactionsfromfile" class="md-nav__link">
    <span class="md-ellipsis">
      getMissingTransactionsFromFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmissingtransactionsfrompeer" class="md-nav__link">
    <span class="md-ellipsis">
      getMissingTransactionsFromPeer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmissingtransactionsbatch" class="md-nav__link">
    <span class="md-ellipsis">
      getMissingTransactionsBatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isprioritysubtreecheckactive" class="md-nav__link">
    <span class="md-ellipsis">
      isPrioritySubtreeCheckActive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processorphans" class="md-nav__link">
    <span class="md-ellipsis">
      processOrphans
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishinvalidsubtree" class="md-nav__link">
    <span class="md-ellipsis">
      publishInvalidSubtree
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kafka-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Kafka Handlers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kafka Handlers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumermessagehandler" class="md-nav__link">
    <span class="md-ellipsis">
      consumerMessageHandler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtreeshandler" class="md-nav__link">
    <span class="md-ellipsis">
      subtreesHandler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#txmetahandler" class="md-nav__link">
    <span class="md-ellipsis">
      txmetaHandler
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-internal-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Internal Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Internal Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatebestblock" class="md-nav__link">
    <span class="md-ellipsis">
      updateBestBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockchainsubscriptionlistener" class="md-nav__link">
    <span class="md-ellipsis">
      blockchainSubscriptionListener
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validator_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Overlay Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Overlay Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blockpersister_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../p2p_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../legacy_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P Legacy Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rpc_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utxopersister_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Persister
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Stores
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Stores
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stores/blob_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blob Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stores/utxo_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Settings Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/kafka_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka Settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_4" >
        
          
          <label class="md-nav__link" for="__nav_5_6_4" id="__nav_5_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Service Settings
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_4">
            <span class="md-nav__icon md-icon"></span>
            Service Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/alert_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alert
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/asset_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asset Server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/blockassembly_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Assembly
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/blockchain_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blockchain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/blockpersister_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/blockvalidation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Block Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/legacy_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Legacy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/p2p_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/propagation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Propagation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/rpc_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/subtreevalidation_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subtree Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/utxopersister_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Persister
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/services/validator_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6_5" >
        
          
          <label class="md-nav__link" for="__nav_5_6_5" id="__nav_5_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Store Settings
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_5">
            <span class="md-nav__icon md-icon"></span>
            Store Settings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/stores/blob_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blob Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../settings/stores/utxo_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UTXO Store
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Miscellaneous
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Miscellaneous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../misc/BIP-239/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BIP-239 (Transaction Extended Format)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gitCommitSigningSetupGuide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git Commit Signing Setup Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../licenseInformation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Licensing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prometheusMetrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prometheus Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../teranodeDaemonReference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teranode Daemon Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../testingTechnicalReference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing Technical Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../thirdPartySoftwareRequirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Third-Party Software Requirements
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    <span class="md-ellipsis">
      Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server" class="md-nav__link">
    <span class="md-ellipsis">
      Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatesubtree" class="md-nav__link">
    <span class="md-ellipsis">
      ValidateSubtree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#missingtx" class="md-nav__link">
    <span class="md-ellipsis">
      missingTx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constructor" class="md-nav__link">
    <span class="md-ellipsis">
      Constructor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Constructor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new" class="md-nav__link">
    <span class="md-ellipsis">
      New
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Core Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#health" class="md-nav__link">
    <span class="md-ellipsis">
      Health
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#healthgrpc" class="md-nav__link">
    <span class="md-ellipsis">
      HealthGRPC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#init" class="md-nav__link">
    <span class="md-ellipsis">
      Init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start" class="md-nav__link">
    <span class="md-ellipsis">
      Start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    <span class="md-ellipsis">
      Stop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checksubtreefromblock" class="md-nav__link">
    <span class="md-ellipsis">
      CheckSubtreeFromBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkblocksubtrees" class="md-nav__link">
    <span class="md-ellipsis">
      CheckBlockSubtrees
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-metadata-management" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Metadata Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Metadata Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getuutxostore" class="md-nav__link">
    <span class="md-ellipsis">
      GetUutxoStore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setuutxostore" class="md-nav__link">
    <span class="md-ellipsis">
      SetUutxoStore
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#settxmetacache" class="md-nav__link">
    <span class="md-ellipsis">
      SetTxMetaCache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#settxmetacachefrombytes" class="md-nav__link">
    <span class="md-ellipsis">
      SetTxMetaCacheFromBytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deltxmetacache" class="md-nav__link">
    <span class="md-ellipsis">
      DelTxMetaCache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deltxmetacachemulti" class="md-nav__link">
    <span class="md-ellipsis">
      DelTxMetaCacheMulti
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#internal-validation-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Validation Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Internal Validation Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checksubtreefromblock_1" class="md-nav__link">
    <span class="md-ellipsis">
      checkSubtreeFromBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validatesubtreeinternal" class="md-nav__link">
    <span class="md-ellipsis">
      ValidateSubtreeInternal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blessmissingtransaction" class="md-nav__link">
    <span class="md-ellipsis">
      blessMissingTransaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkcounterconflictingoncurrentchain" class="md-nav__link">
    <span class="md-ellipsis">
      checkCounterConflictingOnCurrentChain
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction-retrieval-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction Retrieval Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction Retrieval Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getsubtreetxhashes" class="md-nav__link">
    <span class="md-ellipsis">
      getSubtreeTxHashes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processmissingtransactions" class="md-nav__link">
    <span class="md-ellipsis">
      processMissingTransactions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparetxsperlevel" class="md-nav__link">
    <span class="md-ellipsis">
      prepareTxsPerLevel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getsubtreemissingtxs" class="md-nav__link">
    <span class="md-ellipsis">
      getSubtreeMissingTxs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmissingtransactionsfromfile" class="md-nav__link">
    <span class="md-ellipsis">
      getMissingTransactionsFromFile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmissingtransactionsfrompeer" class="md-nav__link">
    <span class="md-ellipsis">
      getMissingTransactionsFromPeer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getmissingtransactionsbatch" class="md-nav__link">
    <span class="md-ellipsis">
      getMissingTransactionsBatch
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isprioritysubtreecheckactive" class="md-nav__link">
    <span class="md-ellipsis">
      isPrioritySubtreeCheckActive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processorphans" class="md-nav__link">
    <span class="md-ellipsis">
      processOrphans
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishinvalidsubtree" class="md-nav__link">
    <span class="md-ellipsis">
      publishInvalidSubtree
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kafka-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Kafka Handlers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kafka Handlers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consumermessagehandler" class="md-nav__link">
    <span class="md-ellipsis">
      consumerMessageHandler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtreeshandler" class="md-nav__link">
    <span class="md-ellipsis">
      subtreesHandler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#txmetahandler" class="md-nav__link">
    <span class="md-ellipsis">
      txmetaHandler
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-internal-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Internal Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Additional Internal Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updatebestblock" class="md-nav__link">
    <span class="md-ellipsis">
      updateBestBlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blockchainsubscriptionlistener" class="md-nav__link">
    <span class="md-ellipsis">
      blockchainSubscriptionListener
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="subtree-validation-reference-documentation">Subtree Validation Reference Documentation</h1>
<h2 id="overview">Overview</h2>
<p>The <code>Server</code> type implements the core functionality for subtree validation in a blockchain system. It handles subtree and transaction metadata processing, interacts with various data stores, and manages Kafka consumers for distributed processing. The service is a critical component in validating transaction subtrees for inclusion in the blockchain.</p>
<h2 id="types">Types</h2>
<h3 id="server">Server</h3>
<p>The <code>Server</code> is the central component of the subtreevalidation package, managing the complete lifecycle of subtree validation including transaction validation, storage, and integration with other Teranode services.</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// UnimplementedSubtreeValidationAPIServer embeds the auto-generated gRPC server base</span>
<span class="w">    </span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">UnimplementedSubtreeValidationAPIServer</span>

<span class="w">    </span><span class="c1">// logger handles all logging operations for the service</span>
<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="nx">ulogger</span><span class="p">.</span><span class="nx">Logger</span>

<span class="w">    </span><span class="c1">// settings contains the configuration parameters for the service</span>
<span class="w">    </span><span class="c1">// including connection details, timeouts, and operational modes</span>
<span class="w">    </span><span class="nx">settings</span><span class="w"> </span><span class="o">*</span><span class="nx">settings</span><span class="p">.</span><span class="nx">Settings</span>

<span class="w">    </span><span class="c1">// subtreeStore manages persistent storage of subtrees</span>
<span class="w">    </span><span class="c1">// This blob store is used to save and retrieve complete subtree structures</span>
<span class="w">    </span><span class="nx">subtreeStore</span><span class="w"> </span><span class="nx">blob</span><span class="p">.</span><span class="nx">Store</span>

<span class="w">    </span><span class="c1">// txStore manages transaction storage</span>
<span class="w">    </span><span class="c1">// This blob store is used to save and retrieve individual transactions</span>
<span class="w">    </span><span class="nx">txStore</span><span class="w"> </span><span class="nx">blob</span><span class="p">.</span><span class="nx">Store</span>

<span class="w">    </span><span class="c1">// utxoStore manages the Unspent Transaction Output (UTXO) state</span>
<span class="w">    </span><span class="c1">// It&#39;s used during transaction validation to verify input spending</span>
<span class="w">    </span><span class="nx">utxoStore</span><span class="w"> </span><span class="nx">utxo</span><span class="p">.</span><span class="nx">Store</span>

<span class="w">    </span><span class="c1">// validatorClient provides transaction validation services</span>
<span class="w">    </span><span class="c1">// It&#39;s used to validate transactions against consensus rules</span>
<span class="w">    </span><span class="nx">validatorClient</span><span class="w"> </span><span class="nx">validator</span><span class="p">.</span><span class="nx">Interface</span>

<span class="w">    </span><span class="c1">// subtreeCount tracks the number of subtrees processed</span>
<span class="w">    </span><span class="c1">// Uses atomic operations for thread-safe access</span>
<span class="w">    </span><span class="nx">subtreeCount</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Int32</span>

<span class="w">    </span><span class="c1">// stats tracks operational statistics for monitoring and diagnostics</span>
<span class="w">    </span><span class="nx">stats</span><span class="w"> </span><span class="o">*</span><span class="nx">gocore</span><span class="p">.</span><span class="nx">Stat</span>

<span class="w">    </span><span class="c1">// prioritySubtreeCheckActiveMap tracks active priority subtree checks</span>
<span class="w">    </span><span class="c1">// Maps subtree hash strings to boolean values indicating check status</span>
<span class="w">    </span><span class="nx">prioritySubtreeCheckActiveMap</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span>

<span class="w">    </span><span class="c1">// prioritySubtreeCheckActiveMapLock protects concurrent access to the priority map</span>
<span class="w">    </span><span class="nx">prioritySubtreeCheckActiveMapLock</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>

<span class="w">    </span><span class="c1">// blockchainClient interfaces with the blockchain service</span>
<span class="w">    </span><span class="c1">// Used to retrieve block information and validate chain state</span>
<span class="w">    </span><span class="nx">blockchainClient</span><span class="w"> </span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">ClientI</span>

<span class="w">    </span><span class="c1">// subtreeConsumerClient consumes subtree-related Kafka messages</span>
<span class="w">    </span><span class="c1">// Handles incoming subtree validation requests from other services</span>
<span class="w">    </span><span class="nx">subtreeConsumerClient</span><span class="w"> </span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaConsumerGroupI</span>

<span class="w">    </span><span class="c1">// txmetaConsumerClient consumes transaction metadata Kafka messages</span>
<span class="w">    </span><span class="c1">// Processes transaction metadata updates from other services</span>
<span class="w">    </span><span class="nx">txmetaConsumerClient</span><span class="w"> </span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaConsumerGroupI</span>

<span class="w">    </span><span class="c1">// invalidSubtreeKafkaProducer publishes invalid subtree events to Kafka</span>
<span class="w">    </span><span class="nx">invalidSubtreeKafkaProducer</span><span class="w"> </span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaAsyncProducerI</span>

<span class="w">    </span><span class="c1">// invalidSubtreeLock is used to synchronize access to the invalid subtree producer</span>
<span class="w">    </span><span class="nx">invalidSubtreeLock</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>

<span class="w">    </span><span class="c1">// invalidSubtreeDeDuplicateMap is used to de-duplicate invalid subtree messages</span>
<span class="w">    </span><span class="nx">invalidSubtreeDeDuplicateMap</span><span class="w"> </span><span class="o">*</span><span class="nx">expiringmap</span><span class="p">.</span><span class="nx">ExpiringMap</span><span class="p">[</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}]</span>

<span class="w">    </span><span class="c1">// orphanage is used to store transactions that are missing parents that can be validated later</span>
<span class="w">    </span><span class="nx">orphanage</span><span class="w"> </span><span class="o">*</span><span class="nx">expiringmap</span><span class="p">.</span><span class="nx">ExpiringMap</span><span class="p">[</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">bt</span><span class="p">.</span><span class="nx">Tx</span><span class="p">]</span>

<span class="w">    </span><span class="c1">// orphanageLock is used to make sure we only process the orphanage once at a time</span>
<span class="w">    </span><span class="nx">orphanageLock</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>

<span class="w">    </span><span class="c1">// pauseSubtreeProcessing is used to pause subtree processing while a block is being processed</span>
<span class="w">    </span><span class="nx">pauseSubtreeProcessing</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Bool</span>

<span class="w">    </span><span class="c1">// bestBlockHeader is used to store the current best block header</span>
<span class="w">    </span><span class="nx">bestBlockHeader</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">BlockHeader</span><span class="p">]</span>

<span class="w">    </span><span class="c1">// bestBlockHeaderMeta is used to store the current best block header metadata</span>
<span class="w">    </span><span class="nx">bestBlockHeaderMeta</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">BlockHeaderMeta</span><span class="p">]</span>

<span class="w">    </span><span class="c1">// currentBlockIDsMap is used to store the current block IDs for the current best block height</span>
<span class="w">    </span><span class="nx">currentBlockIDsMap</span><span class="w"> </span><span class="nx">atomic</span><span class="p">.</span><span class="nx">Pointer</span><span class="p">[</span><span class="kd">map</span><span class="p">[</span><span class="kt">uint32</span><span class="p">]</span><span class="kt">bool</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="validatesubtree">ValidateSubtree</h3>
<p>The <code>ValidateSubtree</code> structure encapsulates all the necessary information required to validate a transaction subtree, providing a clean interface for the validation methods.</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">ValidateSubtree</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// SubtreeHash is the hash identifier of the subtree to validate</span>
<span class="w">    </span><span class="nx">SubtreeHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span>

<span class="w">    </span><span class="c1">// BaseURL is the source location for retrieving missing transactions</span>
<span class="w">    </span><span class="nx">BaseURL</span><span class="w"> </span><span class="kt">string</span>

<span class="w">    </span><span class="c1">// TxHashes contains the hashes of all transactions in the subtree</span>
<span class="w">    </span><span class="nx">TxHashes</span><span class="w"> </span><span class="p">[]</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span>

<span class="w">    </span><span class="c1">// AllowFailFast determines whether validation should stop on first error</span>
<span class="w">    </span><span class="c1">// When true, validation will terminate immediately upon encountering an invalid transaction</span>
<span class="w">    </span><span class="c1">// When false, validation will attempt to validate all transactions before returning</span>
<span class="w">    </span><span class="nx">AllowFailFast</span><span class="w"> </span><span class="kt">bool</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="missingtx">missingTx</h3>
<p>This structure pairs a transaction with its index in the original subtree transaction list, allowing the validation process to maintain the correct ordering and relationship of transactions.</p>
<div class="highlight"><pre><span></span><code><span class="kd">type</span><span class="w"> </span><span class="nx">missingTx</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// tx is the actual transaction data that was retrieved</span>
<span class="w">    </span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">bt</span><span class="p">.</span><span class="nx">Tx</span>

<span class="w">    </span><span class="c1">// idx is the original position of this transaction in the subtree&#39;s transaction list</span>
<span class="w">    </span><span class="nx">idx</span><span class="w"> </span><span class="kt">int</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="constructor">Constructor</h2>
<h3 id="new">New</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">New</span><span class="p">(</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span>
<span class="w">    </span><span class="nx">logger</span><span class="w"> </span><span class="nx">ulogger</span><span class="p">.</span><span class="nx">Logger</span><span class="p">,</span>
<span class="w">    </span><span class="nx">tSettings</span><span class="w"> </span><span class="o">*</span><span class="nx">settings</span><span class="p">.</span><span class="nx">Settings</span><span class="p">,</span>
<span class="w">    </span><span class="nx">subtreeStore</span><span class="w"> </span><span class="nx">blob</span><span class="p">.</span><span class="nx">Store</span><span class="p">,</span>
<span class="w">    </span><span class="nx">txStore</span><span class="w"> </span><span class="nx">blob</span><span class="p">.</span><span class="nx">Store</span><span class="p">,</span>
<span class="w">    </span><span class="nx">utxoStore</span><span class="w"> </span><span class="nx">utxo</span><span class="p">.</span><span class="nx">Store</span><span class="p">,</span>
<span class="w">    </span><span class="nx">validatorClient</span><span class="w"> </span><span class="nx">validator</span><span class="p">.</span><span class="nx">Interface</span><span class="p">,</span>
<span class="w">    </span><span class="nx">blockchainClient</span><span class="w"> </span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">ClientI</span><span class="p">,</span>
<span class="w">    </span><span class="nx">subtreeConsumerClient</span><span class="w"> </span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaConsumerGroupI</span><span class="p">,</span>
<span class="w">    </span><span class="nx">txmetaConsumerClient</span><span class="w"> </span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaConsumerGroupI</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Server</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Creates a new <code>Server</code> instance with the provided dependencies. This factory function constructs and initializes a fully configured subtree validation service, injecting all required dependencies. It follows the dependency injection pattern to ensure testability and proper separation of concerns.</p>
<p><strong>Initialization Features:</strong></p>
<ul>
<li><strong>Quorum management</strong>: Initializes singleton quorum manager for distributed locking</li>
<li><strong>Transaction metadata caching</strong>: Optionally wraps UTXO store with caching layer</li>
<li><strong>Kafka producer setup</strong>: Configures invalid subtree event publishing if enabled</li>
<li><strong>Orphanage initialization</strong>: Sets up orphaned transaction storage with configurable timeout</li>
<li><strong>Blockchain subscription</strong>: Establishes blockchain event listener for block updates</li>
<li><strong>Best block tracking</strong>: Initializes current blockchain state tracking</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Initialization Process</p>
<p>The method ensures that the service is configured with proper stores, clients, and settings before it's made available for use. It also initializes internal tracking structures and statistics for monitoring.</p>
</div>
<h2 id="core-methods">Core Methods</h2>
<h3 id="health">Health</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">Health</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">checkLiveness</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Checks the health status of the service and its dependencies. This method implements the standard Teranode health check interface used across all services for consistent monitoring, alerting, and orchestration. It provides both readiness and liveness checking capabilities to support different operational scenarios.</p>
<div class="admonition success">
<p class="admonition-title">Health Check Components</p>
<p>The method performs checks appropriate to the service's role, including:</p>
<ul>
<li><strong>Store access verification</strong>: Subtree, transaction, and UTXO data stores</li>
<li><strong>Service connections</strong>: Validator and blockchain service connectivity</li>
<li><strong>Kafka consumer health</strong>: Message processing capability</li>
<li><strong>Internal state consistency</strong>: Service operational status</li>
</ul>
</div>
<h3 id="healthgrpc">HealthGRPC</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">HealthGRPC</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">*</span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">EmptyMessage</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">HealthResponse</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Implements the gRPC health check endpoint, translating the core health check results to the gRPC protocol format.</p>
<h3 id="init">Init</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">Init</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Initializes the server metrics and performs any necessary setup. This method completes the initialization process by setting up components that require runtime initialization rather than construction-time setup. It's called after New() but before Start() to ensure all systems are properly initialized.</p>
<p>The initialization is designed to be idempotent and can be safely called multiple times, though typically it's only called once after construction and before starting the service.</p>
<h3 id="start">Start</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">Start</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">readyCh</span><span class="w"> </span><span class="kd">chan</span><span class="o">&lt;-</span><span class="w"> </span><span class="kd">struct</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Initializes and starts the server components including Kafka consumers and gRPC server. This method launches all the operational components of the subtree validation service.</p>
<p><strong>Components Started:</strong></p>
<ul>
<li><strong>FSM state synchronization</strong>: Waits for blockchain FSM to transition from IDLE state</li>
<li><strong>Kafka consumers</strong>: For subtree and transaction metadata messages with retry configuration</li>
<li><strong>gRPC server</strong>: For API access and inter-service communication</li>
<li><strong>Background workers</strong>: Any timers or workers required for operation</li>
</ul>
<p><strong>Startup Configuration:</strong></p>
<ul>
<li><strong>Subtree consumer</strong>: Configured with retry-and-move-on policy (3 retries, 2 second backoff)</li>
<li><strong>Transaction metadata consumer</strong>: Configured with no retries (0 retries, 1 second backoff)</li>
<li><strong>gRPC registration</strong>: Registers SubtreeValidationAPI service endpoints</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Startup Sequence</p>
<p>The method implements a safe startup sequence to ensure all components are properly initialized before the service is marked as ready. It also handles proper error propagation if any component fails to start.</p>
<p>Once all components are successfully started, the method signals readiness through the provided channel and then blocks until the context is canceled or an error occurs. This design allows the caller to coordinate the startup of multiple services.</p>
</div>
<h3 id="stop">Stop</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">Stop</span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Gracefully shuts down the server components including Kafka consumers. This method ensures a clean and orderly shutdown of all service components, allowing in-progress operations to complete when possible and releasing all resources properly.</p>
<div class="admonition warning">
<p class="admonition-title">Shutdown Sequence</p>
<p>The method follows a consistent shutdown sequence:</p>
<ol>
<li><strong>Stop accepting new requests</strong> - Prevents new work from starting</li>
<li><strong>Pause Kafka consumers</strong> - Prevents new messages from being processed</li>
<li><strong>Wait for completion</strong> - Allows in-progress operations to complete (with timeouts)</li>
<li><strong>Release resources</strong> - Closes connections and frees allocated resources</li>
</ol>
</div>
<p>The method is designed to be called when the service needs to be terminated, either for normal shutdown or in response to system signals.</p>
<h3 id="checksubtreefromblock">CheckSubtreeFromBlock</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">CheckSubtreeFromBlock</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">CheckSubtreeFromBlockRequest</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">CheckSubtreeFromBlockResponse</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Validates a subtree and its transactions based on the provided request. This method is the primary gRPC API endpoint for subtree validation, responsible for coordinating the validation process for an entire subtree of interdependent transactions. It ensures that all transactions in the subtree adhere to consensus rules and can be added to the blockchain.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Distributed locking</strong>: Prevents duplicate validation of the same subtree</li>
<li><strong>Retry logic</strong>: Lock acquisition with exponential backoff</li>
<li><strong>Backward compatibility</strong>: Support for both legacy and current validation paths</li>
<li><strong>Resource cleanup</strong>: Proper cleanup even in error conditions</li>
<li><strong>Structured responses</strong>: Appropriate gRPC status codes</li>
<li><strong>Orphan processing</strong>: Handles orphaned transactions after subtree validation</li>
</ul>
<div class="admonition check">
<p class="admonition-title">Validation Criteria</p>
<p>The validation process ensures that:</p>
<ul>
<li><strong>Consensus compliance</strong>: All transactions are valid according to consensus rules</li>
<li><strong>Input validity</strong>: All transaction inputs refer to unspent outputs or other transactions in the subtree</li>
<li><strong>No double-spending</strong>: No conflicts exist within the subtree or with existing chain state</li>
<li><strong>Policy compliance</strong>: Transactions satisfy all policy rules (fees, standardness, etc.)</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Resilience</p>
<p>The method will retry lock acquisition for up to 20 seconds with exponential backoff, making it resilient to temporary contention when multiple services attempt to validate the same subtree simultaneously.</p>
</div>
<h3 id="checkblocksubtrees">CheckBlockSubtrees</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">CheckBlockSubtrees</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">CheckBlockSubtreesRequest</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">CheckBlockSubtreesResponse</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Validates all subtrees referenced in a block to ensure they exist in storage and are properly validated. This method is used during block validation to verify that all subtrees in a block are available and valid before the block can be accepted.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Pause mechanism</strong>: Temporarily pauses subtree processing during validation to avoid conflicts</li>
<li><strong>Chain awareness</strong>: Only pauses processing for blocks on the current chain or extending it</li>
<li><strong>Parallel processing</strong>: Validates multiple subtrees concurrently for performance</li>
<li><strong>Level-based validation</strong>: Processes transactions in dependency order across all subtrees</li>
<li><strong>Stream processing</strong>: Efficiently processes subtree data directly from HTTP streams</li>
<li><strong>Orphan handling</strong>: Manages orphaned transactions discovered during validation</li>
</ul>
<p><strong>Validation Process:</strong></p>
<ol>
<li><strong>Chain verification</strong>: Determines if the block is on the current chain or extending it</li>
<li><strong>Subtree existence check</strong>: Verifies which subtrees are missing from local storage</li>
<li><strong>Data retrieval</strong>: Fetches missing subtree data from network sources</li>
<li><strong>Transaction extraction</strong>: Extracts all transactions from all subtrees</li>
<li><strong>Level-based processing</strong>: Validates transactions in dependency order</li>
<li><strong>Subtree validation</strong>: Validates individual subtrees after transaction processing</li>
<li><strong>Orphan processing</strong>: Handles any orphaned transactions found during validation</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Performance Optimization</p>
<p>The method uses several optimization techniques including stream processing for direct HTTP data handling, block-wide validation for better dependency resolution, parallel subtree processing, and efficient memory management during large block processing.</p>
</div>
<h2 id="transaction-metadata-management">Transaction Metadata Management</h2>
<h3 id="getuutxostore">GetUutxoStore</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">GetUutxoStore</span><span class="p">()</span><span class="w"> </span><span class="nx">utxo</span><span class="p">.</span><span class="nx">Store</span>
</code></pre></div>
<p>Returns the UTXO store instance used by the server. This method provides access to the store that manages unspent transaction outputs.</p>
<h3 id="setuutxostore">SetUutxoStore</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">SetUutxoStore</span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="nx">utxo</span><span class="p">.</span><span class="nx">Store</span><span class="p">)</span>
</code></pre></div>
<p>Sets the UTXO store instance for the server. This method allows runtime replacement of the UTXO store, which can be useful for testing or for implementing different storage strategies.</p>
<h3 id="settxmetacache">SetTxMetaCache</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">SetTxMetaCache</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">*</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">txMeta</span><span class="w"> </span><span class="o">*</span><span class="nx">meta</span><span class="p">.</span><span class="nx">Data</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Stores transaction metadata in the cache if caching is enabled. This method optimizes validation performance by caching frequently accessed transaction metadata.</p>
<div class="admonition note">
<p class="admonition-title">Implementation Note</p>
<p>This method signature is documented but the actual implementation may delegate to the underlying UTXO store's caching mechanism.</p>
</div>
<h3 id="settxmetacachefrombytes">SetTxMetaCacheFromBytes</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">SetTxMetaCacheFromBytes</span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">txMetaBytes</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Stores raw transaction metadata bytes in the cache. This is a lower-level method that can be more efficient when the raw bytes are already available.</p>
<h3 id="deltxmetacache">DelTxMetaCache</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">DelTxMetaCache</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">*</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Removes transaction metadata from the cache if caching is enabled. This ensures cache consistency when transactions are modified or invalidated.</p>
<h3 id="deltxmetacachemulti">DelTxMetaCacheMulti</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">DelTxMetaCacheMulti</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">*</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Removes multiple transaction metadata entries from the cache. This method is optimized for batch operations when multiple related entries need to be invalidated.</p>
<h2 id="internal-validation-methods">Internal Validation Methods</h2>
<h3 id="checksubtreefromblock_1">checkSubtreeFromBlock</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">checkSubtreeFromBlock</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">subtreevalidation_api</span><span class="p">.</span><span class="nx">CheckSubtreeFromBlockRequest</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">ok</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Internal implementation of subtree validation logic. This method contains the core business logic for validating a subtree, separated from the API-level concerns handled by the public CheckSubtreeFromBlock method. The separation allows for cleaner testing and better separation of concerns.</p>
<div class="admonition info">
<p class="admonition-title">Subtree Storage Convention</p>
<p>The method expects the subtree to be stored in the subtree store with a special extension (<code>.subtreeToCheck</code> instead of <code>.subtree</code>) to differentiate between validated and unvalidated subtrees. This prevents the validation service from mistakenly treating an unvalidated subtree as already validated.</p>
</div>
<p><strong>The validation process includes:</strong></p>
<ol>
<li><strong>Retrieving the subtree data</strong> from storage</li>
<li><strong>Parsing the subtree structure</strong> and transaction list</li>
<li><strong>Checking for existing transaction metadata</strong> to avoid redundant work</li>
<li><strong>Retrieving and validating missing transactions</strong> from appropriate sources</li>
<li><strong>Verifying transaction dependencies and ordering</strong> within the subtree</li>
<li><strong>Confirming all transactions meet consensus rules</strong> for blockchain inclusion</li>
</ol>
<h3 id="validatesubtreeinternal">ValidateSubtreeInternal</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">ValidateSubtreeInternal</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="nx">ValidateSubtree</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHeight</span><span class="w"> </span><span class="kt">uint32</span><span class="p">,</span>
<span class="w">    </span><span class="nx">blockIds</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">uint32</span><span class="p">]</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">validationOptions</span><span class="w"> </span><span class="o">...</span><span class="nx">validator</span><span class="p">.</span><span class="nx">Option</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Performs the actual validation of a subtree. This is the core method of the subtree validation service, responsible for the complete validation process of a transaction subtree. It handles the complex task of verifying that all transactions in a subtree are valid both individually and collectively, ensuring they can be safely added to the blockchain.</p>
<div class="admonition note">
<p class="admonition-title">Validation Process Steps</p>
<p>The validation process includes several key steps:</p>
<ol>
<li><strong>Retrieving the subtree structure</strong> and transaction list</li>
<li><strong>Identifying which transactions need validation</strong> (missing metadata)</li>
<li><strong>Retrieving missing transactions</strong> from appropriate sources</li>
<li><strong>Validating transaction dependencies</strong> and ordering</li>
<li><strong>Applying consensus rules</strong> to each transaction</li>
<li><strong>Managing transaction metadata</strong> storage and updates</li>
<li><strong>Handling any conflicts</strong> or validation failures</li>
</ol>
<p><strong>Performance Optimization Techniques:</strong></p>
<ul>
<li><strong>Batch processing</strong> of transaction validations where possible</li>
<li><strong>Caching of transaction metadata</strong> to avoid redundant validation</li>
<li><strong>Parallel processing</strong> of independent transaction validations</li>
<li><strong>Early termination</strong> for invalid subtrees (when <code>AllowFailFast</code> is true)</li>
<li><strong>Efficient retrieval</strong> of missing transactions in batches</li>
</ul>
</div>
<h3 id="blessmissingtransaction">blessMissingTransaction</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">blessMissingTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">tx</span><span class="w"> </span><span class="o">*</span><span class="nx">bt</span><span class="p">.</span><span class="nx">Tx</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHeight</span><span class="w"> </span><span class="kt">uint32</span><span class="p">,</span>
<span class="w">    </span><span class="nx">blockIds</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">uint32</span><span class="p">]</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">validationOptions</span><span class="w"> </span><span class="o">*</span><span class="nx">validator</span><span class="p">.</span><span class="nx">Options</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">txMeta</span><span class="w"> </span><span class="o">*</span><span class="nx">meta</span><span class="p">.</span><span class="nx">Data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Validates a transaction and retrieves its metadata, performing the core consensus validation operations required for blockchain inclusion. This method applies full validation to a transaction, ensuring it adheres to all Bitcoin consensus rules and can be properly included in the blockchain.</p>
<div class="admonition abstract">
<p class="admonition-title">Validation Components</p>
<p>The validation includes:</p>
<ul>
<li><strong>Transaction format</strong>: Structure and format validation</li>
<li><strong>Input signatures</strong>: Cryptographic signature verification</li>
<li><strong>UTXO availability</strong>: Input UTXO availability and spending authorization</li>
<li><strong>Fee calculation</strong>: Fee calculation and policy enforcement</li>
<li><strong>Script execution</strong>: Script execution and validation</li>
<li><strong>Double-spend prevention</strong>: Conflict detection and prevention</li>
</ul>
</div>
<p>Upon successful validation, the transaction's metadata is calculated and stored, making it available for future reference and for validation of dependent transactions.</p>
<h3 id="checkcounterconflictingoncurrentchain">checkCounterConflictingOnCurrentChain</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">checkCounterConflictingOnCurrentChain</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">txHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">blockIds</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">uint32</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Checks if the counter-conflicting transactions of a given transaction have already been mined on the current chain. If they have, it returns an error indicating that the transaction is invalid.</p>
<h2 id="transaction-retrieval-methods">Transaction Retrieval Methods</h2>
<h3 id="getsubtreetxhashes">getSubtreeTxHashes</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">getSubtreeTxHashes</span><span class="p">(</span><span class="nx">spanCtx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">stat</span><span class="w"> </span><span class="o">*</span><span class="nx">gocore</span><span class="p">.</span><span class="nx">Stat</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="o">*</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">baseURL</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Retrieves transaction hashes for a subtree from a remote source. This method fetches the list of transactions that are part of a given subtree from a network peer or another service.</p>
<p><strong>Retrieval Strategy:</strong></p>
<ul>
<li><strong>Local first</strong>: Checks for existing <code>.subtreeToCheck</code> files in local storage</li>
<li><strong>Network fallback</strong>: Fetches subtree hash list from remote URL if not available locally</li>
<li><strong>Buffered processing</strong>: Uses buffered I/O for efficient hash list processing</li>
</ul>
<h3 id="processmissingtransactions">processMissingTransactions</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">processMissingTransactions</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">subtree</span><span class="w"> </span><span class="o">*</span><span class="nx">util</span><span class="p">.</span><span class="nx">Subtree</span><span class="p">,</span>
<span class="w">    </span><span class="nx">missingTxHashes</span><span class="w"> </span><span class="p">[]</span><span class="nx">utxo</span><span class="p">.</span><span class="nx">UnresolvedMetaData</span><span class="p">,</span><span class="w"> </span><span class="nx">allTxs</span><span class="w"> </span><span class="p">[]</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">baseURL</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">txMetaSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">meta</span><span class="p">.</span><span class="nx">Data</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHeight</span><span class="w"> </span><span class="kt">uint32</span><span class="p">,</span>
<span class="w">    </span><span class="nx">blockIds</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">uint32</span><span class="p">]</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">validationOptions</span><span class="w"> </span><span class="o">...</span><span class="nx">validator</span><span class="p">.</span><span class="nx">Option</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Handles the retrieval and validation of missing transactions in a subtree, coordinating both the retrieval process and the validation workflow. This method is a critical part of the subtree validation process.</p>
<div class="admonition important">
<p class="admonition-title">Key Responsibilities</p>
<ol>
<li><strong>Retrieving transactions</strong> that are referenced in the subtree but not available locally</li>
<li><strong>Organizing transactions</strong> into dependency levels for ordered processing</li>
<li><strong>Validating each transaction</strong> according to consensus rules</li>
<li><strong>Managing parallel processing</strong> of independent transaction validations</li>
<li><strong>Tracking validation results</strong> and updating transaction metadata</li>
</ol>
</div>
<p><strong>Resilience Features:</strong></p>
<ul>
<li><strong>Multiple retrieval methods</strong>: Supports both file-based and network-based transaction retrieval</li>
<li><strong>Fallback mechanisms</strong>: Ensures maximum resilience with automatic failover</li>
<li><strong>Level-based processing</strong>: Transactions are grouped by dependency level and processed in order</li>
<li><strong>Dependency ordering</strong>: Parent transactions are validated before their children</li>
</ul>
<h3 id="preparetxsperlevel">prepareTxsPerLevel</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">prepareTxsPerLevel</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">transactions</span><span class="w"> </span><span class="p">[]</span><span class="nx">missingTx</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32</span><span class="p">,</span><span class="w"> </span><span class="p">[][]</span><span class="nx">missingTx</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Organizes transactions by their dependency level for ordered processing. This method implements a topological sorting algorithm to organize transactions based on their dependency relationships. Transactions are grouped into levels, where each level contains transactions that can be processed independently of each other, but depend on transactions from previous levels.</p>
<p><strong>Algorithm Details:</strong></p>
<ul>
<li><strong>Dependency graph construction</strong>: Builds adjacency lists for efficient parent-child lookups</li>
<li><strong>Level assignment</strong>: Assigns each transaction to the appropriate dependency level</li>
<li><strong>Memory optimization</strong>: Pre-allocates slices based on calculated level sizes</li>
<li><strong>Coinbase handling</strong>: Properly handles coinbase transactions in dependency analysis</li>
</ul>
<h3 id="getsubtreemissingtxs">getSubtreeMissingTxs</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">getSubtreeMissingTxs</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">subtree</span><span class="w"> </span><span class="o">*</span><span class="nx">util</span><span class="p">.</span><span class="nx">Subtree</span><span class="p">,</span>
<span class="w">    </span><span class="nx">missingTxHashes</span><span class="w"> </span><span class="p">[]</span><span class="nx">utxo</span><span class="p">.</span><span class="nx">UnresolvedMetaData</span><span class="p">,</span><span class="w"> </span><span class="nx">allTxs</span><span class="w"> </span><span class="p">[]</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">baseURL</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="nx">missingTx</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Retrieves transactions that are referenced in a subtree but not available locally. This method implements an intelligent retrieval strategy for missing transactions with optimizations for different scenarios.</p>
<div class="admonition tip">
<p class="admonition-title">Intelligent Retrieval Strategy</p>
<p>The method first checks if a complete subtree data file exists locally, which would contain all transactions. If not available, it makes a decision based on the percentage of missing transactions:</p>
<ul>
<li><strong>High missing percentage</strong>: Attempts to fetch the entire subtree data file from the peer to optimize network usage (configurable threshold via <code>PercentageMissingGetFullData</code> setting)</li>
<li><strong>Low missing percentage</strong>: Retrieves only the specific missing transactions individually</li>
<li><strong>Automatic fallback</strong>: Falls back to individual transaction retrieval if subtree data fetch fails</li>
</ul>
<p><strong>Resilience Features:</strong></p>
<ul>
<li><strong>Fallback mechanisms</strong>: Ensures maximum resilience with automatic failover</li>
<li><strong>Multiple retrieval methods</strong>: Switches between file-based and network-based retrieval as needed</li>
<li><strong>Network optimization</strong>: Minimizes bandwidth usage through intelligent batching decisions</li>
</ul>
</div>
<h3 id="getmissingtransactionsfromfile">getMissingTransactionsFromFile</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">getMissingTransactionsFromFile</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">missingTxHashes</span><span class="w"> </span><span class="p">[]</span><span class="nx">utxo</span><span class="p">.</span><span class="nx">UnresolvedMetaData</span><span class="p">,</span>
<span class="w">    </span><span class="nx">allTxs</span><span class="w"> </span><span class="p">[]</span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">missingTxs</span><span class="w"> </span><span class="p">[]</span><span class="nx">missingTx</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Retrieves missing transactions from a locally stored subtree data file. This method attempts to read transaction data from a locally stored subtree file, which can be more efficient than retrieving individual transactions from the network.</p>
<p><strong>File Processing:</strong></p>
<ul>
<li><strong>Subtree reconstruction</strong>: Rebuilds subtree structure from transaction hashes if needed</li>
<li><strong>Data file reading</strong>: Reads from <code>.subtreeData</code> files in blob storage</li>
<li><strong>Transaction mapping</strong>: Maps requested transaction hashes to their positions in the subtree</li>
<li><strong>Efficient lookup</strong>: Uses subtree lookup maps for fast transaction retrieval</li>
</ul>
<h3 id="getmissingtransactionsfrompeer">getMissingTransactionsFromPeer</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">getMissingTransactionsFromPeer</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">missingTxHashes</span><span class="w"> </span><span class="p">[]</span><span class="nx">utxo</span><span class="p">.</span><span class="nx">UnresolvedMetaData</span><span class="p">,</span>
<span class="w">    </span><span class="nx">baseURL</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">missingTxs</span><span class="w"> </span><span class="p">[]</span><span class="nx">missingTx</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Retrieves missing transactions from a peer node. This method handles the network communication required to fetch transactions that are not available locally, organizing the retrieval into batches for efficiency.</p>
<h3 id="getmissingtransactionsbatch">getMissingTransactionsBatch</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">getMissingTransactionsBatch</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">txHashes</span><span class="w"> </span><span class="p">[]</span><span class="nx">utxo</span><span class="p">.</span><span class="nx">UnresolvedMetaData</span><span class="p">,</span><span class="w"> </span><span class="nx">baseURL</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">([]</span><span class="o">*</span><span class="nx">bt</span><span class="p">.</span><span class="nx">Tx</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div>
<p>Retrieves a batch of transactions from the network. This method optimizes network utilization by fetching multiple transactions in a single request, reducing the overhead of multiple separate requests.</p>
<h3 id="isprioritysubtreecheckactive">isPrioritySubtreeCheckActive</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">isPrioritySubtreeCheckActive</span><span class="p">(</span><span class="nx">subtreeHash</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">bool</span>
</code></pre></div>
<p>Checks if a priority subtree check is active for the given subtree hash. Priority checks get special handling and resource allocation to ensure critical subtrees are validated promptly.</p>
<h3 id="processorphans">processOrphans</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">processOrphans</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHash</span><span class="w"> </span><span class="nx">chainhash</span><span class="p">.</span><span class="nx">Hash</span><span class="p">,</span><span class="w"> </span><span class="nx">blockHeight</span><span class="w"> </span><span class="kt">uint32</span><span class="p">,</span><span class="w"> </span><span class="nx">blockIds</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">uint32</span><span class="p">]</span><span class="kt">bool</span><span class="p">)</span>
</code></pre></div>
<p>Processes orphaned transactions that were discovered during subtree validation. This method attempts to validate transactions that were previously missing parents, organizing them by dependency level and processing them in parallel where possible.</p>
<p><strong>Orphan Processing:</strong></p>
<ul>
<li><strong>Dependency analysis</strong>: Organizes orphaned transactions by dependency level</li>
<li><strong>Parallel validation</strong>: Processes independent transactions concurrently</li>
<li><strong>Automatic cleanup</strong>: Removes successfully validated transactions from the orphanage</li>
<li><strong>Metrics tracking</strong>: Tracks the number of orphans processed for monitoring</li>
</ul>
<h3 id="publishinvalidsubtree">publishInvalidSubtree</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">publishInvalidSubtree</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">subtreeHash</span><span class="p">,</span><span class="w"> </span><span class="nx">peerURL</span><span class="p">,</span><span class="w"> </span><span class="nx">reason</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
</code></pre></div>
<p>Publishes invalid subtree events to Kafka for system-wide notification. This method helps coordinate the handling of invalid subtrees across the network by notifying other services.</p>
<p><strong>Features:</strong></p>
<ul>
<li><strong>Deduplication</strong>: Prevents duplicate notifications for the same invalid subtree</li>
<li><strong>State awareness</strong>: Only publishes during normal operation (not during sync)</li>
<li><strong>Structured messaging</strong>: Uses protobuf messages for reliable communication</li>
</ul>
<h2 id="kafka-handlers">Kafka Handlers</h2>
<h3 id="consumermessagehandler">consumerMessageHandler</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">consumerMessageHandler</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaMessage</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Returns a function that processes Kafka messages for subtree validation. It handles both recoverable and unrecoverable errors appropriately. The handler includes sophisticated error categorization to determine whether errors should result in message reprocessing or rejection.</p>
<div class="admonition gear">
<p class="admonition-title">Handler Features</p>
<p>Key features include:</p>
<ul>
<li><strong>Error categorization</strong>: Different handling for recoverable vs. non-recoverable errors</li>
<li><strong>State-aware processing</strong>: Considers the current blockchain state</li>
<li><strong>Context handling</strong>: Proper context cancellation handling</li>
<li><strong>Idempotent processing</strong>: Prevents duplicate validation</li>
</ul>
</div>
<h3 id="subtreeshandler">subtreesHandler</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">subtreesHandler</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaMessage</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Handles incoming subtree messages from Kafka. This method unmarshals the message, extracts the subtree hash and base URL, acquires the appropriate lock, and triggers the validation process. It includes comprehensive error handling and logging for operational visibility.</p>
<h3 id="txmetahandler">txmetaHandler</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">txmetaHandler</span><span class="p">(</span><span class="nx">msg</span><span class="w"> </span><span class="o">*</span><span class="nx">kafka</span><span class="p">.</span><span class="nx">KafkaMessage</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Handles incoming transaction metadata messages from Kafka. This method processes updates to transaction metadata that might be required for proper subtree validation, ensuring the metadata store remains consistent with the latest transaction state.</p>
<h2 id="additional-internal-methods">Additional Internal Methods</h2>
<h3 id="updatebestblock">updateBestBlock</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">updateBestBlock</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div>
<p>Updates the service's cached best block information by querying the blockchain client. This method maintains current blockchain state for validation operations.</p>
<p><strong>State Updates:</strong></p>
<ul>
<li><strong>Best block header</strong>: Updates cached best block header</li>
<li><strong>Block metadata</strong>: Updates cached block metadata including height</li>
<li><strong>Block ID mapping</strong>: Updates current block IDs map for chain validation</li>
<li><strong>Store synchronization</strong>: Updates subtree store's current block height</li>
</ul>
<h3 id="blockchainsubscriptionlistener">blockchainSubscriptionListener</h3>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">blockchainSubscriptionListener</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span>
</code></pre></div>
<p>Background goroutine that listens for blockchain events and updates the service's cached blockchain state. This method ensures the service maintains current blockchain information for validation operations.</p>
<p><strong>Subscription Features:</strong></p>
<ul>
<li><strong>Automatic reconnection</strong>: Handles subscription failures with backoff and retry</li>
<li><strong>Block notifications</strong>: Processes block addition notifications</li>
<li><strong>State synchronization</strong>: Updates best block information on block events</li>
<li><strong>Graceful shutdown</strong>: Properly handles context cancellation</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  2025 BSV Blockchain Org.
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/bsv-blockchain/teranode" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.instant", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>