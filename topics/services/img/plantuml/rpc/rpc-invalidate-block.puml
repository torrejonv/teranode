@startuml
skinparam backgroundColor #F0F8FF
skinparam defaultFontColor #333333
skinparam arrowColor #666666

' Define borders for all elements
skinparam entity {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam control {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam participant {
  BorderColor #666666
  BackgroundColor #DDDDDD
}



participant Client
participant "RPC Server" as RPC
participant "Chain Hash Parser" as Parser
participant "Blockchain Client" as Blockchain

Client -> RPC : InvalidateBlockCmd(blockhash)
activate RPC

RPC -> Parser : NewHashFromStr(blockhash)
activate Parser

alt Invalid Hash Format
    Parser --> RPC : Return error
    RPC -> Client : Return rpcDecodeHexError
    note right
        Error response:
        - Code: ErrRPCDecodeHexString
        - Message: "Argument must be hexadecimal string"
    end note
else Valid Hash
    Parser --> RPC : Return parsed hash
    deactivate Parser

    RPC -> Blockchain : InvalidateBlock(ctx, hash)
    activate Blockchain

    alt Invalidation Fails
        Blockchain --> RPC : Return error
        RPC -> Client : Return error
    else Invalidation Succeeds
        Blockchain --> RPC : Return nil
        deactivate Blockchain

        RPC -> Client : Return nil
        note right
            Response fields:
            - Returns nil on success

            Effects:
            - Block is marked as invalid
            - All descendant blocks also invalidated
            - Chain may reorganize
        end note
    end
end

deactivate RPC

left footer Last Modified On: %date("dd-MMM-yyyy")
@enduml
