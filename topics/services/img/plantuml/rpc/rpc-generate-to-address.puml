@startuml
skinparam backgroundColor #F0F8FF
skinparam defaultFontColor #333333
skinparam arrowColor #666666

' Define borders for all elements
skinparam entity {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam control {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam participant {
  BorderColor #666666
  BackgroundColor #DDDDDD
}



participant Client
participant "RPC Server" as RPC
participant "Address Validator" as AddrVal
participant "Mining Service" as Mining
participant "Blockchain Service" as Blockchain

Client -> RPC : GenerateToAddressCmd(nblocks, address, maxtries)
activate RPC

RPC -> RPC : Validate nblocks
note right
  Validation checks:
  - nblocks must be positive
  - nblocks must not exceed maximum allowed
end note

alt Invalid Block Count
    RPC -> Client : Return error
    note right
        Error response:
        - Code: ErrRPCInvalidParameter
        - Message: "Invalid number of blocks"
    end note
else Valid Block Count
    RPC -> AddrVal : ValidateAddress(address)
    activate AddrVal

    alt Invalid Address
        AddrVal --> RPC : Return error
        RPC -> Client : Return error
        note right
            Error response:
            - Code: ErrRPCInvalidAddressOrKey
            - Message: "Invalid address"
        end note
    else Valid Address
        AddrVal --> RPC : Return valid address script
        deactivate AddrVal

        RPC -> Mining : SetupMiningParams(address, maxtries)
        activate Mining
        Mining --> RPC : Return mining configuration
        deactivate Mining

        loop nblocks times
            RPC -> Mining : GenerateBlock(address)
            activate Mining
            Mining -> Blockchain : ProcessNewBlock(block)
            activate Blockchain

            alt Block Generation Failed
                Blockchain --> Mining : Return error
                Mining --> RPC : Return error
                RPC -> Client : Return partial results with error
                note right
                    Error response:
                    - Generated block hashes up to failure
                    - Error message describing failure
                end note
            else Block Added Successfully
                Blockchain --> Mining : Return success
                Mining --> RPC : Return block hash
                RPC -> RPC : Store block hash
            end
            deactivate Blockchain
            deactivate Mining
        end

        RPC -> Client : Return array of block hashes
        note right
            Response fields:
            - Array of strings (block hashes)
            - Each hash represents a generated block
            - All blocks have coinbase rewards to specified address
        end note
    end
end

deactivate RPC

left footer Last Modified On: %date("dd-MMM-yyyy")
@enduml
