@startuml
skinparam backgroundColor #F0F8FF
skinparam defaultFontColor #333333
skinparam arrowColor #666666

' Define borders for all elements
skinparam entity {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam control {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam participant {
  BorderColor #666666
  BackgroundColor #DDDDDD
}



participant Client
participant "RPC Server" as RPC
participant "Chain Hash Parser" as Parser
participant "Blockchain Client" as Blockchain

Client -> RPC : ReconsiderBlockCmd(blockhash)
activate RPC


RPC -> Parser : NewHashFromStr(blockhash)
activate Parser

alt Invalid Hash Format
    Parser --> RPC : Return error
    RPC -> Client : Return rpcDecodeHexError
    note right
        Error response:
        - Code: ErrRPCDecodeHexString
        - Message: "Argument must be hexadecimal string"
    end note
else Valid Hash
    Parser --> RPC : Return parsed hash
    deactivate Parser

    RPC -> Blockchain : RevalidateBlock(ctx, hash)
    activate Blockchain

    note over Blockchain
        RevalidateBlock performs FULL block
        validation, not just status removal.
        This ensures the block passes all
        consensus rules before reactivation.
    end note

    Blockchain -> Blockchain : ValidateBlock(ctx, block, true)
    note right: fullValidation = true

    alt Full Validation Fails
        Blockchain --> RPC : Return error
        RPC -> Client : Return error
    else Full Validation Succeeds
        Blockchain --> RPC : Return nil
        deactivate Blockchain

        RPC -> Client : Return nil
        note right
            Response fields:
            - Returns nil on success

            Effects:
            - Block undergoes complete validation
            - Removes invalid status if validation passes
            - Descendants become eligible for inclusion
            - May trigger chain reorganization
            - Block MUST pass all consensus rules

            Important: This is now a full validation,
            not just a status change
        end note
    end
end

deactivate RPC

left footer Last Modified On: %date("dd-MMM-yyyy")
@enduml
