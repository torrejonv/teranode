@startuml
skinparam backgroundColor #F0F8FF
skinparam defaultFontColor #333333
skinparam arrowColor #666666

' Define borders for all elements
skinparam entity {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam control {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam participant {
  BorderColor #666666
  BackgroundColor #DDDDDD
}



participant Client
participant "RPC Server" as RPC
participant "UTXO Store" as UTXOStore

Client -> RPC : FreezeCmd(TxID, Vout, UTXOHash)
activate RPC

RPC -> RPC : chainhash.NewHashFromStr(TxID)
note right
  Validation:
  - TXID must be valid hex hash
end note

alt Invalid TXID Format
    RPC -> Client : Return error
else Valid TXID
    RPC -> UTXOStore : FreezeUTXOs(ctx, []*Spend{TxID, Vout, UTXOHash}, settings)
    activate UTXOStore

    alt UTXO Not Found
        UTXOStore --> RPC : Return StorageError
        RPC -> Client : Return error
    else UTXO Already Spent
        UTXOStore --> RPC : Return UtxoSpentError
        RPC -> Client : Return error
        note right
            Error includes:
            - Spending transaction ID
            - Height when spent
        end note
    else UTXO Already Frozen
        UTXOStore --> RPC : Return UtxoFrozenError
        RPC -> Client : Return error
    else Freeze Operation Succeeds
        UTXOStore --> RPC : Return nil
        RPC -> Client : Return null
        note right
            Effects:
            - UTXO marked as frozen
            - Spending transaction set to FF...FF
            - Cannot be spent until unfrozen
        end note
    end
    deactivate UTXOStore
end

deactivate RPC

left footer Last Modified On: %date("dd-MMM-yyyy")
@enduml
