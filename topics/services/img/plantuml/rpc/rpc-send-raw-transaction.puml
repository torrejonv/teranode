@startuml
skinparam backgroundColor #F0F8FF
skinparam defaultFontColor #333333
skinparam arrowColor #666666

' Define borders for all elements
skinparam entity {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam control {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam participant {
  BorderColor #666666
  BackgroundColor #DDDDDD
}



participant Client
participant "RPC Server" as RPC
participant "Distributor" as Distributor
participant "Propagation Service(s)" as Propagation

Client -> RPC : SendRawTransactionCmd(HexTx, AllowHighFees)
activate RPC

RPC -> RPC : Prepend "0" if odd length
RPC -> RPC : hex.DecodeString(hexStr)

alt If Hex Decoding Fails
    RPC -> Client : Return rpcDecodeHexError
else If Hex Decoding Succeeds
    RPC -> RPC : bt.NewTxFromBytes(serializedTx)

    alt If Parsing Fails
        RPC -> Client : Return ErrRPCDeserialization
    else If Parsing Succeeds
        RPC -> Distributor : NewDistributor(ctx, logger, settings)
        activate Distributor
        Distributor -> RPC : return distributor instance or error
        deactivate Distributor

        alt If Distributor Creation Fails
            RPC -> Client : Return ServiceError
        else If Creation Succeeds
            RPC -> Distributor : SendTransaction(ctx, tx)
            activate Distributor
            loop for each Propagation server
                Distributor -> Propagation : ProcessTransaction(ctx, tx) via gRPC
                note right: Concurrent calls\nwith retry logic
            end
            Distributor -> RPC : return ResponseWrapper[] or error
            deactivate Distributor

            alt If Too Many Servers Fail
                RPC -> Client : Return ErrRPCInvalidParameter
            else If Success Threshold Met
                RPC -> Client : Return ResponseWrapper[]
                note right
                Response contains:
                - Server addresses
                - Durations
                - Retry counts
                - Any errors
                end note
            end
        end
    end
end

deactivate RPC

left footer Last Modified On: %date("dd-MMM-yyyy")

@enduml
