<svg contentStyleType="text/css" height="1298" preserveAspectRatio="none" viewBox="0 0 1376 1298" width="1376" xmlns="http://www.w3.org/2000/svg" zoomAndPan="magnify"><path d="m0 0h1376v1298h-1376z" fill="#f0f8ff"/><g fill="#fff"><path d="m52.543 106.7988h10v1091.0059h-10z" stroke="#181818"/><path d="m57.543 251.041h10v63.6211h-10z" stroke="#181818"/><path d="m57.543 480.9043h10v102.9316h-10z" stroke="#181818"/><path d="m57.543 656.457h10v164.5527h-10z" stroke="#181818"/><path d="m814.458 480.9043h10v102.9316h-10z" stroke="#181818"/><path d="m814.458 690.7676h10v130.2422h-10z" stroke="#181818"/><path d="m1064.3564 720.0781h10v29.3105h-10z" stroke="#181818"/><path d="m1164.5889 141.1094h10v29.3105h-10z" stroke="#181818"/><path d="m1164.5889 1183.8047h10v14h-10z" stroke="#181818"/><path d="m1291.0313 285.3516h10v29.3105h-10z" stroke="#181818"/></g><path d="m10 500.9043h872.5586v75.9316h-872.5586z" fill="none" stroke="#000" stroke-width="1.5"/><path d="m10 964.9414h756.3574v60.6211h-756.3574z" fill="none" stroke="#000" stroke-width="1.5"/><path d="m57 67.4883v1148.3164" stroke="#181818" stroke-dasharray="5 5" stroke-width=".5"/><path d="m709.1377 67.4883v1148.3164" stroke="#181818" stroke-dasharray="5 5" stroke-width=".5"/><path d="m819.3574 67.4883v1148.3164" stroke="#181818" stroke-dasharray="5 5" stroke-width=".5"/><path d="m1068.5933 67.4883v1148.3164" stroke="#181818" stroke-dasharray="5 5" stroke-width=".5"/><path d="m1169.1196 67.4883v1148.3164" stroke="#181818" stroke-dasharray="5 5" stroke-width=".5"/><path d="m1295.0581 67.4883v1148.3164" stroke="#181818" stroke-dasharray="5 5" stroke-width=".5"/><rect fill="#ddd" height="30.4883" rx="2.5" stroke="#666" stroke-width=".5" width="75.0859" x="20" y="36"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.0859" x="27" y="56.5352">Validator</text><rect fill="#ddd" height="30.4883" rx="2.5" stroke="#666" stroke-width=".5" width="75.0859" x="20" y="1214.8047"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.0859" x="27" y="1235.3398">Validator</text><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2197" x="663.1377" y="64.5352">Subtree Data</text><ellipse cx="709.7476" cy="35" fill="#ddd" rx="12" ry="12" stroke="#666" stroke-width=".5"/><path d="m697.7476 49h24" stroke="#666" stroke-width=".5"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.2197" x="663.1377" y="1228.3398">Subtree Data</text><ellipse cx="709.7476" cy="1247.293" fill="#ddd" rx="12" ry="12" stroke="#666" stroke-width=".5"/><path d="m697.7476 1261.293h24" stroke="#666" stroke-width=".5"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.2012" x="766.3574" y="64.5352">Tx Meta Cache</text><path d="m801.458 15c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10z" fill="#e2e2f0" stroke="#181818" stroke-width="1.5"/><path d="m801.458 15c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#181818" stroke-width="1.5"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100.2012" x="766.3574" y="1228.3398">Tx Meta Cache</text><path d="m801.458 1241.293c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10z" fill="#e2e2f0" stroke="#181818" stroke-width="1.5"/><path d="m801.458 1241.293c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#181818" stroke-width="1.5"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.5264" x="1027.5933" y="64.5352">UTXO Store</text><path d="m1051.3564 15c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10z" fill="#e2e2f0" stroke="#181818" stroke-width="1.5"/><path d="m1051.3564 15c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#181818" stroke-width="1.5"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.5264" x="1027.5933" y="1228.3398">UTXO Store</text><path d="m1051.3564 1241.293c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10z" fill="#e2e2f0" stroke="#181818" stroke-width="1.5"/><path d="m1051.3564 1241.293c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#181818" stroke-width="1.5"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9385" x="1121.1196" y="64.5352">Subtree Store</text><path d="m1151.5889 15c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10z" fill="#e2e2f0" stroke="#181818" stroke-width="1.5"/><path d="m1151.5889 15c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#181818" stroke-width="1.5"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9385" x="1121.1196" y="1228.3398">Subtree Store</text><path d="m1151.5889 1241.293c0-10 18-10 18-10s18 0 18 10v26c0 10-18 10-18 10s-18 0-18-10z" fill="#e2e2f0" stroke="#181818" stroke-width="1.5"/><path d="m1151.5889 1241.293c0 10 18 10 18 10s18 0 18-10" fill="none" stroke="#181818" stroke-width="1.5"/><rect fill="#ddd" height="30.4883" rx="2.5" stroke="#666" stroke-width=".5" width="135.9463" x="1228.0581" y="36"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.9463" x="1235.0581" y="56.5352">Util HTTP Request</text><rect fill="#ddd" height="30.4883" rx="2.5" stroke="#666" stroke-width=".5" width="135.9463" x="1228.0581" y="1214.8047"/><text fill="#333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.9463" x="1235.0581" y="1235.3398">Util HTTP Request</text><path d="m52.543 106.7988h10v1091.0059h-10z" fill="#fff" stroke="#181818"/><path d="m57.543 251.041h10v63.6211h-10z" fill="#fff" stroke="#181818"/><path d="m57.543 480.9043h10v102.9316h-10z" fill="#fff" stroke="#181818"/><path d="m57.543 656.457h10v164.5527h-10z" fill="#fff" stroke="#181818"/><path d="m814.458 480.9043h10v102.9316h-10z" fill="#fff" stroke="#181818"/><path d="m814.458 690.7676h10v130.2422h-10z" fill="#fff" stroke="#181818"/><path d="m1064.3564 720.0781h10v29.3105h-10z" fill="#fff" stroke="#181818"/><path d="m1164.5889 141.1094h10v29.3105h-10z" fill="#fff" stroke="#181818"/><path d="m1164.5889 1183.8047h10v14h-10z" fill="#fff" stroke="#181818"/><path d="m1291.0313 285.3516h10v29.3105h-10z" fill="#fff" stroke="#181818"/><path d="m57.543 93.7988h47" stroke="#666"/><path d="m104.543 93.7988v13" stroke="#666"/><path d="m63.543 106.7988h41" stroke="#666"/><path d="m73.543 102.7988-10 4 10 4-4-4z" fill="#666" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279.8047" x="69.543" y="89.0566">ValidateSubtreeInternal(ctx, validateSubtree)</text><path d="m1152.5889 137.1094 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m62.543 141.1094h1096.0459" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281.0679" x="69.543" y="136.3672">subtreeStore.Exists(spanCtx, subtreeHash[:])</text><path d="m73.543 166.4199-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m67.543 170.4199h1101.0459" stroke="#666" stroke-dasharray="2 2"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.3618" x="79.543" y="165.6777">subtreeExists / err</text><path d="m0 199.0752h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 199.0752h1369.0044" stroke="#000"/><path d="m0 202.0752h1369.0044" stroke="#000"/><path d="m520.5723 188.4199h327.8599v23.3105h-327.8599z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="305.2905" x="526.5723" y="204.9883">Get the Subtree from the remote Asset Server</text><path d="m62.543 238.041h47" stroke="#666"/><path d="m109.543 238.041v13" stroke="#666"/><path d="m68.543 251.041h41" stroke="#666"/><path d="m78.543 247.041-10 4 10 4-4-4z" fill="#666" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="332.0649" x="74.543" y="233.2988">getSubtreeTxHashes(ctx, stat, subtreeHash, baseUrl)</text><path d="m1279.0313 281.3516 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m67.543 285.3516h1217.4883" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260.8823" x="74.543" y="280.6094">DoHTTPRequestBodyReader(spanCtx, url)</text><path d="m73.543 310.6621-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m67.543 314.6621h1227.4883" stroke="#666" stroke-dasharray="2 2"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.4692" x="79.543" y="309.9199">subtree / err</text><path d="m0 343.3174h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 343.3174h1369.0044" stroke="#000"/><path d="m0 346.3174h1369.0044" stroke="#000"/><path d="m510.927 332.6621h347.1504v23.3105h-347.1504z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="324.5811" x="516.927" y="349.2305">Create a subtree metadata (a decorated subtree)</text><path d="m62.543 387.2832h42" stroke="#666"/><path d="m104.543 387.2832v13" stroke="#666"/><path d="m63.543 400.2832h41" stroke="#666"/><path d="m73.543 396.2832-10 4 10 4-4-4z" fill="#666" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.5498" x="69.543" y="382.541">Create a subtreeMeta from the subtree</text><path d="m0 428.9385h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 428.9385h1369.0044" stroke="#000"/><path d="m0 431.9385h1369.0044" stroke="#000"/><path d="m412.7192 418.2832h543.5659v23.3105h-543.5659z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="520.9966" x="418.7192" y="434.8516">Attempt to obtain the Tx Metadata for all txs through the existing meta cache</text><path d="m62.543 467.9043h47" stroke="#666"/><path d="m109.543 467.9043v13" stroke="#666"/><path d="m68.543 480.9043h41" stroke="#666"/><path d="m78.543 476.9043-10 4 10 4-4-4z" fill="#666" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396.6333" x="74.543" y="463.1621">processTxMetaUsingCache(ctx, txHashes, txMetaSlice, failFast)</text><path d="m10 500.9043h74.4468v7.3105l-10 10h-64.4468z" fill="#eee" stroke="#000" stroke-width="1.5"/><path d="m10 500.9043h872.5586v75.9316h-872.5586z" fill="none" stroke="#000" stroke-width="1.5"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="25" y="514.4727">loop</text><text fill="#333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="180.3184" x="99.4468" y="513.5391">[for each txHash in the subtree]</text><path d="m802.458 535.5254 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m67.543 539.5254h740.915" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.25" x="74.543" y="534.7832">GetMetaCached(gCtx, &amp;txHash)</text><path d="m78.543 564.8359-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m72.543 568.8359h740.915" stroke="#666" stroke-dasharray="2 2"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76.2417" x="84.543" y="564.0938">txMeta / err</text><path d="m0 604.4912h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 604.4912h1369.0044" stroke="#000"/><path d="m0 607.4912h1369.0044" stroke="#000"/><path d="m417.9053 593.8359h533.1938v23.3105h-533.1938z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="510.6245" x="423.9053" y="610.4043">For any Tx Metadata not found in the cache, obtain it directly from the store</text><path d="m62.543 643.457h47" stroke="#666"/><path d="m109.543 643.457v13" stroke="#666"/><path d="m68.543 656.457h41" stroke="#666"/><path d="m78.543 652.457-10 4 10 4-4-4z" fill="#666" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="449.5029" x="74.543" y="638.7148">processTxMetaUsingStore(ctx, txHashes, txMetaSlice, batched, failFast)</text><path d="m802.458 686.7676 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m67.543 690.7676h740.915" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.8984" x="74.543" y="686.0254">MetaBatchDecorate(gCtx, &amp;txHash)</text><path d="m1052.3564 716.0781 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m824.458 720.0781h233.8984" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.8984" x="831.458" y="715.3359">MetaBatchDecorate(gCtx, &amp;txHash)</text><path d="m835.458 745.3887-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m829.458 749.3887h238.8984" stroke="#666" stroke-dasharray="2 2"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76.2417" x="841.458" y="744.6465">txMeta / err</text><path d="m824.458 778.6992h42" stroke="#666"/><path d="m866.458 778.6992v13" stroke="#666"/><path d="m825.458 791.6992h41" stroke="#666"/><path d="m835.458 787.6992-10 4 10 4-4-4z" fill="#666" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.4131" x="831.458" y="773.957">SetCache(&amp;data.Hash, data.Data)</text><path d="m73.543 817.0098-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m67.543 821.0098h750.915" stroke="#666" stroke-dasharray="2 2"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76.2417" x="79.543" y="816.2676">txMeta / err</text><path d="m0 849.665h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 849.665h1369.0044" stroke="#000"/><path d="m0 852.665h1369.0044" stroke="#000"/><path d="m419.5303 839.0098h529.9438v23.3105h-529.9438z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="511.6592" x="425.5303" y="855.5781">If a transaction is unknown by the node, do request it from the remote node</text><path d="m62.543 893.6309h42" stroke="#666"/><path d="m104.543 893.6309v13" stroke="#666"/><path d="m63.543 906.6309h41" stroke="#666"/><path d="m73.543 902.6309-10 4 10 4-4-4z" fill="#666" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="618.2046" x="69.543" y="888.8887">processMissingTransactions(ctx, subtreeHash, missingTxHashesCompacted, baseUrl, txMetaSlice)</text><path d="m0 935.2861h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 935.2861h1369.0044" stroke="#000"/><path d="m0 938.2861h1369.0044" stroke="#000"/><path d="m474.4597 924.6309h420.085v23.3105h-420.085z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="401.8003" x="480.4597" y="941.1992">Add all decorated (with tx meta) transactions to the subtree</text><path d="m10 964.9414h74.4468v7.3106l-10 10h-64.4468z" fill="#eee" stroke="#000" stroke-width="1.5"/><path d="m10 964.9414h756.3574v60.6211h-756.3574z" fill="none" stroke="#000" stroke-width="1.5"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="25" y="978.5098">loop</text><text fill="#333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151.8247" x="99.4468" y="977.5762">[for each tx in the subtree]</text><path d="m697.7476 999.5625 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m62.543 1003.5625h641.2046" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="502.9692" x="69.543" y="998.8203">Add transaction to Subtree - AddNode(txHash, txMeta.Fee, txMeta.SizeInBytes)</text><path d="m73.543 1013.5625-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m67.543 1017.5625h641.2046" stroke="#666" stroke-dasharray="2 2"/><path d="m0 1053.2178h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 1053.2178h1369.0044" stroke="#000"/><path d="m0 1056.2178h1369.0044" stroke="#000"/><path d="m528.2847 1042.5625h312.4351v23.3105h-312.4351z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="294.1504" x="534.2847" y="1059.1309">Add meta data required for block validation</text><path d="m697.7476 1093.1836 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m62.543 1097.1836h641.2046" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="353.355" x="69.543" y="1092.4414">SetParentTxHashes(subtreeIdx, txMeta.ParentTxHashes)</text><path d="m73.543 1107.1836-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m67.543 1111.1836h641.2046" stroke="#666" stroke-dasharray="2 2"/><path d="m0 1139.8389h1369.0044v3h-1369.0044z" fill="#eee" stroke="#eee"/><path d="m0 1139.8389h1369.0044" stroke="#000"/><path d="m0 1142.8389h1369.0044" stroke="#000"/><path d="m576.6633 1129.1836h215.6777v23.3105h-215.6777z" fill="#eee" stroke="#000" stroke-width="2"/><text fill="#333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197.3931" x="582.6633" y="1145.752">Persist the decorated subtree</text><path d="m1152.5889 1179.8047 10 4-10 4 4-4z" fill="#666" stroke="#666"/><path d="m62.543 1183.8047h1096.0459" stroke="#666"/><text fill="#333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319.8076" x="69.543" y="1179.0625">Set(spanCtx, merkleRoot[:], completeSubtreeBytes)</text><path d="m68.543 1193.8047-10 4 10 4-4-4z" fill="#666" stroke="#666"/><path d="m62.543 1197.8047h1106.0459" stroke="#666" stroke-dasharray="2 2"/><text fill="#333" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="155.4932" y="1287.9609">Last Modified On: 07-Apr-2025</text></svg>
