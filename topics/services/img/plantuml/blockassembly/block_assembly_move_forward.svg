<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2337px" preserveAspectRatio="none" style="width:1046px;height:2337px;background:#F0F8FF;" version="1.1" viewBox="0 0 1046 2337" width="1046px" zoomAndPan="magnify"><defs/><g><rect fill="#F0F8FF" height="2337" style="stroke:none;stroke-width:1;" width="1046" x="0" y="0"/><g><title>Blockchain Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="322.3789" y="114.1094"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="1802.793" style="stroke:#181818;stroke-width:1;" width="10" x="465.3721" y="246.3516"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="1723.1719" style="stroke:#181818;stroke-width:1;" width="10" x="470.3721" y="325.9727"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="114.2422" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="481.2148"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="675.0781"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="392.3711" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="852.6309"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1324.623"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1502.1758"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="155.5527" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1679.7285"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1914.9023"/></g><g><title>Subtree Store</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="898.4517" y="935.5625"/></g><g><title>UTXO Store</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="998.6841" y="530.8359"/></g><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="241.6533" x="10" y="158.4199"/><rect fill="none" height="338.0605" style="stroke:#000000;stroke-width:1.5;" width="599.3853" x="372.5356" y="872.6309"/><rect fill="none" height="149.5527" style="stroke:#000000;stroke-width:1.5;" width="579.3853" x="382.5356" y="896.9414"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="224.2847" x="392.5356" y="979.873"/><rect fill="none" height="174.5078" style="stroke:#000000;stroke-width:1.5;" width="224.1274" x="10" y="2064.1445"/><g><title>Block Assembler</title><rect fill="#000000" fill-opacity="0.00000" height="2188.1641" width="8" x="78.8359" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="82" x2="82" y1="67.4883" y2="2255.6523"/></g><g><title>Blockchain Client</title><rect fill="#000000" fill-opacity="0.00000" height="2188.1641" width="8" x="323.3789" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="327.2222" x2="327.2222" y1="67.4883" y2="2255.6523"/></g><g><title>Subtree Processor</title><rect fill="#000000" fill-opacity="0.00000" height="2188.1641" width="8" x="466.3721" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="469.5356" x2="469.5356" y1="67.4883" y2="2255.6523"/></g><g><title>Subtree Store</title><rect fill="#000000" fill-opacity="0.00000" height="2188.1641" width="8" x="899.4517" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="902.9824" x2="902.9824" y1="67.4883" y2="2255.6523"/></g><g><title>UTXO Store</title><rect fill="#000000" fill-opacity="0.00000" height="2188.1641" width="8" x="999.6841" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1002.9209" x2="1002.9209" y1="67.4883" y2="2255.6523"/></g><g class="participant participant-head" data-participant="BA"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="125.6719" x="20" y="36"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.6719" x="27" y="56.5352">Block Assembler</text></g><g class="participant participant-tail" data-participant="BA"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="125.6719" x="20" y="2254.6523"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.6719" x="27" y="2275.1875">Block Assembler</text></g><g class="participant participant-head" data-participant="BC"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="130.3135" x="262.2222" y="36"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.3135" x="269.2222" y="56.5352">Blockchain Client</text></g><g class="participant participant-tail" data-participant="BC"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="130.3135" x="262.2222" y="2254.6523"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.3135" x="269.2222" y="2275.1875">Blockchain Client</text></g><g class="participant participant-head" data-participant="STP"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="135.6729" x="402.5356" y="36"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.6729" x="409.5356" y="56.5352">Subtree Processor</text></g><g class="participant participant-tail" data-participant="STP"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="135.6729" x="402.5356" y="2254.6523"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.6729" x="409.5356" y="2275.1875">Subtree Processor</text></g><g class="participant participant-head" data-participant="SStore"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9385" x="854.9824" y="64.5352">Subtree Store</text><path d="M885.4517,15 C885.4517,5 903.4517,5 903.4517,5 C903.4517,5 921.4517,5 921.4517,15 L921.4517,41 C921.4517,51 903.4517,51 903.4517,51 C903.4517,51 885.4517,51 885.4517,41 L885.4517,15" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M885.4517,15 C885.4517,25 903.4517,25 903.4517,25 C903.4517,25 921.4517,25 921.4517,15" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="SStore"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9385" x="854.9824" y="2268.1875">Subtree Store</text><path d="M885.4517,2281.1406 C885.4517,2271.1406 903.4517,2271.1406 903.4517,2271.1406 C903.4517,2271.1406 921.4517,2271.1406 921.4517,2281.1406 L921.4517,2307.1406 C921.4517,2317.1406 903.4517,2317.1406 903.4517,2317.1406 C903.4517,2317.1406 885.4517,2317.1406 885.4517,2307.1406 L885.4517,2281.1406" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M885.4517,2281.1406 C885.4517,2291.1406 903.4517,2291.1406 903.4517,2291.1406 C903.4517,2291.1406 921.4517,2291.1406 921.4517,2281.1406" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="UTXOStore"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.5264" x="961.9209" y="64.5352">UTXO Store</text><path d="M985.6841,15 C985.6841,5 1003.6841,5 1003.6841,5 C1003.6841,5 1021.6841,5 1021.6841,15 L1021.6841,41 C1021.6841,51 1003.6841,51 1003.6841,51 C1003.6841,51 985.6841,51 985.6841,41 L985.6841,15" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M985.6841,15 C985.6841,25 1003.6841,25 1003.6841,25 C1003.6841,25 1021.6841,25 1021.6841,15" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="UTXOStore"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.5264" x="961.9209" y="2268.1875">UTXO Store</text><path d="M985.6841,2281.1406 C985.6841,2271.1406 1003.6841,2271.1406 1003.6841,2271.1406 C1003.6841,2271.1406 1021.6841,2271.1406 1021.6841,2281.1406 L1021.6841,2307.1406 C1021.6841,2317.1406 1003.6841,2317.1406 1003.6841,2317.1406 C1003.6841,2317.1406 985.6841,2317.1406 985.6841,2307.1406 L985.6841,2281.1406" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M985.6841,2281.1406 C985.6841,2291.1406 1003.6841,2291.1406 1003.6841,2291.1406 C1003.6841,2291.1406 1021.6841,2291.1406 1021.6841,2281.1406" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g><title>Blockchain Client</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="322.3789" y="114.1094"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="1802.793" style="stroke:#181818;stroke-width:1;" width="10" x="465.3721" y="246.3516"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="1723.1719" style="stroke:#181818;stroke-width:1;" width="10" x="470.3721" y="325.9727"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="114.2422" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="481.2148"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="675.0781"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="392.3711" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="852.6309"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1324.623"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1502.1758"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="155.5527" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1679.7285"/></g><g><title>Subtree Processor</title><rect fill="#FFFFFF" height="97.9316" style="stroke:#181818;stroke-width:1;" width="10" x="475.3721" y="1914.9023"/></g><g><title>Subtree Store</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="898.4517" y="935.5625"/></g><g><title>UTXO Store</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="998.6841" y="530.8359"/></g><g class="message" data-participant-1="BA" data-participant-2="BC"><polygon fill="#666666" points="310.3789,110.1094,320.3789,114.1094,310.3789,118.1094,314.3789,114.1094" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="82.8359" x2="316.3789" y1="114.1094" y2="114.1094"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82.8115" x="89.8359" y="94.0566">GetBlock(ctx,</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.543" x="89.8359" y="109.3672">bestBlockchainBlockHeader.Hash())</text></g><g class="message" data-participant-1="BC" data-participant-2="BA"><polygon fill="#666666" points="93.8359,139.4199,83.8359,143.4199,93.8359,147.4199,89.8359,143.4199" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="87.8359" x2="326.3789" y1="143.4199" y2="143.4199"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.1074" x="99.8359" y="138.6777">block / err</text></g><path d="M10,158.4199 L72.1387,158.4199 L72.1387,165.7305 L62.1387,175.7305 L10,175.7305 L10,158.4199" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="241.6533" x="10" y="158.4199"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="25" y="171.9883">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="127.021" x="87.1387" y="171.0547">[if error getting block]</text><g class="message" data-participant-1="BA" data-participant-2="BA"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="82.8359" x2="124.8359" y1="197.041" y2="197.041"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="124.8359" x2="124.8359" y1="197.041" y2="210.041"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="83.8359" x2="124.8359" y1="210.041" y2="210.041"/><polygon fill="#666666" points="93.8359,206.041,83.8359,210.041,93.8359,214.041,89.8359,210.041" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.8174" x="89.8359" y="192.2988">Handle error and return</text></g><g class="message" data-participant-1="BA" data-participant-2="STP"><polygon fill="#666666" points="453.3721,242.3516,463.3721,246.3516,453.3721,250.3516,457.3721,246.3516" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="82.8359" x2="459.3721" y1="246.3516" y2="246.3516"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.2402" x="89.8359" y="241.6094">MoveForwardBlock(block)</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="475.3721" x2="517.3721" y1="275.6621" y2="275.6621"/><line style="stroke:#666666;stroke-width:1;" x1="517.3721" x2="517.3721" y1="275.6621" y2="288.6621"/><line style="stroke:#666666;stroke-width:1;" x1="476.3721" x2="517.3721" y1="288.6621" y2="288.6621"/><polygon fill="#666666" points="486.3721,284.6621,476.3721,288.6621,486.3721,292.6621,482.3721,288.6621" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.9502" x="482.3721" y="270.9199">moveForwardBlockChan &lt;- moveBlockRequest</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="475.3721" x2="522.3721" y1="312.9727" y2="312.9727"/><line style="stroke:#666666;stroke-width:1;" x1="522.3721" x2="522.3721" y1="312.9727" y2="325.9727"/><line style="stroke:#666666;stroke-width:1;" x1="481.3721" x2="522.3721" y1="325.9727" y2="325.9727"/><polygon fill="#666666" points="491.3721,321.9727,481.3721,325.9727,491.3721,329.9727,487.3721,325.9727" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296.5498" x="487.3721" y="308.2305">moveForwardBlock(ctx, block, skipNotification)</text></g><path d="M410,343.9727 L410,368.9727 L530,368.9727 L530,353.9727 L520,343.9727 L410,343.9727" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M520,343.9727 L520,353.9727 L530,353.9727 L520,343.9727" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.0488" x="416" y="361.541">Block validation</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="522.3721" y1="395.5938" y2="395.5938"/><line style="stroke:#666666;stroke-width:1;" x1="522.3721" x2="522.3721" y1="395.5938" y2="408.5938"/><line style="stroke:#666666;stroke-width:1;" x1="481.3721" x2="522.3721" y1="408.5938" y2="408.5938"/><polygon fill="#666666" points="491.3721,404.5938,481.3721,408.5938,491.3721,412.5938,487.3721,408.5938" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.1797" x="487.3721" y="390.8516">Validate block is not nil</text></g><path d="M357,421.5938 L357,446.5938 L581,446.5938 L581,431.5938 L571,421.5938 L357,421.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M571,421.5938 L571,431.5938 L581,431.5938 L571,421.5938" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.8486" x="363" y="439.1621">Step 1: Process Coinbase UTXOs</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="527.3721" y1="468.2148" y2="468.2148"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="468.2148" y2="481.2148"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="481.2148" y2="481.2148"/><polygon fill="#666666" points="496.3721,477.2148,486.3721,481.2148,496.3721,485.2148,492.3721,481.2148" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.4907" x="492.3721" y="463.4727">processCoinbaseUtxos(ctx, block)</text></g><g class="message" data-participant-1="STP" data-participant-2="UTXOStore"><polygon fill="#666666" points="986.6841,526.8359,996.6841,530.8359,986.6841,534.8359,990.6841,530.8359" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="992.6841" y1="530.8359" y2="530.8359"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.8594" x="492.3721" y="510.7832">Create coinbase UTXOs</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.9648" x="492.3721" y="526.0938">with block height and mined info</text></g><g class="message" data-participant-1="UTXOStore" data-participant-2="STP"><polygon fill="#666666" points="496.3721,556.1465,486.3721,560.1465,496.3721,564.1465,492.3721,560.1465" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="490.3721" x2="1002.6841" y1="560.1465" y2="560.1465"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.1216" x="502.3721" y="555.4043">UTXOs created / error</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="594.457" y2="594.457"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="594.457" y2="607.457"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="480.3721" x2="527.3721" y1="607.457" y2="607.457"/><polygon fill="#666666" points="490.3721,603.457,480.3721,607.457,490.3721,611.457,486.3721,607.457" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.9053" x="492.3721" y="589.7148">Coinbase processing complete</text></g><path d="M364,615.457 L364,640.457 L576,640.457 L576,625.457 L566,615.457 L364,615.457" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M566,615.457 L566,625.457 L576,625.457 L566,615.457" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.7437" x="370" y="633.0254">Step 2: Process Block Subtrees</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="527.3721" y1="662.0781" y2="662.0781"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="662.0781" y2="675.0781"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="675.0781" y2="675.0781"/><polygon fill="#666666" points="496.3721,671.0781,486.3721,675.0781,496.3721,679.0781,492.3721,675.0781" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.3022" x="492.3721" y="657.3359">processBlockSubtrees(block)</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="724.6992" y2="724.6992"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="724.6992" y2="737.6992"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="737.6992" y2="737.6992"/><polygon fill="#666666" points="496.3721,733.6992,486.3721,737.6992,496.3721,741.6992,492.3721,737.6992" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.2402" x="492.3721" y="704.6465">Create blockSubtreesMap</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.0771" x="492.3721" y="719.957">and filter chainedSubtrees</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="772.0098" y2="772.0098"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="772.0098" y2="785.0098"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="480.3721" x2="527.3721" y1="785.0098" y2="785.0098"/><polygon fill="#666666" points="490.3721,781.0098,480.3721,785.0098,490.3721,789.0098,486.3721,785.0098" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227.2144" x="492.3721" y="767.2676">blockSubtreesMap, chainedSubtrees</text></g><path d="M361,793.0098 L361,818.0098 L579,818.0098 L579,803.0098 L569,793.0098 L361,793.0098" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M569,793.0098 L569,803.0098 L579,803.0098 L569,793.0098" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.3994" x="367" y="810.5781">Step 3: Create Transaction Map</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="527.3721" y1="839.6309" y2="839.6309"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="839.6309" y2="852.6309"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="852.6309" y2="852.6309"/><polygon fill="#666666" points="496.3721,848.6309,486.3721,852.6309,496.3721,856.6309,492.3721,852.6309" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="389.0796" x="492.3721" y="834.8887">createTransactionMapIfNeeded(ctx, block, blockSubtreesMap)</text></g><path d="M372.5356,872.6309 L434.6743,872.6309 L434.6743,879.9414 L424.6743,889.9414 L372.5356,889.9414 L372.5356,872.6309" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="338.0605" style="stroke:#000000;stroke-width:1.5;" width="599.3853" x="372.5356" y="872.6309"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="387.5356" y="886.1992">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="343.3525" x="449.6743" y="885.2656">[if blockSubtreesMap is not empty (block from other nodes)]</text><path d="M382.5356,896.9414 L456.9824,896.9414 L456.9824,904.252 L446.9824,914.252 L382.5356,914.252 L382.5356,896.9414" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="149.5527" style="stroke:#000000;stroke-width:1.5;" width="579.3853" x="382.5356" y="896.9414"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="397.5356" y="910.5098">loop</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="222.9272" x="471.9824" y="909.5762">[for each subtree in blockSubtreesMap]</text><g class="message" data-participant-1="STP" data-participant-2="SStore"><polygon fill="#666666" points="886.4517,931.5625,896.4517,935.5625,886.4517,939.5625,890.4517,935.5625" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="892.4517" y1="935.5625" y2="935.5625"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.8442" x="492.3721" y="930.8203">GetSubtree(subtreeHash)</text></g><g class="message" data-participant-1="SStore" data-participant-2="STP"><polygon fill="#666666" points="496.3721,960.873,486.3721,964.873,496.3721,968.873,492.3721,964.873" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="490.3721" x2="902.4517" y1="964.873" y2="964.873"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.29" x="502.3721" y="960.1309">subtree data / error</text></g><path d="M392.5356,979.873 L454.6743,979.873 L454.6743,987.1836 L444.6743,997.1836 L392.5356,997.1836 L392.5356,979.873" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:1.5;" width="224.2847" x="392.5356" y="979.873"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="407.5356" y="993.4414">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="142.146" x="469.6743" y="992.5078">[if subtree retrieval fails]</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="1018.4941" y2="1018.4941"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="1018.4941" y2="1031.4941"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="486.3721" x2="527.3721" y1="1031.4941" y2="1031.4941"/><polygon fill="#666666" points="496.3721,1027.4941,486.3721,1031.4941,496.3721,1035.4941,492.3721,1031.4941" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.0796" x="492.3721" y="1013.752">Return error</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1090.1152" y2="1090.1152"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1090.1152" y2="1103.1152"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1103.1152" y2="1103.1152"/><polygon fill="#666666" points="496.3721,1099.1152,486.3721,1103.1152,496.3721,1107.1152,492.3721,1103.1152" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.1431" x="492.3721" y="1070.0625">Deserialize subtrees and</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.7964" x="492.3721" y="1085.373">create transaction map</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1132.4258" y2="1132.4258"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1132.4258" y2="1145.4258"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1145.4258" y2="1145.4258"/><polygon fill="#666666" points="496.3721,1141.4258,486.3721,1145.4258,496.3721,1149.4258,492.3721,1145.4258" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.6919" x="492.3721" y="1127.6836">Extract conflicting nodes</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="372.5356" x2="971.9209" y1="1154.4258" y2="1154.4258"/><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="163.1309" x="377.5356" y="1165.0605">[block from our own mining]</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1189.6914" y2="1189.6914"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1189.6914" y2="1202.6914"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1202.6914" y2="1202.6914"/><polygon fill="#666666" points="496.3721,1198.6914,486.3721,1202.6914,496.3721,1206.6914,492.3721,1202.6914" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.1992" x="492.3721" y="1184.9492">Use existing chainedSubtrees</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="1244.002" y2="1244.002"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="1244.002" y2="1257.002"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="480.3721" x2="527.3721" y1="1257.002" y2="1257.002"/><polygon fill="#666666" points="490.3721,1253.002,480.3721,1257.002,490.3721,1261.002,486.3721,1257.002" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211.4531" x="492.3721" y="1239.2598">transactionMap, conflictingNodes</text></g><path d="M333,1265.002 L333,1290.002 L607,1290.002 L607,1275.002 L597,1265.002 L333,1265.002" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M597,1265.002 L597,1275.002 L607,1275.002 L597,1265.002" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253.0684" x="339" y="1282.5703">Step 4: Process Conflicting Transactions</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="527.3721" y1="1311.623" y2="1311.623"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1311.623" y2="1324.623"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1324.623" y2="1324.623"/><polygon fill="#666666" points="496.3721,1320.623,486.3721,1324.623,496.3721,1328.623,492.3721,1324.623" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="382.6748" x="492.3721" y="1306.8809">processConflictingTransactions(ctx, block, conflictingNodes)</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1374.2441" y2="1374.2441"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1374.2441" y2="1387.2441"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1387.2441" y2="1387.2441"/><polygon fill="#666666" points="496.3721,1383.2441,486.3721,1387.2441,496.3721,1391.2441,492.3721,1387.2441" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1519" x="492.3721" y="1354.1914">Identify losing transactions</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.2686" x="492.3721" y="1369.502">and mark as conflicting</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="1421.5547" y2="1421.5547"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="1421.5547" y2="1434.5547"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="480.3721" x2="527.3721" y1="1434.5547" y2="1434.5547"/><polygon fill="#666666" points="490.3721,1430.5547,480.3721,1434.5547,490.3721,1438.5547,486.3721,1434.5547" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.3501" x="492.3721" y="1416.8125">losingTxHashesMap</text></g><path d="M375,1442.5547 L375,1467.5547 L565,1467.5547 L565,1452.5547 L555,1442.5547 L375,1442.5547" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M555,1442.5547 L555,1452.5547 L565,1452.5547 L555,1442.5547" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.3364" x="381" y="1460.123">Step 5: Reset Subtree State</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="527.3721" y1="1489.1758" y2="1489.1758"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1489.1758" y2="1502.1758"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1502.1758" y2="1502.1758"/><polygon fill="#666666" points="496.3721,1498.1758,486.3721,1502.1758,496.3721,1506.1758,492.3721,1502.1758" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.8154" x="492.3721" y="1484.4336">resetSubtreeState()</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1551.7969" y2="1551.7969"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1551.7969" y2="1564.7969"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1564.7969" y2="1564.7969"/><polygon fill="#666666" points="496.3721,1560.7969,486.3721,1564.7969,496.3721,1568.7969,492.3721,1564.7969" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.5034" x="492.3721" y="1531.7441">Reset current subtree</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.7207" x="492.3721" y="1547.0547">and transaction map</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="1599.1074" y2="1599.1074"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="1599.1074" y2="1612.1074"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="480.3721" x2="527.3721" y1="1612.1074" y2="1612.1074"/><polygon fill="#666666" points="490.3721,1608.1074,480.3721,1612.1074,490.3721,1616.1074,486.3721,1612.1074" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.9727" x="492.3721" y="1594.3652">currentSubtree, currentTxMap</text></g><path d="M334,1620.1074 L334,1645.1074 L606,1645.1074 L606,1630.1074 L596,1620.1074 L334,1620.1074" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M596,1620.1074 L596,1630.1074 L606,1630.1074 L596,1620.1074" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.6211" x="340" y="1637.6758">Step 6: Process Remainder Transactions</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="527.3721" y1="1666.7285" y2="1666.7285"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1666.7285" y2="1679.7285"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1679.7285" y2="1679.7285"/><polygon fill="#666666" points="496.3721,1675.7285,486.3721,1679.7285,496.3721,1683.7285,492.3721,1679.7285" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279.3413" x="492.3721" y="1661.9863">processRemainderTransactions(ctx, params)</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1729.3496" y2="1729.3496"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1729.3496" y2="1742.3496"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1742.3496" y2="1742.3496"/><polygon fill="#666666" points="496.3721,1738.3496,486.3721,1742.3496,496.3721,1746.3496,492.3721,1742.3496" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.2158" x="492.3721" y="1709.2969">Process transactions not in block</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.1484" x="492.3721" y="1724.6074">from chainedSubtrees and currentSubtree</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1786.9707" y2="1786.9707"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1786.9707" y2="1799.9707"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1799.9707" y2="1799.9707"/><polygon fill="#666666" points="496.3721,1795.9707,486.3721,1799.9707,496.3721,1803.9707,492.3721,1799.9707" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.9316" x="492.3721" y="1766.918">Handle transaction conflicts</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.8027" x="492.3721" y="1782.2285">and update subtree state</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="1834.2813" y2="1834.2813"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="1834.2813" y2="1847.2813"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="480.3721" x2="527.3721" y1="1847.2813" y2="1847.2813"/><polygon fill="#666666" points="490.3721,1843.2813,480.3721,1847.2813,490.3721,1851.2813,486.3721,1847.2813" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.7588" x="492.3721" y="1829.5391">Processing complete</text></g><path d="M357,1855.2813 L357,1880.2813 L583,1880.2813 L583,1865.2813 L573,1855.2813 L357,1855.2813" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M573,1855.2813 L573,1865.2813 L583,1865.2813 L573,1855.2813" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.3149" x="363" y="1872.8496">Step 7: Finalize Block Processing</text><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="480.3721" x2="527.3721" y1="1901.9023" y2="1901.9023"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1901.9023" y2="1914.9023"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1914.9023" y2="1914.9023"/><polygon fill="#666666" points="496.3721,1910.9023,486.3721,1914.9023,496.3721,1918.9023,492.3721,1914.9023" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217.4072" x="492.3721" y="1897.1602">finalizeBlockProcessing(ctx, block)</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;" x1="485.3721" x2="527.3721" y1="1964.5234" y2="1964.5234"/><line style="stroke:#666666;stroke-width:1;" x1="527.3721" x2="527.3721" y1="1964.5234" y2="1977.5234"/><line style="stroke:#666666;stroke-width:1;" x1="486.3721" x2="527.3721" y1="1977.5234" y2="1977.5234"/><polygon fill="#666666" points="496.3721,1973.5234,486.3721,1977.5234,496.3721,1981.5234,492.3721,1977.5234" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.9106" x="492.3721" y="1944.4707">Update internal state</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.7773" x="492.3721" y="1959.7813">and perform cleanup</text></g><g class="message" data-participant-1="STP" data-participant-2="STP"><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="485.3721" x2="527.3721" y1="2011.834" y2="2011.834"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="527.3721" x2="527.3721" y1="2011.834" y2="2024.834"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="480.3721" x2="527.3721" y1="2024.834" y2="2024.834"/><polygon fill="#666666" points="490.3721,2020.834,480.3721,2024.834,490.3721,2028.834,486.3721,2024.834" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.9766" x="492.3721" y="2007.0918">Finalization complete</text></g><g class="message" data-participant-1="STP" data-participant-2="BA"><polygon fill="#666666" points="93.8359,2045.1445,83.8359,2049.1445,93.8359,2053.1445,89.8359,2049.1445" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="87.8359" x2="469.3721" y1="2049.1445" y2="2049.1445"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.8135" x="99.8359" y="2044.4023">nil / error</text></g><path d="M10,2064.1445 L72.1387,2064.1445 L72.1387,2071.4551 L62.1387,2081.4551 L10,2081.4551 L10,2064.1445" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="174.5078" style="stroke:#000000;stroke-width:1.5;" width="224.1274" x="10" y="2064.1445"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="25" y="2077.7129">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="66.2632" x="87.1387" y="2076.7793">[if no error]</text><g class="message" data-participant-1="BA" data-participant-2="BA"><line style="stroke:#666666;stroke-width:1;" x1="82.8359" x2="124.8359" y1="2102.7656" y2="2102.7656"/><line style="stroke:#666666;stroke-width:1;" x1="124.8359" x2="124.8359" y1="2102.7656" y2="2115.7656"/><line style="stroke:#666666;stroke-width:1;" x1="83.8359" x2="124.8359" y1="2115.7656" y2="2115.7656"/><polygon fill="#666666" points="93.8359,2111.7656,83.8359,2115.7656,93.8359,2119.7656,89.8359,2115.7656" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.2915" x="89.8359" y="2098.0234">UpdateBestBlock(ctx)</text></g><g class="message" data-participant-1="BA" data-participant-2="BA"><line style="stroke:#666666;stroke-width:1;" x1="82.8359" x2="124.8359" y1="2145.0762" y2="2145.0762"/><line style="stroke:#666666;stroke-width:1;" x1="124.8359" x2="124.8359" y1="2145.0762" y2="2158.0762"/><line style="stroke:#666666;stroke-width:1;" x1="83.8359" x2="124.8359" y1="2158.0762" y2="2158.0762"/><polygon fill="#666666" points="93.8359,2154.0762,83.8359,2158.0762,93.8359,2162.0762,89.8359,2158.0762" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.9106" x="89.8359" y="2140.334">Update internal state</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="234.1274" y1="2167.0762" y2="2167.0762"/><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="89.9443" x="15" y="2177.7109">[error occurred]</text><g class="message" data-participant-1="BA" data-participant-2="BA"><line style="stroke:#666666;stroke-width:1;" x1="82.8359" x2="124.8359" y1="2217.6523" y2="2217.6523"/><line style="stroke:#666666;stroke-width:1;" x1="124.8359" x2="124.8359" y1="2217.6523" y2="2230.6523"/><line style="stroke:#666666;stroke-width:1;" x1="83.8359" x2="124.8359" y1="2230.6523" y2="2230.6523"/><polygon fill="#666666" points="93.8359,2226.6523,83.8359,2230.6523,93.8359,2234.6523,89.8359,2230.6523" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.8247" x="89.8359" y="2197.5996">Handle error and</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.2349" x="89.8359" y="2212.9102">perform cleanup</text></g><text fill="#333333" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="150.415" x="0" y="2327.8086">Last Modified On: 11-Jul-2025</text><!--SRC=[fLRRRkCs47tNLn0fYjf0qjjkjuLH5B2TkbbWartaKlJ1BxGqYebGf4hIYTDY_xt38IbHYZURjdf8PF7CuLmEXsFlX6gvuGtRyFBkrkYTgfPQQiE-M7sx-ccrAco7gA3cE-bMMha8UKLF1k76w8Uu-8QUelYAdK8j5B2DDXKOosfSvL8oaD20SZQpnv_2FRA_2yOMX1vouTUnbwVq51-BZAL43usM_vS6_pfHYfOhzz-eSeAZXTJb7PjR2yr6WZbYtBB5_02ct7AXs58AJ4P0BOUegzt66G3smUWIhDM1w-hwGr5nnpVSGe-vSjf0MAVN379p_SVxRDt_391YCMSdl-2sC_OREF9fKhhzCLkh3LZNEqblPy0nAr-VSRkTJAS5BvsuvmwyruibE_54yndRKFJVC32cg2075Lmw9cg_Wjcx1UU4kWrup2xcTzwHd75LIOX8V6S6tCwe0bILdCOipDYvleULDW_SLC5xOijyyxagy4zdqOmibbkksCydz9q-NCAVEupzMQEG9DhhcA6CsWljH2rAxeHMuzsLnZSaC84hgEEUIr4HVB3Hx-4pn2mAoz2QAI6Vq5mvQDbtioGDjjH2KRLzTUs0j0sGXBXnUssp24R-HijE93EsDE0Noy4EQ_KWt3RwkGLnktLKg0RFVyM4gdLFsmkkUwDAatV4nahQemgwqGFbzDRaMhBh0exXUIsLkcabECZD3zM0alTzdxnGatYI3YQF40amUIPlmRUGiKrkTCxRjV8PgeLqw0YTAwY6coQ2iUNn4_XB8dpLUN9jkBBUG2k6T0DdG-ep10BUrXS05LG3eO-T6Wiz7kynBAaOcXORViWTgurkc7PRz5Vf2koKEe3KkgLB0uFRCXix6_R8CIUX_PC2YLB5BXPHasZjkzMqW_SE1qLrD2DHfgrz3-qqcS1vweSq_JuX5Oa6kvSHW6UUrLn8sy6w2DA-bzJcHllvffV_B_B0lTKfM302MyTVaBQq_Z2kLQWjSrdvcvYzdE3NFI9Avw_JMegI-ZALfG1fKpCA9TiPfX-KF-O8Ua9qWsZO2qiCOybIynw4wmQYEyxtlw3jNwBortaJxFtF1Fs9TjXXS-X0yMD_dZdoRoi_qTIFg65gHLbeDfpxXfixV_rcfCDi1ClhlPTiKFbBml_1gyQ2O_qWWFY1RyQlnsLQdJmJI20hTyPWG4bE8OAnZ0RUHukupN7wVRr_QI1l-ZfUGeFImM7ZirNia4zhIAFTSoLBk-MbeawL6ivQaUP7EgPhRXZjW3REBdcoKicZ4dOjtV6fEzY-O2FN_lMTzkEChOGAdI1SQZtJmCaweWZKOpux5eHJ7lmN2kynf0a1XD1QCDY_CMSIkDgD919Tup4dduWhcVWv42UVGoC1JS1myFPHEkkUSRoT9vSNQQZrSKuFGaPHXGOOvb1TKjMhaTruLbshSHAeyKce7Tvjsj_zxxXrEBjME3FYpFDUpTYNVk_9KLMTd9-VdppYSpGj_W40]--></g></svg>
