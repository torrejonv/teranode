<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="969px" preserveAspectRatio="none" style="width:907px;height:969px;background:#FFFFFF;" version="1.1" viewBox="0 0 907 969" width="907px" zoomAndPan="magnify"><title>Unmined Transaction Cleanup Process</title><defs/><g><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="473.1611" x="221.3606" y="37.1182">Unmined Transaction Cleanup Process</text><rect fill="#FFFFFF" height="829.3809" style="stroke:#000000;stroke-width:1.0;" width="10" x="71.5845" y="94.752"/><rect fill="#FFFFFF" height="711.9829" style="stroke:#000000;stroke-width:1.0;" width="10" x="244.7188" y="160.3506"/><rect fill="#FFFFFF" height="202.3945" style="stroke:#000000;stroke-width:1.0;" width="699.5879" x="167.4639" y="261.7485"/><rect fill="#FFFFFF" height="130.9966" style="stroke:#000000;stroke-width:1.0;" width="720.5908" x="157.4639" y="478.1431"/><rect fill="#FFFFFF" height="99.1973" style="stroke:#000000;stroke-width:1.0;" width="700.5908" x="167.4639" y="502.9424"/><rect fill="#FFFFFF" height="168.7959" style="stroke:#000000;stroke-width:1.0;" width="744.4185" x="157.4639" y="623.1396"/><rect fill="#FFFFFF" height="136.9966" style="stroke:#000000;stroke-width:1.0;" width="724.4185" x="167.4639" y="647.939"/><line style="stroke:#000000;stroke-width:1.0;" x1="76" x2="76" y1="84.752" y2="933.1328"/><line style="stroke:#000000;stroke-width:1.0;" x1="249.4639" x2="249.4639" y1="84.752" y2="933.1328"/><line style="stroke:#000000;stroke-width:1.0;" x1="657.896" x2="657.896" y1="84.752" y2="933.1328"/><line style="stroke:#000000;stroke-width:1.0;" x1="807.5083" x2="807.5083" y1="84.752" y2="933.1328"/><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="113.1689" x="20" y="52.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="99.1689" x="27" y="73.8125">CleanupTicker</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="113.1689" x="20" y="932.1328"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="99.1689" x="27" y="953.208">CleanupTicker</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="124.5098" x="187.4639" y="52.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="110.5098" x="194.4639" y="73.8125">BlockAssembler</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="124.5098" x="187.4639" y="932.1328"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="110.5098" x="194.4639" y="953.208">BlockAssembler</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="96.3047" x="609.896" y="52.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82.3047" x="616.896" y="73.8125">UTXO Store</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="96.3047" x="609.896" y="932.1328"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="82.3047" x="616.896" y="953.208">UTXO Store</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="127.374" x="744.5083" y="52.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="113.374" x="751.5083" y="73.8125">Cleanup Service</text><rect fill="#FFFFFF" height="31.0146" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="127.374" x="744.5083" y="932.1328"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="113.374" x="751.5083" y="953.208">Cleanup Service</text><rect fill="#FFFFFF" height="829.3809" style="stroke:#000000;stroke-width:1.0;" width="10" x="71.5845" y="94.752"/><rect fill="#FFFFFF" height="711.9829" style="stroke:#000000;stroke-width:1.0;" width="10" x="244.7188" y="160.3506"/><polygon fill="#000000" points="237.7188,115.5513,247.7188,119.5513,237.7188,123.5513,241.7188,119.5513" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="81.5845" x2="243.7188" y1="119.5513" y2="119.5513"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="99.3281" x="88.5845" y="114.8218">Periodic trigger</text><path d="M254,99.752 L254,124.752 L456,124.752 L456,109.752 L446,99.752 L254,99.752 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M446,99.752 L446,109.752 L456,109.752 L446,99.752 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181.5938" x="260" y="117.8218">unminedCleanupTicker fires</text><line style="stroke:#000000;stroke-width:1.0;" x1="249.7188" x2="296.7188" y1="147.3506" y2="147.3506"/><line style="stroke:#000000;stroke-width:1.0;" x1="296.7188" x2="296.7188" y1="147.3506" y2="160.3506"/><line style="stroke:#000000;stroke-width:1.0;" x1="255.7188" x2="296.7188" y1="160.3506" y2="160.3506"/><polygon fill="#000000" points="265.7188,156.3506,255.7188,160.3506,265.7188,164.3506,261.7188,160.3506" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="224.7007" x="261.7188" y="142.6211">cleanupOldUnminedTransactions()</text><polygon fill="#000000" points="646.0483,202.0496,656.0483,206.0496,646.0483,210.0496,650.0483,206.0496" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="254.7188" x2="652.0483" y1="206.0496" y2="206.0496"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="293.3823" x="261.7188" y="201.3201">QueryOldUnminedTransactions(cutoffHeight)</text><path d="M663,178.3506 L663,219.3506 L868,219.3506 L868,188.3506 L858,178.3506 L663,178.3506 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M858,178.3506 L858,188.3506 L868,188.3506 L858,178.3506 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="184.2026" x="669" y="196.4204">Find unmined txs older than</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.7109" x="669" y="212.2197">retention period</text><polygon fill="#000000" points="265.7188,242.7485,255.7188,246.7485,265.7188,250.7485,261.7188,246.7485" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="259.7188" x2="657.0483" y1="246.7485" y2="246.7485"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="94.1611" x="271.7188" y="242.019">oldTxHashes[]</text><path d="M167.4639,261.7485 L427.9287,261.7485 L427.9287,269.5479 L417.9287,279.5479 L167.4639,279.5479 L167.4639,261.7485 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="202.3945" style="stroke:#000000;stroke-width:1.0;" width="699.5879" x="167.4639" y="261.7485"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="215.4648" x="182.4639" y="275.8184">Identify parent dependencies</text><line style="stroke:#000000;stroke-width:1.0;" x1="254.7188" x2="296.7188" y1="305.7468" y2="305.7468"/><line style="stroke:#000000;stroke-width:1.0;" x1="296.7188" x2="296.7188" y1="305.7468" y2="318.7468"/><line style="stroke:#000000;stroke-width:1.0;" x1="255.7188" x2="296.7188" y1="318.7468" y2="318.7468"/><polygon fill="#000000" points="265.7188,314.7468,255.7188,318.7468,265.7188,322.7468,261.7188,318.7468" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="224.98" x="261.7188" y="301.0173">collectParentHashes(oldTxHashes)</text><path d="M507.98,284.5479 L507.98,325.5479 L650.98,325.5479 L650.98,294.5479 L640.98,284.5479 L507.98,284.5479 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M640.98,284.5479 L640.98,294.5479 L650.98,294.5479 L640.98,284.5479 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118.1553" x="513.98" y="302.6177">Find all parent txs</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.0527" x="513.98" y="318.417">of old unmined txs</text><polygon fill="#000000" points="646.0483,359.8455,656.0483,363.8455,646.0483,367.8455,650.0483,363.8455" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="254.7188" x2="652.0483" y1="363.8455" y2="363.8455"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="293.3823" x="261.7188" y="359.116">QueryOldUnminedTransactions(cutoffHeight)</text><path d="M663,336.1465 L663,377.1465 L852,377.1465 L852,346.1465 L842,336.1465 L663,336.1465 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M842,336.1465 L842,346.1465 L852,346.1465 L842,336.1465 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168.0034" x="669" y="354.2163">Get all unmined txs again</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.2051" x="669" y="370.0156">to check dependencies</text><polygon fill="#000000" points="265.7188,400.5444,255.7188,404.5444,265.7188,408.5444,261.7188,404.5444" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="259.7188" x2="657.0483" y1="404.5444" y2="404.5444"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="107.25" x="271.7188" y="399.8149">allUnminedTxs[]</text><line style="stroke:#000000;stroke-width:1.0;" x1="254.7188" x2="296.7188" y1="438.7434" y2="438.7434"/><line style="stroke:#000000;stroke-width:1.0;" x1="296.7188" x2="296.7188" y1="438.7434" y2="451.7434"/><line style="stroke:#000000;stroke-width:1.0;" x1="255.7188" x2="296.7188" y1="451.7434" y2="451.7434"/><polygon fill="#000000" points="265.7188,447.7434,255.7188,451.7434,265.7188,455.7434,261.7188,451.7434" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="157.8662" x="261.7188" y="434.0139">findParentsToPreserve()</text><path d="M440.8662,417.5444 L440.8662,458.5444 L599.8662,458.5444 L599.8662,427.5444 L589.8662,417.5444 L440.8662,417.5444 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M589.8662,417.5444 L589.8662,427.5444 L599.8662,427.5444 L589.8662,417.5444 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="121.418" x="446.8662" y="435.6143">Identify parents of</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="138.8931" x="446.8662" y="451.4136">younger unmined txs</text><path d="M157.4639,478.1431 L404.8335,478.1431 L404.8335,485.9424 L394.8335,495.9424 L157.4639,495.9424 L157.4639,478.1431 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="130.9966" style="stroke:#000000;stroke-width:1.0;" width="720.5908" x="157.4639" y="478.1431"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="202.3696" x="172.4639" y="492.2129">Preserve necessary parents</text><path d="M167.4639,502.9424 L231.5132,502.9424 L231.5132,510.7417 L221.5132,520.7417 L167.4639,520.7417 L167.4639,502.9424 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="99.1973" style="stroke:#000000;stroke-width:1.0;" width="700.5908" x="167.4639" y="502.9424"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.0493" x="182.4639" y="517.0122">alt</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174.6626" x="246.5132" y="516.0015">[if parentsToPreserve exist]</text><polygon fill="#000000" points="646.0483,549.4407,656.0483,553.4407,646.0483,557.4407,650.0483,553.4407" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="254.7188" x2="652.0483" y1="553.4407" y2="553.4407"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="379.3296" x="261.7188" y="548.7112">PreserveTransactions(parentHashes, preserveUntilHeight)</text><path d="M663,525.7417 L663,566.7417 L853,566.7417 L853,535.7417 L843,525.7417 L663,525.7417 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M843,525.7417 L843,535.7417 L853,535.7417 L843,525.7417 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.8936" x="669" y="543.8115">Mark parents to be</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.0063" x="669" y="559.6108">kept until specified height</text><polygon fill="#000000" points="265.7188,590.1396,255.7188,594.1396,265.7188,598.1396,261.7188,594.1396" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="259.7188" x2="657.0483" y1="594.1396" y2="594.1396"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="64.9937" x="271.7188" y="589.4102">preserved</text><path d="M157.4639,623.1396 L371.502,623.1396 L371.502,630.939 L361.502,640.939 L157.4639,640.939 L157.4639,623.1396 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="168.7959" style="stroke:#000000;stroke-width:1.0;" width="744.4185" x="157.4639" y="623.1396"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="169.0381" x="172.4639" y="637.2095">Delete old transactions</text><path d="M167.4639,647.939 L243.8467,647.939 L243.8467,655.7383 L233.8467,665.7383 L167.4639,665.7383 L167.4639,647.939 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="136.9966" style="stroke:#000000;stroke-width:1.0;" width="724.4185" x="167.4639" y="647.939"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.3828" x="182.4639" y="662.0088">loop</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="116.9019" x="258.8467" y="660.998">[batch processing]</text><polygon fill="#000000" points="796.1953,683.5376,806.1953,687.5376,796.1953,691.5376,800.1953,687.5376" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="254.7188" x2="802.1953" y1="687.5376" y2="687.5376"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="172.3008" x="261.7188" y="682.8081">DeleteTransactions(batch)</text><polygon fill="#000000" points="669.0483,713.3369,659.0483,717.3369,669.0483,721.3369,665.0483,717.3369" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="663.0483" x2="807.1953" y1="717.3369" y2="717.3369"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="126.147" x="675.0483" y="712.6074">Delete transactions</text><polygon fill="#000000" points="796.1953,743.1362,806.1953,747.1362,796.1953,751.1362,800.1953,747.1362" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="658.0483" x2="802.1953" y1="747.1362" y2="747.1362"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="48.1216" x="665.0483" y="742.4067">deleted</text><polygon fill="#000000" points="265.7188,772.9355,255.7188,776.9355,265.7188,780.9355,261.7188,776.9355" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="259.7188" x2="807.1953" y1="776.9355" y2="776.9355"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100.1851" x="271.7188" y="772.2061">batch complete</text><polygon fill="#000000" points="646.0483,827.6345,656.0483,831.6345,646.0483,835.6345,650.0483,831.6345" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="254.7188" x2="652.0483" y1="831.6345" y2="831.6345"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288.1138" x="261.7188" y="826.905">ProcessExpiredPreservations(currentHeight)</text><path d="M663,803.9355 L663,844.9355 L824,844.9355 L824,813.9355 L814,803.9355 L663,803.9355 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M814,803.9355 L814,813.9355 L824,813.9355 L814,803.9355 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.3857" x="669" y="822.0054">Clean up expired</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="140.0928" x="669" y="837.8047">preservation markers</text><polygon fill="#000000" points="260.7188,868.3335,250.7188,872.3335,260.7188,876.3335,256.7188,872.3335" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="254.7188" x2="657.0483" y1="872.3335" y2="872.3335"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="65.4443" x="266.7188" y="867.604">processed</text><line style="stroke:#000000;stroke-width:1.0;" x1="81.5845" x2="123.5845" y1="902.1328" y2="902.1328"/><line style="stroke:#000000;stroke-width:1.0;" x1="123.5845" x2="123.5845" y1="902.1328" y2="915.1328"/><line style="stroke:#000000;stroke-width:1.0;" x1="82.5845" x2="123.5845" y1="915.1328" y2="915.1328"/><polygon fill="#000000" points="92.5845,911.1328,82.5845,915.1328,92.5845,919.1328,88.5845,915.1328" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="139.1343" x="88.5845" y="897.4033">Wait for next interval</text><!--SRC=[bLH1Rjim4Bpp5TkSRA3vW0y5RBLfUYZYGX9QeEw1fbOMOPeaI3gGVzyL9JcadHwgao3EpixChlWXT7X2i8fBpO8C2g7M9wcnWSfnxRa8qcWe579zjh1rHg3tZ5dkWXJISXtWOJgjf3YYUm3keQXon4OPSLnxZwUzcY2RTGwfgrylK0RZC1xNvRize4JtAiM8AKh61e6lFE3GaXKLF7uYvXLiqKdJI071oSC17TE6CFJUXHMSHuUPR6YbGpAsMSyKOZn-KSsKI1A8NopVEfEJgQmkL_3ZZExoZo9n3gPjdt6GiSmaFKdTpBeWz1wCQaXKwBZUQOS1TPo3ZRPONSBZf99mLV_CVOV-zn_63ivGID-Q0TzUW2AaDsZGegPlGf95e2TnQPH24ROHEF8i4ivbXDyfvKhDt2Hsfqqx24aDnBgar_z5SzlqAuROCqs87sXdTpeO41sAuxt992MgdPlsGqutuWP8Ixx657nbjhGBj6Yuk9ToaorDgjtfYpbhsh8i018ppsEc0ut3xyFTjJhISnL0jlEdj-w0lVGXGl8WPq2Me4r6-17i1Ab9h4fZlVNpdRlZrGk5kSUTFg8Dv8KgmLiKifNagOiaLuuatRbN4my7tudtpwXeVUDwX4HkX2fZBEnv41rnn9j5wiEDtuByZXoPsrZrvgWevsocVdUz4iq3PHDXJKOmsHa52NEo0oJtbCuW2lxIMxeuccaYV5vc5sVnpeyUBnsWN70it6cRbCA9fe7EiopTs8YqiWQpIsUyxefg1J-v3D0QHmlMqoxfC10gzXS0]--></g></svg>
