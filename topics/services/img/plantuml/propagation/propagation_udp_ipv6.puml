@startuml
skinparam backgroundColor #F0F8FF
skinparam defaultFontColor #333333
skinparam arrowColor #666666

' Define borders for all elements
skinparam entity {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam control {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam participant {
  BorderColor #666666
  BackgroundColor #DDDDDD
}




participant "UDP6 Client" as Client
participant "UDP6 Listener" as UDPListener
participant "PropagationServer" as PropagationServer
participant "TxStore" as TxStore
participant "Kafka Producer" as KafkaProducer
participant "Validator" as Validator

loop for each ipv6Address in ipv6Addresses
    PropagationServer -> UDPListener: Setup UDP Multicast Listener (ipv6Address)
    activate UDPListener
    UDPListener --> PropagationServer: Listener Ready
    deactivate UDPListener
end

loop Listening for UDP Packets
    Client -> UDPListener: Send UDP Packet
    activate UDPListener
    UDPListener -> PropagationServer: Invoke ProcessTransaction

    PropagationServer -> TxStore: storeTransaction(ctx, tx)
    activate TxStore
    TxStore --> PropagationServer: Storage confirmation
    deactivate TxStore

    alt if Kafka Producer is configured
        PropagationServer -> KafkaProducer: Send transaction
        activate KafkaProducer
        KafkaProducer --> PropagationServer: Confirmation
        deactivate KafkaProducer
    else if direct validation
        PropagationServer -> Validator: Validate(ctx, tx)
        activate Validator
        Validator --> PropagationServer: Validation response
        deactivate Validator
    end

    deactivate UDPListener
end

left footer Last Modified On: %date("dd-MMM-yyyy")

@enduml
