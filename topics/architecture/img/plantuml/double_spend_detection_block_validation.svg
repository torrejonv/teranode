<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="820px" preserveAspectRatio="none" style="width:803px;height:820px;background:#F0F8FF;" version="1.1" viewBox="0 0 803 820" width="803px" zoomAndPan="magnify"><title>Subtree Validation During Block Processing</title><defs/><g><rect fill="#F0F8FF" height="820" style="stroke:none;stroke-width:1.0;" width="803" x="0" y="0"/><text fill="#333333" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="312.9834" x="246.0786" y="28.5352">Subtree Validation During Block Processing</text><rect fill="#FFFFFF" height="583.8105" style="stroke:#181818;stroke-width:1.0;" width="10" x="296.0791" y="136.2871"/><rect fill="none" height="540.5" style="stroke:#000000;stroke-width:1.5;" width="786.1406" x="10" y="151.2871"/><rect fill="none" height="422.6133" style="stroke:#000000;stroke-width:1.5;" width="584.125" x="202.0156" y="262.1738"/><rect fill="none" height="319.6816" style="stroke:#000000;stroke-width:1.5;" width="564.125" x="212.0156" y="328.7949"/><rect fill="none" height="259.0605" style="stroke:#000000;stroke-width:1.5;" width="544.125" x="222.0156" y="382.416"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="81" x2="81" y1="104.9766" y2="738.0977"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="301.0156" x2="301.0156" y1="104.9766" y2="738.0977"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="517.5898" x2="517.5898" y1="104.9766" y2="738.0977"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="613.6758" x2="613.6758" y1="104.9766" y2="738.0977"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="713.6143" x2="713.6143" y1="104.9766" y2="738.0977"/><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="122.5752" x="20" y="73.4883"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.5752" x="27" y="94.0234">Block Validation</text><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="122.5752" x="20" y="737.0977"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.5752" x="27" y="757.6328">Block Validation</text><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="138.127" x="232.0156" y="73.4883"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.127" x="239.0156" y="94.0234">Subtree Validation</text><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="138.127" x="232.0156" y="737.0977"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.127" x="239.0156" y="757.6328">Subtree Validation</text><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="75.0859" x="480.5898" y="73.4883"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.0859" x="487.5898" y="94.0234">Validator</text><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="75.0859" x="480.5898" y="737.0977"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.0859" x="487.5898" y="757.6328">Validator</text><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9385" x="565.6758" y="102.0234">Subtree Store</text><path d="M596.145,52.4883 C596.145,42.4883 614.145,42.4883 614.145,42.4883 C614.145,42.4883 632.145,42.4883 632.145,52.4883 L632.145,78.4883 C632.145,88.4883 614.145,88.4883 614.145,88.4883 C614.145,88.4883 596.145,88.4883 596.145,78.4883 L596.145,52.4883 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M596.145,52.4883 C596.145,62.4883 614.145,62.4883 614.145,62.4883 C614.145,62.4883 632.145,62.4883 632.145,52.4883 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.9385" x="565.6758" y="750.6328">Subtree Store</text><path d="M596.145,763.5859 C596.145,753.5859 614.145,753.5859 614.145,753.5859 C614.145,753.5859 632.145,753.5859 632.145,763.5859 L632.145,789.5859 C632.145,799.5859 614.145,799.5859 614.145,799.5859 C614.145,799.5859 596.145,799.5859 596.145,789.5859 L596.145,763.5859 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M596.145,763.5859 C596.145,773.5859 614.145,773.5859 614.145,773.5859 C614.145,773.5859 632.145,773.5859 632.145,763.5859 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.5264" x="672.6143" y="102.0234">UTXO Store</text><path d="M696.3774,52.4883 C696.3774,42.4883 714.3774,42.4883 714.3774,42.4883 C714.3774,42.4883 732.3774,42.4883 732.3774,52.4883 L732.3774,78.4883 C732.3774,88.4883 714.3774,88.4883 714.3774,88.4883 C714.3774,88.4883 696.3774,88.4883 696.3774,78.4883 L696.3774,52.4883 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M696.3774,52.4883 C696.3774,62.4883 714.3774,62.4883 714.3774,62.4883 C714.3774,62.4883 732.3774,62.4883 732.3774,52.4883 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.5264" x="672.6143" y="750.6328">UTXO Store</text><path d="M696.3774,763.5859 C696.3774,753.5859 714.3774,753.5859 714.3774,753.5859 C714.3774,753.5859 732.3774,753.5859 732.3774,763.5859 L732.3774,789.5859 C732.3774,799.5859 714.3774,799.5859 714.3774,799.5859 C714.3774,799.5859 696.3774,799.5859 696.3774,789.5859 L696.3774,763.5859 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M696.3774,763.5859 C696.3774,773.5859 714.3774,773.5859 714.3774,773.5859 C714.3774,773.5859 732.3774,773.5859 732.3774,763.5859 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="583.8105" style="stroke:#181818;stroke-width:1.0;" width="10" x="296.0791" y="136.2871"/><polygon fill="#666666" points="284.0791,132.2871,294.0791,136.2871,284.0791,140.2871,288.0791,136.2871" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;" x1="81.2876" x2="290.0791" y1="136.2871" y2="136.2871"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.8242" x="88.2876" y="131.5449">CheckSubtreeFromBlock()</text><path d="M10,151.2871 L72.1387,151.2871 L72.1387,158.5977 L62.1387,168.5977 L10,168.5977 L10,151.2871 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="540.5" style="stroke:#000000;stroke-width:1.5;" width="786.1406" x="10" y="151.2871"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="25" y="164.8555">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="133.563" x="87.1387" y="163.9219">[subtree already exists]</text><polygon fill="#666666" points="92.2876,185.9082,82.2876,189.9082,92.2876,193.9082,88.2876,189.9082" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="86.2876" x2="295.0791" y1="189.9082" y2="189.9082"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.7915" x="98.2876" y="185.166">Return true (already validated)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="796.1406" y1="198.9082" y2="198.9082"/><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="53.9365" x="15" y="209.543">[got lock]</text><line style="stroke:#666666;stroke-width:1.0;" x1="306.0791" x2="348.0791" y1="234.1738" y2="234.1738"/><line style="stroke:#666666;stroke-width:1.0;" x1="348.0791" x2="348.0791" y1="234.1738" y2="247.1738"/><line style="stroke:#666666;stroke-width:1.0;" x1="307.0791" x2="348.0791" y1="247.1738" y2="247.1738"/><polygon fill="#666666" points="317.0791,243.1738,307.0791,247.1738,317.0791,251.1738,313.0791,247.1738" style="stroke:#666666;stroke-width:1.0;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.2764" x="313.0791" y="229.4316">ValidateSubtreeInternal()</text><path d="M202.0156,262.1738 L404.3804,262.1738 L404.3804,269.4844 L394.3804,279.4844 L202.0156,279.4844 L202.0156,262.1738 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="422.6133" style="stroke:#000000;stroke-width:1.5;" width="584.125" x="202.0156" y="262.1738"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="157.3647" x="217.0156" y="275.7422">ValidateSubtreeInternal</text><line style="stroke:#666666;stroke-width:1.0;" x1="306.0791" x2="348.0791" y1="300.7949" y2="300.7949"/><line style="stroke:#666666;stroke-width:1.0;" x1="348.0791" x2="348.0791" y1="300.7949" y2="313.7949"/><line style="stroke:#666666;stroke-width:1.0;" x1="307.0791" x2="348.0791" y1="313.7949" y2="313.7949"/><polygon fill="#666666" points="317.0791,309.7949,307.0791,313.7949,317.0791,317.7949,313.0791,313.7949" style="stroke:#666666;stroke-width:1.0;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.0537" x="313.0791" y="296.0527">Process transactions in order</text><path d="M212.0156,328.7949 L286.4624,328.7949 L286.4624,336.1055 L276.4624,346.1055 L212.0156,346.1055 L212.0156,328.7949 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="319.6816" style="stroke:#000000;stroke-width:1.5;" width="564.125" x="212.0156" y="328.7949"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="227.0156" y="342.3633">loop</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121.9561" x="301.4624" y="341.4297">[for each transaction]</text><polygon fill="#666666" points="506.1328,363.416,516.1328,367.416,506.1328,371.416,510.1328,367.416" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;" x1="306.0791" x2="512.1328" y1="367.416" y2="367.416"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.9507" x="313.0791" y="362.6738">Validate(tx)</text><path d="M222.0156,382.416 L284.1543,382.416 L284.1543,389.7266 L274.1543,399.7266 L222.0156,399.7266 L222.0156,382.416 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="259.0605" style="stroke:#000000;stroke-width:1.5;" width="544.125" x="222.0156" y="382.416"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="237.0156" y="395.9844">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119.5176" x="299.1543" y="395.0508">[validation succeeds]</text><polygon fill="#666666" points="702.3774,417.0371,712.3774,421.0371,702.3774,425.0371,706.3774,421.0371" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;" x1="518.1328" x2="708.3774" y1="421.0371" y2="421.0371"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.0283" x="525.1328" y="416.2949">Store transaction metadata</text><polygon fill="#666666" points="317.0791,446.3477,307.0791,450.3477,317.0791,454.3477,313.0791,450.3477" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="311.0791" x2="517.1328" y1="450.3477" y2="450.3477"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.3164" x="323.0791" y="445.6055">txMeta</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="222.0156" x2="766.1406" y1="459.3477" y2="459.3477"/><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="166.4985" x="227.0156" y="469.9824">[validation fails with conflict]</text><polygon fill="#666666" points="317.0791,508.9238,307.0791,512.9238,317.0791,516.9238,313.0791,512.9238" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="311.0791" x2="517.1328" y1="512.9238" y2="512.9238"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.6733" x="323.0791" y="508.1816">ErrTxConflicting</text><path d="M523,478.3027 L523,533.3027 L725,533.3027 L725,488.3027 L715,478.3027 L523,478.3027 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M715,478.3027 L715,488.3027 L725,488.3027 L715,478.3027 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.9976" x="529" y="495.8711">Transaction saved</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.8604" x="529" y="511.1816">(and marked as "conflicting")</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.2363" x="533.1133" y="526.4922">but not spent</text><polygon fill="#666666" points="702.3774,571.8555,712.3774,575.8555,702.3774,579.8555,706.3774,575.8555" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;" x1="518.1328" x2="708.3774" y1="575.8555" y2="575.8555"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.0283" x="525.1328" y="555.8027">Store transaction metadata</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.5464" x="529.2461" y="571.1133">(as "conflicting")</text><line style="stroke:#666666;stroke-width:1.0;" x1="306.0791" x2="348.0791" y1="620.4766" y2="620.4766"/><line style="stroke:#666666;stroke-width:1.0;" x1="348.0791" x2="348.0791" y1="620.4766" y2="633.4766"/><line style="stroke:#666666;stroke-width:1.0;" x1="307.0791" x2="348.0791" y1="633.4766" y2="633.4766"/><polygon fill="#666666" points="317.0791,629.4766,307.0791,633.4766,317.0791,637.4766,313.0791,633.4766" style="stroke:#666666;stroke-width:1.0;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.7866" x="313.0791" y="600.4238">Mark as conflicting</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.1343" x="317.1924" y="615.7344">in current subtree</text><polygon fill="#666666" points="602.145,672.7871,612.145,676.7871,602.145,680.7871,606.145,676.7871" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;" x1="306.0791" x2="608.145" y1="676.7871" y2="676.7871"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2534" x="313.0791" y="672.0449">Store validated subtree</text><polygon fill="#666666" points="92.2876,716.0977,82.2876,720.0977,92.2876,724.0977,88.2876,720.0977" style="stroke:#666666;stroke-width:1.0;"/><line style="stroke:#666666;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="86.2876" x2="300.0791" y1="720.0977" y2="720.0977"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.2192" x="98.2876" y="715.3555">Validation result</text><text fill="#333333" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="155.4346" x="0" y="810.2539">Last Modified On: 24-Feb-2025</text><!--SRC=[fLJ1QXin4BthAmQNKliGA1HAyQ479pKKQbBgrFIGorYQjOLboOoqZaFfltSaRsojq_QGpc7PtNdpvadpfBYnVeUCMrYYtgmujDvS1nSONatVJZzCfogU48OQR5sQ1fywoBiI5GIPmqENV5z2gJTmGutr1Cl0XZX28rbq3iZHbdoALRryslG8FnN0fA3xNFBtKkLD2VLBLInQ579m_qiZpsIrtQ5FBwDIIbRZ2ERjCZ4HBD1PWya63pSjMx-2YGjw0ryvQ8fHVYXLDnqSq-Uo0M24oQ8FUivUOFCBM9SENB8B9U-un4XdWhaawLWxhzBVxtxSLhdygTHa0LSVfSSOhjUaDnt5bCEsQ1wE5EfazvWe2r7e4iIk3JecD8z01njb-20n5pQXcmZTDqejUqZS4WoVeFkZTZ8ZHKuqhKA2t4QTgezQkZLI9-UpJyGUdQWfm3octTz01T6dw-OYOj37l9xW8rWFnGVgLE12s1LJ4-fr3JuXphILo64wZ5GFadTfV_P8RBKcCh67oL6OyXp6nxdKFM5B2VFm_bJLhIiTPdG1ADjQzMxGkWWFDgtpQMgSrUaVX9-OxmxN7QxO-1BhWpY1xMgTnd1NgOsu9tFlX-WDR94tPBB71lhCDHZTUrYsALD0tCaDeLws8K8pVCRzZEey_Pd8oM8gl538-7NBB3AU3DtVHszK_NxfglcJmfEbUpIbf3og8r5T6qnHRc1bg7Uw73L932XRpF05Ou9PCBQnmdthn_2wc6rWpDLiDhjwb1YCVWC0]--></g></svg>
