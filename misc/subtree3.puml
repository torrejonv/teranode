@startuml
skinparam backgroundColor #F0F8FF
skinparam defaultFontColor #333333
skinparam arrowColor #666666

' Define borders for all elements
skinparam entity {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam control {
  BorderColor #666666
  BackgroundColor #DDDDDD
}

skinparam participant {
  BorderColor #666666
  BackgroundColor #DDDDDD
}




:Receive subtree from miner;

if (Is subtree in subtree store?) then (yes)
else (no)
  :Request subtree from miner;
  :Receive subtree from miner;
endif

:Walk through transaction hashes in subtree;

while (Any transaction hashes left?) is (yes)
  if (Is transaction hash in transaction store?) then (yes)
  else (no)
    :Request transaction from miner;
    :Receive transaction from miner;
    :Validate transaction;
    :Store validated transaction;
  endif
endwhile

:Validate subtree;
:Add subtree to subtree store;

@enduml
