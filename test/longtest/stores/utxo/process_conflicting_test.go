package utxo

import (
	"context"
	"net/url"
	"testing"

	"github.com/bsv-blockchain/go-bt/v2"
	utxostore "github.com/bsv-blockchain/teranode/stores/utxo"
	"github.com/bsv-blockchain/teranode/stores/utxo/sql"
	"github.com/bsv-blockchain/teranode/ulogger"
	"github.com/bsv-blockchain/teranode/util/test"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

var txsNeededForProcessing = []string{
	"010000000000000000ef01438e2e85a23218d9eab5cd93675d3a6e55aa711972024cb478c00363f2cbf18f030000006a473044022012a4cf7882bc74c4f0903425175f5086e2057b002047854e974cad164b33b5b6022040b1b553234e8afd537eec6991f92f455e77e5c4fdf73142125b53c4e671c9784121028e7a4b5b0126b5ca16e7621790ff63bea2fdffd7e3a030d5b249c0c2a8647bb7ffffffffccfb0100000000001976a9140205aab5eaae1d7482eede1aab2de0bd86693d0b88ac0434210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acdc050000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403130666336306639626134363165343835613438393361636239396434373366343337333865303964643730303533393530366532356662373561663962383405656d6f6a6906e2ac86efb88ebbd40100000000001976a9140205aab5eaae1d7482eede1aab2de0bd86693d0b88ac00000000",
	"010000000000000000ef0202580e2628063291c2ca189f176dc2338e0a113604de62bad55db9fbef6fe31d000000006b483045022100e5c998196db4ab357dabc19057ae692e9569e2e60be5de7c46ab20f5c3781dc702201f17f02a9a162e41aef3ca3ba831d23b3697567f0933e740a1c61ee00eb853ad4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffffb9630000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac531df090f6cf40cc1235f899ad7833c177b90495fdf5608956782a9e404c3199030000006a47304402204468d080b4b1b5d0b361275b692b5cf9f1798a914d93136d91d1d198aa2b6874022079e46c1ab9d2cddc7eaeb754d59d0a5baf9376588783f596570d5657ad39c00d4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffffbd140000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac049c630000000000001976a914bc2a58f98f6c9cf1cbd223764341336d53ddefcf88ac94110000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403036353861363033653964356530366264393931623263636639313534306239393132643265323761373864326236363031353662343931326163383061303005656d6f6a6906e2ac86efb88e45030000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac00000000",
	"010000000000000000ef01c7f8ad158a6f26c61058add4357d4e7a4c7a0a293e9e7def336e74eba1268b5a030000006b483045022100fa4f9d74772382abef51ec70b017127c541345998e79767efcf3ac92e96c506a0220622b5c76082ac60b8fdb1480319361198c78b6068fa4201357a051b250f5e2c941210353059975f9f6100f673a335161a5f10d584ba4c7457fc9e33c16453333c84e4bfffffffff5b40c00000000001976a91450c9c18bd6752d7e0e46c5d235a6b7f78f2fb9ab88ac0465010000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac3f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406430643335643733663432353066386362643830646631383530396366366466303633333937343962373033333461386239393931633132353463663239313005656d6f6a6906e2ac86efb88e50b30c00000000001976a91450c9c18bd6752d7e0e46c5d235a6b7f78f2fb9ab88ac00000000",
	"010000000000000000ef01e23e18a6e890fd88fd0cdd6635f51e672e25bc2011b8bb11ba27b290929526da000000006a47304402200fdf7b0988037a00e58abf36b6fa877205dc2aeb8d82631e995b28f167892bdc0220477aa2cd5611f3d935926ced57a23b19120a9240028c98a90249e6b947008523412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff34210000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406263363433313438613161626166363135353935633262623138306236663234626133313463356366663763333030313830643863303562316132393439373005656d6f6a6906e2ac86efb88ecf200000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01d0a9aea5f1027f45944b010ee8f94ce9a032f0d5e179e2acb431cb0c3fc8ec69000000006a473044022017ebc0669ec4ecefc33ad578be98d2f0bae480fe117b0bcdd0a453433343afc902207dea905bba09f1a15b00133ee7693aee2aeab18d03b5774fbd658d7ef8ef1da9412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff34210000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403464656139643063326436383433306266666235656263626462326262383262326165366436376438613637623934363632303530303163303566383832393605656d6f6a6906e2ac86efb88ecf200000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef014a1c82072aabf181f1ed8262fff2bc918cec03b942dbe6ad255cfec95d9c1833000000006b483045022100de311839d3567dba1ac5e415390850ab3d4f73782f7a3d86c1cddfc9d5ed654002201c23bd5c5fbc2a019338a7058c2d0e3fb8b2f8250a52193f7bbdbd754980dd03412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff34210000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406131613834613437336334353161663564633436353831616363346534346264343435616637663063366430373131363131373765313965616337323332666505656d6f6a6906e2ac86efb88ecf200000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01ea954d5c06c38d9c99f7188cf536d956939e57ee1bafcb3186687b5226dd240b030000006a47304402202d379b33a8ea0b7cfad07a7969fa0c7b8f09b7a0bf7e432f30a704f889ec96880220167351a1290110f11d24512a2e656a40a837e48fec6c4ccbc2861f6af515e38b412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff5e4c0800000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403863353266323435336237346130613365363331636132643430336433633536316239303639363366633133313837383463336164303139653738643762306405656d6f6a6906e2ac86efb88ef94b0800000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01be9f1e0d6e30a9cb19c541e5f08bdb67b2d2082058e054968210ada120f4bafa030000006a473044022001586960e225cce35885efcb4b8cbe163c8d4846f4766412c946d32db7509db202205694011cf359ad5f66f7ab332b00ae7caef9ce0a1d27e7b76ee2d13283241691412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff1b730600000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403433653064323538363865386235393432666636346135643133633536633937353433313463623736643762646465646165313234646662653365633163623005656d6f6a6906e2ac86efb88eb6720600000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef014f420ec9befc396ef479bad6e2d8d2ca5ab486b54e577a14321167de6a689144000000006a47304402200219a9fa6bd0015795f8f63ebf1e7ed4aa62f76c9f71226dc9044fb997a9ead602206b78c2261c2ee71ecd1882ce3300bd4e2ede3c14756394ee2c4067b1cb92bee9412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff68420000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406339336132313864353964383839636534383631313266616338666238373736653131663833383534656566646561636230333339613034373162313861376105656d6f6a6906e2ac86efb88e03420000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01ea1a8cc42651edf798e0b601408a3c4343357f817b598ddf6c11d7bc937d0330030000006b48304502210099b6500962a0a810a33820988df54a0f3a8bcd20ff0bf062fb84aba54d72e5cd0220421d81d2101493fa2b9b8e59777eee649c42aee294ddce0b23531125f074d337412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff9cde0000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406531383535303737306362666366336431613036333836396135303937623732373730363932633034663534333038353731326538333832646537343965356305656d6f6a6906e2ac86efb88e37de0000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01bd4d538ee4bc2e0cceb36854a92c4380e39f2ec3ebb8c7fcf97bd31eabd3b66f030000006b4830450221009d850f066a702c23504404b72eaddd9eacc35422ce16723866f1caf2d2ee9c2d02206d795ec67914775eac8a17d5026acb07699081bbeeefa0220f0285faa1bb205e412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9fffffffffc400100000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406132346335343338666238323162623264323432343762363834386436373865323734383264353166616532313366633235613061626234306565666232363005656d6f6a6906e2ac86efb88e97400100000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01ac375c1577e3ef3a947d0943053d2190c6b14cbffc47c7fefca71d0817a527ce010000006a473044022008401dfd661d70d946cd6562dbb646c63ae6c558fd99705715a139c074b2782f022068e81cad7c672d2c27ffb028c33cfa7d0079e9a8021ad2138e263fce73f84cdb412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff10650300000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406461373933623463666463626665343663623131376165616266616534633233366363656631333461336662326361626635316232646332653837346333626605656d6f6a6906e2ac86efb88eab640300000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef011d337e4cfebad9bfa8bd8ca56fb6ade577577ee688de9a6c3bbb2969977bad17030000006b483045022100d41079c06023d377c1f23c12eebdab188cede34abf392021751c0da3665f3c72022056fc133d587124c171db17d3b2537231744185bd4eaf3481402f4a4ee73e5e25412103f89e5f9bbe25ea0796477b486a8ec6aff36baa3a34610c2ca6fdfe78d31a73deffffffff6a6a0000000000001976a9146d6949541ec10e77eb496d4ee817195df77a2f2e88ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406564336135663664363565346562626438663839343962353637343938313838643730323437663764386166656232646563616530396535336430306134626505656d6f6a6906e2ac86efb88e056a0000000000001976a9146d6949541ec10e77eb496d4ee817195df77a2f2e88ac00000000",
	"010000000000000000ef019613edf2f5c72fb690b00d8c023abf2036afe489c9cc1253afb51154c0163b62030000006b4830450221009844cf24eb6d4e43a8431e12f5b10838e55760c19796998a582df86e6177a2c902207ddb4792fa23cf8f946d3eefe56696b834b7e64615649d3df174e05ac0af9f35412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffffda4a0100000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403930613365326437663263333761353339643863303034666431633534636462333363333237643030636162663665343337366434346334313739663362616405656d6f6a6906e2ac86efb88e754a0100000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01ecbd09142e3b959fe1bb6dfd909a7e717d98fbc3db0acc2f3fc7e95e490e1e50030000006b483045022100b306300d22892a5e9bbc9938d439d7735a3b39de581fb4e5afb23f0c8097de7c02200ae4198e8711786178b82cb939ff7ad6516aaf4490e5b24bc8c3ba83aa1a2406412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff6d450500000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532313631663666643066346365366365376137656135666161656132613866353866363630393031393564353662336530386135376630393863343433613405656d6f6a6906e2ac86efb88e08450500000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef019334b35046af5407254ad8bea66fe137ae9ea879a22aa1e30051e3c19992c394030000006b483045022100a3976db7a2e6ca1beaeef79dccc3a83d778093a7f1712ff8035b98fe3bf1ae2e02201c9d7cafa7f4e7ae8de2641d385a9e599768bb3383855f6e31a84fb19872c599412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff754a0100000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406461373933623463666463626665343663623131376165616266616534633233366363656631333461336662326361626635316232646332653837346333626605656d6f6a6906e2ac86efb88e104a0100000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01b14b1e9622f35974b87dc042a67e6303ed19c0655a892ac3c31f5247a674b3ca030000006a47304402207723f9a99db7f09807702f9e1b982267ac64d711d44c0d006d9fef3298b9f90c0220474e5f0c98608ca73c9d267d74b36dbe44fcb820ded3e19903c8e8be1c0c22de412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9fffffffff0380000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532313631663666643066346365366365376137656135666161656132613866353866363630393031393564353662336530386135376630393863343433613405656d6f6a6906e2ac86efb88e8b380000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01c49a4e3104d3af5df20ce3510d6c202099d6e7a681bdc69af69684a36e3a9ffc030000006b483045022100f7c577f30447c3e72ee389fe5ade35e5dd016537105a3cb186693fdce68edc7802205b141851f71d98a2b612608752a32d4a9dc93fcfd0853734f890fe10a2750db5412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffffd2dd0000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532313631663666643066346365366365376137656135666161656132613866353866363630393031393564353662336530386135376630393863343433613405656d6f6a6906e2ac86efb88e6ddd0000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef0117ecd708bdb27a3ba5135123dc49e413cbc82444393c230b6be293e7321723a7030000006a47304402201ed766756b9162539b933c5a0b6f01718a94f108d9e860de02b44d2a7b5736a6022057640fce0682832026ae932c736dd1e09306a8aa75b5c1adbfab26b3d07bebf3412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff57700600000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532313631663666643066346365366365376137656135666161656132613866353866363630393031393564353662336530386135376630393863343433613405656d6f6a6906e2ac86efb88ef26f0600000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01a3fc7da3ed4a22d80ce0b3824451316c79d3d3a08ce7000523e046a0e6dc70c2030000006b48304502210089d1c60d97f0378d01d872c38f0adf6a213fcbff0b6c96fa0817ac701d22d6d002203f186230c6c160fc2e6227039555f46fcd980c14e14a9b7ca6954778a7475c69412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffffd4400000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532313631663666643066346365366365376137656135666161656132613866353866363630393031393564353662336530386135376630393863343433613405656d6f6a6906e2ac86efb88e6f400000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef0162e1a5a8ef9bdbd8b61f6fa474e7309423127a5a6536c86f7d86792e151b3e11030000006b483045022100d681eff59e7568e5dcd7fcb4cc44fde8f281aa81655d9c282389a8341db6b20902204a3e7cfb30542fac5682fc03877480a24e83bdc477f5b86f68c3ebbbd669e89d412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff8b380000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532313631663666643066346365366365376137656135666161656132613866353866363630393031393564353662336530386135376630393863343433613405656d6f6a6906e2ac86efb88e26380000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01069e1d427f623991e60f9ba0a1572a8ec034acd2da22c4d1148abeb8ab589cc1030000006b483045022100fe4df4eb5875cde37a835191c425a3c818e64b2392f5a459743a5779f9745c91022001093279c2b349b0e235a5c2336d5b78e757851048734cd0ab7f99bb48a2b846412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff6f400000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532313631663666643066346365366365376137656135666161656132613866353866363630393031393564353662336530386135376630393863343433613405656d6f6a6906e2ac86efb88e0a400000000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01af9627217d3acb2d8380b95b0088a122381212f8d5786516b42fe7b0145be7f2030000006b483045022100ff87edc90503cb752c8e30c5cf38dea84ffb495d4479316b8d24eda147f83e5d0220084697d49f90f3bca920b6f9771f48d2fe6a1c00d5c402e6891784e57eab256f412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9fffffffffc390500000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403438663735633439653332383334653137306364646661303431366330383937373236333633376438373134623761326363336365313635336161333937383305656d6f6a6906e2ac86efb88e97390500000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef01aa72c75feb110ca4f03acd6f2f105f415e12e5b9c7b4d0da0affa4588495549f030000006a4730440220576b2d11614f13d6b7339242cff4ae177c51c41d5b738c96c631ecadae63336002206cb0a5ff48cbd793d68e1a3aedde7014aff9abe7621510defaf763a483e05e01412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffffb1400500000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403434383632666435613130643063353833326333396365323730633262366562363633336433643737366537666238636436383038626563353735393662316605656d6f6a6906e2ac86efb88e4c400500000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	"010000000000000000ef0146b84c27768e833b4740adc00b9c3d4b9c2850c1b51be7b90f1d3e60d0c56d56030000006b483045022100858b5ab411da20e089ac70e08e555ac7e93d80a1ec4b0b1e1c58c121b0ec5f8f022029024df14a4747a97597dd6b5e0cc18e331481856ecfb280b7f0cce5d45a5960412102cc4148ae8bd526127ab5645516ee13bcdb506af58fe8471f9126f1812c0942c9ffffffff9b6b0600000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac0455000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f000000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403434383632666435613130643063353833326333396365323730633262366562363633336433643737366537666238636436383038626563353735393662316605656d6f6a6906e2ac86efb88e366b0600000000001976a914db3f0846491bb999dd1d1f81176dcf48d2722e3388ac00000000",
	// conflicting parents
	// 47b74bd719c8c0088d3094086d99639bc6fbc44211beeda990e1c9d166864534
	"010000000000000000ef0167e9b4fcc0b54c9e211fd0afe02c4842168f5361163e4da283daf96b8a6a9358030000006b4830450221009bb0207e779910353ea6823ef5ba84e73e89c6ab2506417784d3fbb64f30f51b02203676cc88e09a900e240b41d347383f51e759014a8a251a9fafb2cfd554da74204121028e7a4b5b0126b5ca16e7621790ff63bea2fdffd7e3a030d5b249c0c2a8647bb7ffffffffbadd0600000000001976a9140205aab5eaae1d7482eede1aab2de0bd86693d0b88ac0434210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acdc050000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403130666336306639626134363165343835613438393361636239396434373366343337333865303964643730303533393530366532356662373561663962383405656d6f6a6906e2ac86efb88ea9b60600000000001976a9140205aab5eaae1d7482eede1aab2de0bd86693d0b88ac00000000",
	// cc338402f8327609c1088849df8b6b51e6dbb5843947a28e2df0a3fdc28cb163
	"010000000000000000ef0145ccb699e52c1dd1dd52b4467558335d0b762bd9fc7b65b4c3ad8a82cca7f21d030000006b48304502210096a49131b7e5bdf585819d50b2fa4ca6db40e3487b6e4beff574c7a0c7e8f0c502205eb4e75ffa032d1d57abd030560c7119eb66f7b8e2cb19349de0847f7aa7e522412103e28566849c9c39664cd5dfae97377faaa7fa48a9e3c81c4058ad44a1add18eb5fffffffff7240100000000001976a914b97ad553571090b612b52c7e35bf16ee35f06f2988ac0434210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acdc050000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403564633039386435633935333037643964616636633539303839663733613661306331636463353632653238653865666131643739313637653536643035616105656d6f6a6906e2ac86efb88ee6fd0000000000001976a914b97ad553571090b612b52c7e35bf16ee35f06f2988ac00000000",
	// 8b3d0e0e13a05d943bc1486d08bdb7fe09f56474aec0fd89dbfe3e80ce92ebf8
	"010000000000000000ef019e0507bfc5f6ddc334df69754b93a400f9debfcec7c88d9b6a1cd04b1906c37f030000006b483045022100df99e51aef8c8d498259ce51ff856828a56fedb536c5ee94ab9c6d073167180d02205943a40f2e8eb2c320f0f16697ab741b467c2f057635c64e46a8682a93bec2c0412103ae7713dfe37c3df892e1e4b96606c8eec78ee21a3e24fe673e8a52f6ab313d11ffffffffd2204500000000001976a914f44d2aaaa9bcd10234aab47405718f6361016bc388ac0434210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acdc050000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478406532376630656566383932383936646265623765646236396237666366656365653730373534353962393530393261386430363731343534356332323530666605656d6f6a6906e2ac86efb88ec1f94400000000001976a914f44d2aaaa9bcd10234aab47405718f6361016bc388ac00000000",
	// 84c280ae72dd10c50b7b00ef953f7b5301bbf2c507a87dec9af8859270375b17
	"010000000000000000ef018743cd1e0d50fc5386aef1b6216fd23b3f5648584c7dc0dbbbc599b7f262a7a4030000006b4830450221009035553348a9e8aa78f338f0f70a6d94c3390011ded56e3c157e2b946ad4959402200343f51533265e742a7b4723943044e62745033cef6bddaf1e6e1388993e6428412103ae7713dfe37c3df892e1e4b96606c8eec78ee21a3e24fe673e8a52f6ab313d11ffffffffb0d24400000000001976a914f44d2aaaa9bcd10234aab47405718f6361016bc388ac0434210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acdc050000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403462313063613561653736646662656538623665646365326435353630663534663032636533643162623466353530623734323861376534653035383932313205656d6f6a6906e2ac86efb88e9fab4400000000001976a914f44d2aaaa9bcd10234aab47405718f6361016bc388ac00000000",
	// f6fd4b891668bbbf02c6bd559b2ff3f0acf5e2e48df4a389dc9cd0b38bbd88cd
	"010000000000000000ef02e8ff8a55789e7670b79e69b029f81eeba70726f950709763bbacdb879f924d1b000000006a473044022071f5aed5b90bd0e46ba64ad5beb8ba3a0cde3f657145d7142a65c3fe1c2a3bb00220229cd3c400383926296e1109cdec685bc6dafb66826b3607c920ac3e143075174121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac9993db5a655b11e9cbe688e8e9a8885b8800af738d1b61e72960d02060d282ed000000006a473044022054221036e081d35ac180556c8d1effdfc697fdb8bbdb48a697ae4db44b65204802205f0419eede7f0a011b73eb2d60c399c48edeefb8967d2d15b91d216c5bccbe664121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0310270000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403431333366636665353232613266643835396139613234356530303237353763383731363736363339313466383964353937363637336663333332386665393405656d6f6a6906e2ac86efb88e571b0000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac00000000",
}

// GetCounterConflictingTxHashes(ctx context.Context, s Store, txHash chainhash.Hash) ([]chainhash.Hash, error) {
func TestGetCounterConflictingTxHashes(t *testing.T) {
	ctx := context.Background()
	logger := ulogger.NewErrorTestLogger(t)

	tSettings := test.CreateBaseTestSettings(t)

	utxoStoreURL, err := url.Parse("sqlitememory:///test")
	require.NoError(t, err)

	utxoStore, err := sql.New(ctx, logger, tSettings, utxoStoreURL)
	require.NoError(t, err)

	blockHeight := uint32(892821)

	// create all the parent transactions
	for _, txHex := range txsNeededForProcessing {
		tx, err := bt.NewTxFromString(txHex)
		require.NoError(t, err)
		_, err = utxoStore.Create(t.Context(), tx, blockHeight)
		require.NoError(t, err)
	}

	// 8da41656a0e5906c9a57565ec2a93af642825b3a539f34be086e45c576925959
	txConflicting, err := bt.NewTxFromString("010000000000000000ef0534458666d1c9e190a9edbe1142c4fbc69b63996d0894308d08c0c819d74bb747000000006b483045022100f462f2b9e7de55842f6930e941917e665ba1d5001832b092345b7bf5d12cc7530220139ada941192abd7c5e5f33b62d243bd9fe997e610ec169a711ba3c266e605814121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac63b18cc2fda3f02d8ea2473984b5dbe6516b8bdf498808c1097632f8028433cc000000006a4730440220105f2ac6c4abda4143f98f6bf29f14adc0b4070b710c427fc8c5dba69b3f538c02205c7137755206220f7d58c5cf93677f58f613d766349c49da3867560213eac7a54121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acf8eb92ce803efedb89fdc0ae7464f509feb7bd086d48c13b945da0130e0e3d8b000000006a473044022059cb25eb0a2d6da11af76aeb8b5b2bdb09759a0fd57fdbd4c28f8ab42ebd2eb302200eb1afa14a6f86f8d09465ac67ae09399752a050fdea7b1d459feccfe1876fc84121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac175b37709285f89aec7da807c5f2bb01537b3f95ef007b0bc510dd72ae80c284000000006b483045022100e9b55426d92b9460aed05c16746d2df395b4ad17c11704069fc6e0cc944ede5c02207663fcc2ac1bd8de563fdb81a0496172dfe9259a4c693f62db1dfabe14afeed94121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88accd88bd8bb3d09cdc89a3f48de4e2f5acf0f32f9b55bdc602bfbb6816894bfdf6020000006b483045022100f1f22df1870cfe4fd3fbbb5651095e86876f352965eecc318c3ae4689bcbc3df02202a017de7d0b83f90c596d1f7a77450cd617813584d25c8577afce064e36640254121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff571b0000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac04d0840000000000001976a914d12fbd65ab309d63809b06fcadf224542c4a835988ac70170000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403365666631373732323139613530663761393235393834646465323364363337643061356562393665333034366664616538383932633637613631663632656205656d6f6a6906e2ac86efb88ee6030000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac00000000")
	require.NoError(t, err)

	// a997cfc55781a33a5b7b43cebaa9b6291bfba6bba6a35ed81566f7691e380696
	txCounterConflicting, err := bt.NewTxFromString("010000000000000000ef1a347f5cd9d9c86f93bc17597773b6b6ffc2fd7a8a8ee7618d739fd986e28597fe000000006a4730440220017cb08342802ef45a78f3aece5cc94686a817c0e5a8db660254cd0ce50acd1102205e8e640853bd66cd6a455cf461657c37c4fb2b124f330f70c53be41090909a824121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac34458666d1c9e190a9edbe1142c4fbc69b63996d0894308d08c0c819d74bb747000000006a47304402205b22c473b716bf6eddeea972e789e38ea416cf0abbe57c866714575dc955135f022079b002cd9fb0b21e464f240bb4a9680345f7bd74159c7e64cc75dccfa94ffc784121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff34210000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acb3688439ccf084c1649d98f2bc7640ae9f4ed62a247b1e067ba5eef9a6f8ce33030000006a47304402202bfaed7cf68170ecdfe9ae05e84f22ac12ef082995b14e80c54c88038d4cf4b2022041a4c3503ea577035d0b77db52ac6cb3121a337b4dd71ee52ade866ebf6f4b1a4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff45030000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acecb1e85ff08aca7d057a0ab497e139697365618f282a149914312b32a5fb7bd0000000006a4730440220647ea8cfe3d287bbef53949786fdd77bfde60082d15d281ceed4f09d69a130c5022005404b539aa7725ab13d5fc3c7a80f65cd0575027f1577eba430fc28932cee2d4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff65010000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0f2cfc1468b75ef17564dfe86afeaf0244ae205e22c63b9bda07ddbd380ff601000000006b483045022100ad03d2106a6eaca238fa3a0b4aab9be64f8a23e2810288892e5cc9768e603e0102200bf3bebfaae775d86e901ec087f12d16cba218a46f6fe91eba9e49c8f9beb2594121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac3b306afd7655ac1e1350524db934df146670a3df6cf4a8aaa695617f4bfde9a1000000006b483045022100a5d1c85836b24a2eaa09834feec130bf3199b8be8829e86cc478a5e3b61f7dc702202ca8e293bd20d9c37d958f7b87b7b6a182cc6036066929693f55c44af5cae0d64121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0d208bbc9d33ccf751a3d322171f593686f661ebbda521f240046a420ef2cff9000000006b483045022100924c506189bb03f64ce73f8215cf5c40c825e3f2cd16238c119f2e962a767c6d02201d7e50861ec34b2dfe7e3afe344f1c15843c0cf1678cd9f9eaabad387fdd6c7d4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acff864ff860432581bf226d5df2693ff2e26855193a36fc714d0d6021100effbb000000006a47304402204ca306b76b30dbb2e34fccb5807f3e1d4489f7019feb16885485ab2f0719aab50220480e8746659c0d38c94159400d2e6ed2b9c3563ce8818353900ff3ab05aaa4124121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac73478b80ba3699fb2586a2d3eae544f0d2816cc2e73629889838d299719e0797000000006a473044022052ac5a5523bb9b74cffa7d4c2d7218996c219266b40220931c21dbd63f395ef302200a172ec81b40f9e5327640cedb2ecb3416b3533e8ace794cd00476c3a5913c6d4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac9bd9471d4c430e15befbc96f2165b31028139218b50c7d0faf51d3b83df03410000000006b483045022100992cb12f4d8502738d378d90e11a29027c13690bca0b139ea4388bc5d0ab762a02203353eb41abb8cd774d88697754b88731768e957e6bbdc3cfc2235e871998738c4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac810a33c7e5c787fb761a9242f8996e610063b5bdeda663cfcd7faef824fa04a5000000006b483045022100a7e3808bbde11d2284ce5630766549e1c442a8820dc89161083cb442a1e978dd0220072a06f9d195e1161314d300ce7aa8d9877d1cd8e5980752c1adcd610b9421d24121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac99562d20fafad9b33c370fac8fb0a5b4b4b7b34fe9179cba3be03544ebd2c77c000000006b483045022100c00a63359f34f9d6b2ecd0fd8662d40abc0f2d0b6e734aac7a96743e2fd5ea3202201c1fe0380e8754d7a3da9b10f237fc1025cd9d9e4b82fde15db8b9a62f8793594121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88acb6f5103be594e6d72b4337abf4cf594e03975bf9a5b5e59b715cff9c83d032ef000000006b483045022100a43cde7fdbf2c2836dcb75614eac5ea89f40960bcac334bf71bd1eb2c0b019f4022070e79bbc69d96b5ea55a3d036ccd64697e0d58aa5eb58105059e7472ba0b21e94121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac1ce43698a8bffa776cb5dd690112584358bd1c050f07f815ae0a66eec8da5220000000006b483045022100b0809d579b64dd969ee9e29f8c5b8e6509a3092ad972a8f7b942af4b856fdf4402207ecfb6aa43edcc0e6e622243e25b0a0e73700c0de813683603474cca7f67e3554121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac9334b35046af5407254ad8bea66fe137ae9ea879a22aa1e30051e3c19992c394000000006a47304402204c04c3b69c1c2c3e48788b027efa28cbc2cf4f996c017e93c88ecb4a8fd6878102205d6558bb4b4a9b1fcc69c2d81b538dfd50af5d2d2af4875be56648b3331960454121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac6f30be15c1707702108a62dc2ee9e57af7488cb6a1d5b9fe065e37938812a4e2000000006a473044022028f4afbf482e5c3417fabd0ed5a7f470f7431fe5b9063ab7ff738a082300549302205943fde65aecf8aa71fd0f573ab4aeadcb6aa99cbf735504bb0bef67b60bf9444121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac5fec54096702f6c2a49e344288dbf05bd4636c3c7047fa3e43935ca9e11f381e000000006b483045022100ed8897cecd3bc70179933b6b98d2ea21d4890d10ab12ca1b3720a39874c5cfd7022067a9bcbf760eebd4c87e2554b3cd6e2ecea95cc436cad64019a61209c0f161244121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac62e1a5a8ef9bdbd8b61f6fa474e7309423127a5a6536c86f7d86792e151b3e11000000006b48304502210089cf3981f37cb594b497af84b71775b61221d32f0516ea90857b5cbf121827ec022001e0cfd88071d4ac55d29aa199efde87909772c1f73a4a4cee151b47e3c18fda4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac91523974e18dd1ebed6ab2ccec376da83aa7f38a6fe33dfce64e27508e964b91000000006b483045022100af045716598acc586741b005836cf0fe412abdcc782afaf01549332f345d7113022006cf2194be3a9e99b77e14e1c93524b56f1ecc4d44b43c6ef5219d16e9e27d304121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac250009ff62c2663cfa20e3a85eb70e723b7939515b1e45c3898bf175042137e0000000006a473044022039de518071a97de544b3a4e3d1e1dec67829a5c783b6cf9a06578c8a3df6ac4602201f284f968e1621f5a6fe3d6ba0ca1e8fd6acdc4321fadde2538da958e46c02fc4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac069e1d427f623991e60f9ba0a1572a8ec034acd2da22c4d1148abeb8ab589cc1000000006a47304402206dde74d14130899ddc988b1f9ba01c7f481b0c0067a3546db89e2996a4eeb2600220757f3ec23d7aa847895aef8ce8536177e9bfa3fdcf9fb4877533a041d25a360b4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac5ab6a7924bd1342588c162ad328119484360e4cd1981bc3c02d8babdf97b3d69000000006a473044022052ebef364721b2083baeb97b689ff740a0a1d07d23e60c55e31359a42c0d1ad502200b6e796b1c3243ea74539df20e65533615359d5ad6506440b52cc1d5a55300354121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac54b8a2a1020be3f0327d1fe188952de0f60aa0a6f3ae12290d8ed96eab0620ef000000006b483045022100d3f6a891d8e9b5596f1d679cc3d5df8042244e1d98480ab5b2192773a2859ee3022065f59ef73032be9c01eef8127421627accb5f18997ea0c98e5cdb307350d00fe4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88accbadbaeafe2d64b6780e8fcd95ae6eb608f81e865e34b5e2b460113f4e0867e7000000006a473044022019813251bcef755ec2c8c355033b989f08a8749fcabb96ccfc677613eafee8500220474042b34debc560bcef37df95e1923b254c6e05958d6d395780d4a34769c8fe4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88accb1bb06595e3e730ef0c60179de639be6c8edde7a7121bb8752fea85d3d98ab6000000006a473044022060d505c180a714fb8b1ff556d6ae44d6ac9f86d3ab65347876d81db68cc9edac022073e9a4ffc85b10cfb8782d31b920d9a209e2824763774d89a2c725dfbedb74c04121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac117e70d461eb70deba621b1471aa4ff8c5690ccb399cd77800404d582d3dd0e2000000006a47304402203c23fb176d32f1f6e1c9ca3101ef32853b3fe80ae2ff15e5054172482f66d0f602201845ceff2c819308c7214b85e1d402abdc9a36b913752ccd91893ef038c1336a4121030b720f52f3d616ffbd0ee85ee9802a5c939342e9c05d231e52972a0aafcb6db5ffffffff55000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac0468420000000000001976a914c6bea461a76ce16298e23ef0a2b11a83336fea9988acb80b0000000000001976a914fe6424743b8d375f92f18a117d6f14e658b460ee88ac00000000000000009c006a223150755161374b36324d694b43747373534c4b79316b683536575755374d7455523503534554036170700874726565636861740474797065046c696b6507636f6e74657874027478027478403965616166303462346138376633373438623234393430366663373733333937366564383938366539653366666238376630633233623433383561366138363905656d6f6a6906e2ac86efb88e3f000000000000001976a914f2b08ecb7283e8d66500785401d3f3a2581d05fe88ac00000000")
	require.NoError(t, err)

	// spend the counter conflicting transaction
	spends, err := utxoStore.Spend(t.Context(), txCounterConflicting, utxoStore.GetBlockHeight()+1)
	require.NoError(t, err)

	_ = spends

	// create the counter conflicting transaction
	_, err = utxoStore.Create(t.Context(), txCounterConflicting, blockHeight)
	require.NoError(t, err)

	// create the conflicting transaction, mark it as conflicting
	spend, err := utxoStore.Create(t.Context(), txConflicting, blockHeight, utxostore.WithConflicting(true))
	require.NoError(t, err)

	assert.True(t, spend.Conflicting)

	// get the counter conflicting transactions of the conflicting transaction
	// this should process all indexes from the parents properly
	txHashes, err := utxostore.GetCounterConflictingTxHashes(t.Context(), utxoStore, *txConflicting.TxIDChainHash())
	require.NoError(t, err)

	require.Len(t, txHashes, 2)
	require.Contains(t, txHashes, *txConflicting.TxIDChainHash())
	require.Contains(t, txHashes, *txCounterConflicting.TxIDChainHash())
}
